<html>
  <head>
    <title>The Selenium Guidebook: How To Use Selenium, successfully</title>
    <style type="text/css">
      @font-face {
        font-family: 'Droid Sans';
        font-style: normal;
        font-weight: 400;
        src: url('droid_sans.ttf');
        -fs-pdf-font-embed: embed;
        -fs-pdf-font-encoding: Identity-H;
      }
      body {
        font-family: 'Droid Sans';
      }
      div.page_footer {
      }
      h1 {
        page-break-before: always;
      }
      pre {
        white-space: pre;
        white-space: pre-wrap;
        page-break-inside: avoid;
        orphans: 0;
        widows: 0;
        background-color: #f5f5f5;
        border: 1px solid #ccc;
        border: 1px solid rgba(0, 0, 0, 0.15);
        border-radius: 4px;
        display: block;
        padding: 9.5px;
        margin: 0 0 10px;
        font-size: 13px;
        line-height: 20px;
      }
      code {
          padding: 2px 4px;
          background-color: #f7f7f9;
      }
      .hll { background-color: #ffffcc }
.c { color: #408080; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cp { color: #BC7A00 } /* Comment.Preproc */
.c1 { color: #408080; font-style: italic } /* Comment.Single */
.cs { color: #408080; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #FF0000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #00A000 } /* Generic.Inserted */
.go { color: #888888 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #7D9029 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #999999; font-weight: bold } /* Name.Entity */
.ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #A0A000 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #BB6688 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
  </head>
  <body>
    <p align="center">
  <img src="bookcover.png" alt="Book Cover Image"/>
</p>
<h1>Preface</h1>

<p>This book is not a full and comprehensive treatise that outlines every possible permutation of Selenium. There are other books that already do this. My goal, instead, is to teach you the necessary bits to use Selenium <strong>successfully</strong> for your circumstance.</p>

<p>What you have before you is a distilled and actionable guide culling from my consulting practice and full time positions held doing Quality Assurance over the last five years.</p>

<p>My goal in writing this is to provide you with the materials I wish existed when I was starting out with automated acceptance testing. I hope it serves you well.</p>

<h2>What This Book Will Cover</h2>

<p>This book focuses primarily on Selenium WebDriver and it's use to test desktop browsers. Selenium RC will be covered only insofar as to help you upgrade to WebDriver. And mobile testing with Appium will also (briefly) be covered.</p>

<p>Record and Playback tools like Selenium IDE and Selenium Builder are great for getting started, but abysmal for growing past that point. To that end, they will not be covered in this book. And instead an approach on how to write well factored tests from scratch, in code, will be the focus.</p>

<h2>Who This Book Is For</h2>

<p>This book is for anyone who wants to take automated acceptance testing seriously and isn't afraid to get their hands a little dirty. That is to say, this book is for anyone who wants to use computers for what they are good at, and free up you and people on your team to do what they are inherently good at (which does not include repetitive, mundane testing tasks). And don't worry if you're super new to programming, I'll cover the basics so you'll have a good platform to build from.</p>

<h2>About The Examples In This Book</h2>

<p>The examples in this book are written in Ruby. This is partly because that is the language in which I am strongest. But really, it has more to do with how readable and approachable the language is. By sticking with a scripting language that reads a lot like English this book can be picked up by almost anyone regardless of their technical background and be immediately useful. And even if Ruby isn't your preferred language, the strategies and patterns used are applicable regardless of your tech stack.</p>

<p>The web functionality used to write tests against is from an open source project called the-internet -- available on <a href="https://github.com/tourdedave/the-internet">GitHub</a> and viewable through <a href="http://the-internet.herokuapp.com/">a Heroku site</a>.</p>

<p>And the test examples are written to run against the <a href="http://rspec.info/">RSpec</a> test runner, with <a href="http://bundler.io/">Bundler</a> managing the third party libraries (a.k.a. gems).</p>

<h2>How To Read This Book</h2>

<p>Chapters 1 through 5 are more focused on priming you with knowledge and questions to consider when it comes to strategy, language selection, and test design. Chapter 6 is where we first start to code. And the examples build upon each other up through chapter 14.</p>

<p>Chapter 15 is a culmination of 13 sub-chapters which outline things you will likely see and how to address sthem. They do not build upon each other or other parts of the book, and are meant to stand alone.</p>
<h1>Table of Contents</h1><ol>
<li><a href="#chapter1">Selenium In A Nutshell</a></li>
<li><a href="#chapter2">Defining a Test Strategy</a></li>
<li><a href="#chapter3">Picking a Language</a></li>
<li><a href="#chapter4">A Programming Primer</a></li>
<li><a href="#chapter5">Anatomy Of A Good Acceptance Test</a></li>
<li><a href="#chapter6">Writing Your First Test</a></li>
<li><a href="#chapter7">Writing Re-usable Test Code</a></li>
<li><a href="#chapter8">Writing Really Re-usable Test Code</a></li>
<li><a href="#chapter9">Writing Resilient Test Code</a></li>
<li><a href="#chapter10">Prepping For Use</a></li>
<li><a href="#chapter11">Running A Different Browser Locally</a></li>
<li><a href="#chapter12">Running Browsers In The Cloud</a></li>
<li><a href="#chapter13">Speeding Up Your Test Runs</a></li>
<li><a href="#chapter14">Automating Your Test Runs</a></li>
<li><a href="#chapter15">Things You will See And How To Work With Them</a></li>
<ul><ol>
<li><a href="#chapter16">A/B Testing</a></li>
<li><a href="#chapter15_2">Basic Auth</a></li>
<li><a href="#chapter15_3">Dropdown Lists</a></li>
<li><a href="#chapter15_4">File Download (browser specific)</a></li>
<li><a href="#chapter15_5">File Download (browser agnostic)</a></li>
<li><a href="#chapter15_6">File Upload</a></li>
<li><a href="#chapter15_7">Frames</a></li>
<li><a href="#chapter15_8">HTTP Status Codes</a></li>
<li><a href="#chapter15_9">Mobile</a></li>
<li><a href="#chapter15_10">Multiple Windows</a></li>
<li><a href="#chapter15_11">Secure File Downloads</a></li>
<li><a href="#chapter15_12">Tables</a></li>
<li><a href="#chapter15_13">Upgrading From Selenium RC</a></li>
</ol></ul>
<li><a href="#chapter16">Finding Information On Your Own</a></li>
</ol>
<h1 id="chapter1"><small>Chapter 1</small><br>Selenium In A Nutshell</h1>
<h2>What Selenium Is And Is Not Good At</h2>

<p>Selenium is a software robot sent from the future to help us test web applications. But keep in mind that it's not one of those fancy shape-shifting robots than can run really fast. Instead it's more like one of those really strong robots that's not very fast and is best suited for accomplishing a certain objective.</p>

<p>That is to say -- Selenium is really good at a specific set of things. If you know what those are and stick to them then you will be able to easily write reliable, scalable, and maintainable tests that you and your team can trust.</p>

<p>Selenium is built to automate browsers. Specifically, human interaction with them. Things like navigating to pages, clicking, typing, dragging, and dropping.</p>

<p>It's less ideal for checking lower-level functionality like HTTP status codes or HTTP headers. While it can be achieved, additional setup with a third-party tool (e.g. BrowserMob Proxy) is required since this functionality is not available out of the box -- and it can be a bit of a rabbit hole to fall down since there are numerous cases to consider.</p>
<h2>Selenium Highlights</h2>

<p>Selenium works on every major browser, for a majority of programming languages, and on every major operating system. Each language binding and browser are actively being developed for to stay current. Yes, even Internet Explorer (thanks to <a href="https://twitter.com/jimevansmusic">Jim Evans</a>!).</p>

<p>Selenium can be run on your local computer, on a server (with Selenium Remote), on your own set of servers (with Selenium Grid), or on a third-party cloud provider (like Sauce Labs). As your test suite grows your test runs will take longer to complete. To speed them up you will want to run them in parallel, which is where the benefit of having your own servers or using a cloud provider comes in -- that, and the ability to have numerous browser and operating system combinations.</p>

<p>One of the guiding philosophies of Selenium is to be able to write your tests once and run them across multiple browsers. While this is a rosy picture, it's not entirely accurate. There are plenty of gotchas to watch out for. We'll cover these in detail throughout the book.</p>
<h1 id="chapter2"><small>Chapter 2</small><br>Defining a Test Strategy</h1>

<p>A great way to increase your chances of automated web testing success is to first map out a testing strategy. And the best way to do it is to answer these four questions:</p>

<ol>
<li>How does your business make money?<br></li>
<li>How do your users use your application?<br></li>
<li>What browsers are your users using?<br></li>
<li>What things have broken in the application before?<br></li>
</ol>

<p>Note: for entitites that don't deal <em>directly</em> in dollars and cents (e.g. non-profits, federal agencies, etc.) you should focus on how the application generates value for the end user.</p>

<p>After answering these questions you should have an understanding of the functionality and browsers that matter to the application you are testing. This will help you narrow down your efforts to the things that matter most.</p>
<h2>What To Do With The Answers</h2>
<h3>Question 1 - Money/Value</h3>

<p>Every company's application makes money (or generates value) through a core set of functionality -- a.k.a. a 'funnel'. Your answers to this question will help you determine what this is. And this will be your highest priority for automation. Start an automation backlog to keep track.</p>
<h3>Question 2 - Usage Data</h3>

<p>But odds are your application offers a robust set of functionality that grows well beyond the funnel. Your answers to this question will help highlight what it is. And if you're basing these answers on usage data then it will be broken down from highly used to lightly used. Tack these items onto your automation backlog based on order of use.</p>
<h3>Question 3 - Browsers</h3>

<p>Now that you know what functionality is business critical and widely adopted by your users, you need to determine what browsers to focus your automated web testing efforts on. Your usage data will tell you this as well. It will help you determine which browsers you can reasonably avoid testing in (e.g. based on non-existent or low usage numbers). Note the top 2 (or 3 depending on your numbers), but focus on the top 1 for now. This is the browser you will start using for automation.</p>
<h3>Question 4 - Risky Bits</h3>

<p>To round out the strategy it is also best to think about what things have broken in the application before. To answer this question it's best to ask around your team to get a full list. It typically reads like a laundry list of browser specific issues or functionality that has been flaky or forgotten about in the past. Be sure to check this list against your automation backlog. If it's not there, add it to the bottom of the backlog. If it is there, make a note in the backlog item that this has been an issue in the past. And if the issue has happened numerous times and has the potential to occur again, move that backlog item up in priority. And if issues keep cropping up that are related to a specific browser, compare this browser to your short list from question #3. If it's a browser that's not in your list but it's still important (e.g. a small pocket of users), track it on the backlog, but put it at the bottom.</p>
<h2>Now Your Are Ready</h2>

<p>Having answered these questions you should now have a prioritized backlog of critical business functionality, a short list of browsers to focus on, and an understanding of the risky parts of your application to watch out for. With it, you should be able to make sure you are on the right track -- focusing on things that matter for the business and its users.</p>
<h2>Some Closing Thoughts</h2>

<p>This strategy will help you focus your testing efforts, avoid wasting time, and increase your confidence in the approach you are taking.</p>

<p>This strategy works best for applications with existing functionality and does not speak directly to testing new functionality that's being actively developed. That's not to say that the two couldn't co-exist. It largely depends on your available resources and pace of development. But in order to reach high quality at speed, you first have to go slow.</p>
<h1 id="chapter3"><small>Chapter 3</small><br>Picking a Language</h1>

<p>In order to work well with Selenium you need to choose a programming language to write your acceptance tests in. Conventional wisdom will tell you to choose the same language as what the application is written in. That way if you get stuck you can ask the Developers on your team for help. But if you're not proficient in this language (or new to development) then your progress will be slow and you'll likely end up asking for more Developer help than they have time -- hindering your automation efforts and setting you up for failure.</p>

<p>A great way to determine which language to go with is to answer one simple question: <strong>Who will own the automated tests?</strong></p>

<p>The answer to this, and the discussion that unfolds from it, will help you more effectively choose a programming language.</p>
<h2>What To Do With The Answer</h2>

<p>If you're a Tester (or a team of Testers) and you will be building and maintaining the test automation, then it's best to consider what languages you (and your team) already have experience with, or are interested in gaining, rather than what the application is built in. Have a discussion with your team to see what interests them.</p>

<p>For example, there's not much advantage in writing your test automation in Java if your team has no previous development experience and will be the ones owning it. Instead, try to choose a language that is more approachable -- e.g. a scripting language like Ruby or Python.</p>

<p>But if you're a Developer that is working on the application and just looking to add automated acceptance testing to the mix then it makes sense to continue with the same language.</p>
<h2>Some Additional Food For Thought</h2>

<p>As your suite of tests grow you will find the need to add functionality to make things easier to use, run faster, offer better reporting, etc. When this happens you will effectively be doing two jobs -- growing a framework (a.k.a. a test harness) and writing automated tests.</p>

<p>As you are considering which language to go with, consider what open source frameworks already exist for the languages you are eyeing. Going with one will save you a lot of time and give you a host of functionality out of the box that you would otherwise have to build and maintain yourself -- and it's FREE.</p>

<p>Here's a short list of open source Selenium WebDriver frameworks and their respective languages (sorted alphabetically):</p>

<ul>
<li><a href="http://github.com/chemistrykit/chemistrykit">ChemistryKit (Ruby)</a></li>
<li><a href="http://www.gebish.org/">Geb (Groovy)</a></li>
<li><a href="http://element34.ca/products/saunter">Saunter (Python and PHP)</a></li>
</ul>

<p>Choosing a programming language for automated testing is not a decision that should be taken lightly. If you're just starting out (or looking to port your tests) then considering and discussing these things will help position you for greater success.</p>

<p>With all that being said, the rest of this book will show you how to roll your own framework (in addition to writing well factored tests) in Ruby.</p>
<h1 id="chapter4"><small>Chapter 4</small><br>A Programming Primer</h1>

<p>This section will prime you with just enough programming concepts (and how they pertain to testing) to get you going so that you have some working knowledge and a vocabulary to more effectively comprehend what you will see throughout the remainder of this book and in your work after you put this book down.</p>

<p>Don't get too hung up on the details yet. If something doesn't make sense, it should once we dig into the full examples in the following chapters. Consider this more of a glossary than a code school.</p>
<h2>Installation</h2>

<p>Ruby is a fast changing ecosystem. In order to find the latest on how to install Ruby, I encourage you to go <a href="https://www.ruby-lang.org/en/downloads/">here</a>.</p>
<h2>Installing Third-party Libraries</h2>

<p>One of the main benefits of Ruby is that it has a vibrant open source community with copious libraries (a.k.a. &quot;gems&quot;) immediately available making it extremely simple to quickly build complex things. You can find out more information on gems <a href="https://www.ruby-lang.org/en/libraries/">here</a>.</p>

<p>A helpful library called <a href="http://bundler.io/">Bundler</a> is a great way to easily manage gems within a project. This is what I use and what was used in building out the examples for this book.</p>
<h2>Programming Concepts In A Nutshell</h2>

<p>Programming can be a deep and indimidating rabbit hole if you're new to it. But don't worry. When it comes to testing, there is only a small subset that we really need to work with to get started. Granted, the more you know the better off you'll be. But you don't need to know a whole lot to be an effective test automator right now.</p>

<p>Of all the programming concepts out there, here are the ones you'll need to pay attention to first:</p>

<ul>
<li>Object Structures (Variables, Methods, and Classes)</li>
<li>Object Types (Strings, Integers, Booleans, Collections)</li>
<li>Assertions</li>
<li>Conditionals</li>
<li>Looping</li>
<li>Inheritance</li>
</ul>

<p>Let's step through each and how they pertain to testing with Selenium.</p>
<h2>Object Structures</h2>
<h3>Variables</h3>

<p>Variables are a helpful place to store things of various types (e.g. Strings, Integers, Booleans, Collections, etc).</p>

<p>They can be one or more words in length, start with a lowercase letter, and are often entirely lowercase. If they are more than one word long then an underbar is used to separate the words. You can place things into them by using an <code>=</code> sign. And the variable takes on the <strong>type</strong> of the object you store in it.</p>

<p>There are a handful of different variable types. But the ones we care most about for our test code are:</p>

<ul>
<li>local</li>
<li>instance</li>
<li>constants</li>
</ul>

<p>Local and instance variables are similar except that they vary in scope. That is to say, local variables enable you to store and access things within a confined area, whereas instance variables (annotated with a prepended <code>@</code>) let you store and access things more broadly.</p>

<p>A common example of an instance variable is the instantiation of a Selenium WebDriver object</p>
<div class="highlight"><pre><span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
</pre></div>
<p>This happens before any tests run, and within our test framework it is made available across all tests. If this were stored in a local variable, then the tests would not be able to use it.</p>

<p>And a common example of a local variable is storing an element (or a value from an element) in the beginning of a test to be referenced at the end of the test (e.g. for an assertion). In this scenario, the variable will only be available to that test when it is running.</p>
<div class="highlight"><pre><span class="n">it</span> <span class="s1">'sample test'</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">title</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>Constants are for storing information that will not dynamically change. They are easy to spot since they start with a capital letter, and are often all uppercase. These are commonly used to store element locator information at the top of Page Objects.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Login</span> <span class="k">do</span>

  <span class="no">LOGIN_FORM</span> <span class="o">=</span> <span class="s1">'#login'</span>
  <span class="no">USERNAME_INPUT</span> <span class="o">=</span> <span class="s1">'#username'</span>
  <span class="no">PASSWORD_INPUT</span> <span class="o">=</span> <span class="s1">'#password'</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div><h3>Methods</h3>

<p>One way to group common actions and behavior into helpful containers for easy reuse is to place them into methods.</p>

<p>An example of this would be the explicit wait action in Selenium.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
  <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
<p>We define a method with <code>def</code> and name it like we would a variable. Additionally, we can specify arguments we want to pass along when calling the method -- in this case, the amount of time we want to wait (in seconds). When setting this argument, we can also set a default to use if no argument is provided.</p>
<h3>Classes</h3>

<p>Classes are a useful way to represent complex, reusable concepts that will appear numerous times in our test code. They are large objects that can house multiple things (e.g. variables, methods, etc).</p>

<p>An example of this is the creation of a class that represents a page you are likely to use often (e.g. a login page). By using a class you can store elements you will interact with in constants, and create methods that capture the page's unique behavior. And then in your tests you simply create an instance of this class and call its methods to complete your test actions.</p>
<h2>Object Types</h2>
<h3>Strings</h3>

<p>Strings are alpha-numeric characters strung together (e.g. letters, numbers, and (most) special characters) surrounded by either single (<code>'</code>) or double (<code>&quot;</code>) quotes. Single quotes are encouraged unless you intend to manipulate the string value when consuming it (a.k.a. interpolation). In that case, then use double-quotes.</p>

<p>You'll run into strings when working with copy on a page (e.g. pulling a page's URL, title, or h1 to assert that your test is in the right place before proceeding).</p>
<div class="highlight"><pre><span class="n">it</span> <span class="s1">'sample test'</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">heading_text</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'h2'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="nb">puts</span> <span class="n">heading_text</span><span class="o">.</span><span class="n">class</span> <span class="c1"># this will tell you the object type</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div><h3>Integers</h3>

<p>You can do a lot of math in Ruby. But the two common types of Integers you will likely run into with testing are Fixnum (whole numbers) and Float (decimals).</p>

<p>If you have a test that needs to pull some values from a page and add/subtract/multiply/divide/etc them, then this will come in handy. Although, you may need to convert the values from a String to an Integer first -- which is trivial to do in Ruby since it is a dynamically typed language.</p>
<div class="highlight"><pre><span class="n">integer_value</span> <span class="o">=</span> <span class="s2">&quot;8&quot;</span><span class="o">.</span><span class="n">to_i</span>
</pre></div><h3>Booleans</h3>

<p>Booleans are binary values -- they are either <code>true</code> or <code>false</code>. You will see these when asking questions of your test. The answer returned (in most cases) will either be <code>true</code> or <code>false</code>. Without booleans you would not be able to make assertions or use conditionals.</p>
<div class="highlight"><pre><span class="n">it</span> <span class="s1">'sample test'</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'The Internet'</span><span class="p">)</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div><h3>Collections</h3>

<p>Collections enable you to gather a set of data for later reference.</p>

<p>In Ruby there are two types of built-in collections -- Arrays and Hashes. Arrays are stored in an ordered listed with an index number. And Hashes store values in the order they were inputted -- but use a key, value pair to store and retrieve data.</p>

<p>You'll end up working with Arrays (or some type of enumerable object that is of a similar construct) if you need to test things like HTML Data Tables, Dropdown Lists, or if you need to take an action on a specific element in a list that is not easy to access based on how it's designed.</p>
<h2>Looping</h2>

<p>Collections wouldn't be nearly as valuable without the ability to loop over them. Alternatively, you can also use looping to a specific action a certain number of times, or until a certain precondition is met. This is useful if you want to make more resilient tests. But let's continue on with the example we started with Dropdowns.</p>
<h2>Assertions</h2>

<p>Assertions are a crucial element for all of your tests. They are what determines whether your test will pass or fail. And they are fueled by booleans.</p>
<div class="highlight"><pre><span class="n">it</span> <span class="s1">'sample test'</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'The Internet'</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
<span class="k">end</span>
</pre></div><h2>Conditionals</h2>

<p>You can also put your booleans to work by making your tests do different things based on the boolean response. This will be done through the use of <code>if</code> and <code>case</code> statements.</p>

<p>We'll run into these when working with test setup to determine which browse to use and where to run our tests.</p>
<h2>Inheritance</h2>

<p>Within classes is the ability to connect them through parent/child inheritance. By having a single parent class we can store common actions in methods that can be readily available to all child classes.</p>

<p>An example of this is writing all of the Selenium actions you intend to use into methods in a parent class and then using these methods in all of your child classes. This way if there are ever any changes to the Selenium API, you only have to change them in one place, and your code will be much more readable as a whole.</p>
<h2>Additional Resources</h2>

<p>If you want to dive deeper into Ruby then I encourage you to check out some of the following resources:</p>

<ul>
<li><a href="http://www.codecademy.com/tracks/ruby">Codecademy</a></li>
<li><a href="http://pragprog.com/book/ltp2/learn-to-program">Learn To Program</a></li>
<li><a href="http://pragprog.com/book/ruby/programming-ruby">The Pick-axe book</a></li>
<li><a href="http://pragmaticstudio.com/ruby">The Pragmatic Studio's Online Course</a></li>
</ul>
<h1 id="chapter5"><small>Chapter 5</small><br>Anatomy Of A Good Acceptance Test</h1>

<p>In order to write effective acceptance tests that are performant, maintainable, and resilient, there are some simple guidelines to follow:</p>

<ul>
<li>Write atomic and autonomous tests</li>
<li>Group like tests together in small batches</li>
<li>Be descriptive</li>
<li>Use a Test Runner</li>
<li>Store it in a Version Control System</li>
</ul>
<h3>Atomic &amp; Autonomous Tests</h3>

<p>Each test needs to be concise (e.g. testing a single feature rather than multiple features) and be able to be run independently (e.g. sets up its own data rather than relying on a previous test to do it). Doing this may require a mental shift, discipline, and more up front effort. But <strong>it will make a dramatic impact on the quality, effectiveness, and maintainability of your tests</strong>.</p>
<h3>Grouping Tests</h3>

<p>As your test suite grows you should have multiple test files, each containing a small grouping of tests broken out by functionality that they're exercising. This will go a long way towards organization and maintenance as your test suite grows -- as well as faster execution times (depending on your approach to parallelization).</p>
<h3>Being Descriptive</h3>

<p>Each test file should be named appropriately, and each test within it should have an informative name (even if it may be a bit verbose). Also, each test (or grouping of tests) should be tagged for flexible execution later (e.g. on a Continuous Integration server).</p>

<p>This way you can run parts of your test suite as needed, and the results will be informative thanks to helpful naming.</p>
<h3>Test Runners</h3>

<p>At the heart of every test suite is some kind of a test runner that does a lot of the heavy lifting (e.g. test group execution, easy global configuration for setup and teardown, reporting, etc.). Rather than reinvent the wheel, you can use one of the many that already exists (there's more than one for every language). And with it you can bolt on third party libraries to extend its functionality if there's something missing -- like parallelization.</p>

<p>The examples in this book use <a href="http://rspec.info/">RSpec</a> as the test runner.</p>
<h3>Version Control</h3>

<p>In order to effectively collaborate with other Testers and Developers, your test code must live in a version control system of some sort (e.g. git, subversion, etc). Look to see what your Development Team uses and get a repository stood up there.</p>

<p>Keep in mind that your test code can live separate from the code of the application you're testing. There are cases and advantages where combining them may be advantageous. But if all your doing is writing and running tests against web endpoints (which is a majority of what your testing will be) then leaving your test code in a separate repository is a solid way to go.</p>
<h1 id="chapter6"><small>Chapter 6</small><br>Writing Your First Test</h1>

<p>Fundamentally, Selenium works with two pieces of information -- the element on a page you want to use and what you want to do with it. This one-two punch will be repeated over and over until you achieve the outcome you want in your application -- at which point you will perform an assertion to confirm that the result is what you intended.</p>

<p>Let's take logging in to a website as an example. With Selenium you would:</p>

<ol>
<li>Visit the main page of a site</li>
<li>Find the login button, and click it</li>
<li>Find the login form's userame field and input text</li>
<li>Find the login form's password field and input text</li>
<li>Find the login form and submit it</li>
</ol>

<p>Selenium is able to find and interact with elements on a page by way of various locator strategies. The list includes Identifier, Id, Name, Link, DOM, XPath, and CSS.</p>

<p>While each serves a purpose there is one approach that is best of breed. One that is cross-browser performant, simpler to maintain, and leverages code on the page -- and that's CSS Selectors.</p>
<h2>A Quick Primer on CSS Selectors</h2>

<p>In web design, CSS (Cascading Style Sheets) is used to apply styles to the markup (HTML) on a page. CSS is able to do this by declaring which bits of the markup it wants to interact with through the use of selectors. Selenium operates in a similar manner but instead of changing the style of elements, it interacts with them by clicking, getting values, typing, sending keys, etc.</p>
<h2>How To Find CSS Selectors</h2>

<p>The simplest way to find CSS Selectors is to inspect the elements on a page. The best way to do this is from within your web browser. Fortunately popular browsers of today come pre-loaded with development tools that make this simple to accomplish.</p>

<p>When viewing the page, <strong>right-click</strong> on the element you want to interact with and <strong>click Inspect Element</strong>. This will bring up a small window with all of the HTML for the page but zoomed into your highlighted selection. From here you can see if there are unique attributes you can work with (e.g. <code>id</code>, <code>class</code>, etc). And at the bottom of the window a set of CSS selectors will be listed showing you the heirarchy of the elements on the page that lead up to your selection. In some cases this info may be useful, in others, not so much.</p>

<p>From here you should able to get started with constructing a CSS Selector to use in your test.</p>
<h2>How To Find Quality Elements</h2>

<p>Your focus with picking an effective element should be on finding something that is <strong>unique</strong> and <strong>unlikely to change</strong>. Ripe candidates for this are <code>id</code> and <code>class</code> attributes (in CSS Selector parlance <code>id</code>'s are prepended with a <code>#</code>, and <code>class</code>'s are prepended with a <code>.</code>). Whereas copy (e.g. the text of a link) is less ideal since it is more apt to change. This may not hold true for when you make assertions, but it's a good goal to strive for.</p>

<p>If the elements you are attempting to work with don't have unique <code>id</code> or <code>class</code> attributes directly on them, look at the element that houses them (a.k.a. the parent element). Oftentimes the parent element has a unique locator that you can use to start with and drill down into the element you want to use.</p>

<p>And if you can't find any unique elements, have a conversation with your Development team letting them know what you are trying to accomplish. It's not hard for them to add helpful, symantic markup to make test automation easier, especially when they know the use case you are trying to automate. The alternative can be a lengthy, painful process which will probably yield working test code -- but it will be brittle and hard to maintain.</p>
<h2>An Example</h2>

<p>Let's take our login example from before and put it to test code.</p>

<p>Here's the markup for a standard login form (pulled from <a href="http://the-internet.herokuapp.com/login">the login example on the-internet</a>).</p>
<div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">&quot;login&quot;</span> <span class="na">id=</span><span class="s">&quot;login&quot;</span> <span class="na">action=</span><span class="s">&quot;/authenticate&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;large-6 small-12 columns&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;large-6 small-12 columns&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;radius&quot;</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">&quot;icon-2x icon-signin&quot;</span><span class="nt">&gt;</span> Login<span class="nt">&lt;/i&gt;&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
<p>Note the unique elements on the form. The username field has a unique <code>id</code>, as does the password field. The submit button doesn't, but the parent element does. Now let's put them to use in our first test (or 'spec' in RSpec parlance).</p>
<div class="highlight"><pre><span class="c1"># filename: login_spec.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="n">describe</span> <span class="s1">'Login'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'successful'</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/login'</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#username'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'username'</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#password'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'password'</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#login'</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>At the top of the file we are pulling in <code>selenium-webdriver</code> which is the third-party library (or 'gem' in Ruby parlance) that gives us the bindings necessary to use Selenium to drive the browser.</p>

<p>Next is the <code>describe</code>, which is effectively the title of the test. A simple and helpful name is chosen to note the intent of the file (e.g. 'Login').</p>

<p>In order to use Selenium, we need to instantiate it (with Firefox in this case). And when we're done, we don't want the browser we opened to hang around, so we close it. This is what we're doing in the <code>before(:each)</code> and <code>after(:each)</code> blocks. Note that we are storing our instance of Selenium in an instance variable (<code>@driver</code>) so it is available throughout our test.</p>

<p>And lastly is the <code>it</code> block, which is the test. And similar to the <code>describe</code> block, we can give it a simple and helpful name (e.g. 'successful').</p>

<p>In the test we are interacting with the unique CSS Selectors we identified from the markup by first finding them (e.g. <code>#username</code>, <code>#password</code>, and <code>#login</code>) and then taking an action against them. Which in this case is inputting text (with <code>send_keys</code>) and submitting the form (with <code>submit</code>).</p>

<p>If we run this (e.g. <code>rspec login_spec.rb</code> from the command-line), it will work and pass. But there's one thing missing -- an assertion. But in order to find an element to make an assertion against, we need to see what the markup is after submitting the login form.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;flash-messages&quot;</span> <span class="na">class=</span><span class="s">&quot;large-12 columns&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">data-alert=</span><span class="s">&quot;&quot;</span> <span class="na">id=</span><span class="s">&quot;flash&quot;</span> <span class="na">class=</span><span class="s">&quot;flash success&quot;</span><span class="nt">&gt;</span>
      You logged into a secure area!
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">class=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>x<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;content&quot;</span> <span class="na">class=</span><span class="s">&quot;large-12 columns&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;&lt;i</span> <span class="na">class=</span><span class="s">&quot;icon-lock&quot;</span><span class="nt">&gt;&lt;/i&gt;</span> Secure Area<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">&quot;subheader&quot;</span><span class="nt">&gt;</span>Welcome to the Secure Area. When you are done click logout below.<span class="nt">&lt;/h4&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;button secondary radius&quot;</span> <span class="na">href=</span><span class="s">&quot;/logout&quot;</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">&quot;icon-2x icon-signout&quot;</span><span class="nt">&gt;</span> Logout<span class="nt">&lt;/i&gt;&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
<p>After logging it, there looks to be a couple of things we can key off of for our assertion. There's the flash message that appears at the top of the page (most appealing), the logout button (appealing), or the copy from the h2 (least appealing). Let's use the flash message.</p>

<p>Now, with the flash message, there are two options. We can either leverage the unique class name, or the copy that it displays. Since the class name is descriptive and denotes success (which is the use case we are concerned with) let's go with that.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="n">describe</span> <span class="s1">'Login'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'successful'</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/login'</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#username'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'username'</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#password'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'password'</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#login'</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'.flash.success'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><h2>Just To Make Sure</h2>

<p>Now when we run this test it will pass just like before, but now there is an assertion which should catch a failure if something is amiss. Just to make certain that this test is doing what we think it should, let's change the assertion to force a failure. A simple fudging of the CSS Selector will suffice.</p>
<div class="highlight"><pre><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'.flash.successasdf'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
</pre></div>
<p>If it fails, then we can feel confident that it's doing what we expect and can change the assertion back to normal. This trick will save you more trouble that you know. Practice it often.</p>
<h1 id="chapter7"><small>Chapter 7</small><br>Writing Re-usable Test Code</h1>

<p>One of the biggest challenges with Selenium tests is that they can be brittle and challenging to maintain over time. This is largely due to the fact that things in the app you're testing change, breaking your tests.</p>

<p>But the reality of a software project is that change is a constant. So we need to account for this reality somehow in our test code in order to be successful.</p>

<p>Enter Page Objects.</p>

<p>Rather than write your test code directly against your app, you can model the behavior of your application into simple objects -- and write your tests against them instead. That way when your app changes and your tests break, you only have to update your test code in one place to fix it.</p>

<p>And with this approach, we not only get the benefit of controlled chaos, we also get the benefit of reusable functionality across our tests.</p>
<h2>An Example</h2>

<p>Let's take our login example from the previous chapter and pull it out into a page object and update our test accordingly.</p>

<p>Let's start by creating the page object.</p>
<div class="highlight"><pre><span class="c1"># filename: login.rb</span>

<span class="k">class</span> <span class="nc">Login</span>

  <span class="no">PAGE_HEADING</span> <span class="o">=</span> <span class="s1">'h2'</span>
  <span class="no">LOGIN_FORM</span> <span class="o">=</span> <span class="s1">'#login'</span>
    <span class="no">USERNAME_INPUT</span> <span class="o">=</span> <span class="s1">'#username'</span>
    <span class="no">PASSWORD_INPUT</span> <span class="o">=</span> <span class="s1">'#password'</span>
  <span class="no">SUCCESS_MESSAGE</span> <span class="o">=</span> <span class="s1">'.flash.success'</span>

  <span class="kp">attr_accessor</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">:password</span>
  <span class="kp">attr_reader</span> <span class="ss">:driver</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="n">driver</span>
    <span class="n">visit</span>
    <span class="n">verify_page</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">visit</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">+</span> <span class="s1">'/login'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">now</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="no">USERNAME_INPUT</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="no">PASSWORD_INPUT</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="no">LOGIN_FORM</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">success_message_present?</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="no">SUCCESS_MESSAGE</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">verify_page</span>
      <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="no">PAGE_HEADING</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'Login Page'</span>
    <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>We roll our own class, naming it accordingly (<code>Login</code>), and store the locators we use on this page as constants. Next we use the helpful <code>attr</code> constructs available in Ruby. They are short-hand for creating values that can be stored, referenced, and manipulated (a.k.a. setters and getters) depending on which type of attr is used (e.g. accessor, reader, writer).</p>

<p>In the case of <code>:username, :password</code>, we are making it so we can store and use the username and password values from both outside the class (e.g. in our test) and inside (e.g. in our class's methods). As for <code>:driver</code>, we are using it for a stylistic advantage -- so we don't have to litter our page object with unneccessary instance variables (e.g. <code>@driver</code> becomes <code>driver</code>).</p>

<p>We then use an <code>initialize</code> method. This is a built in method for classes in Ruby that enable you to execute code upon instantiating the class (before you do anything else). And with it we are taking an argument -- the Selenium driver object. Our test has the driver object, and when we instantiate this class we want to pass it in so the class can then drive the browser.</p>

<p>In the <code>initialize</code> method itself we are setting an instance variable and calling two methods. The instance variable setting (<code>@driver = driver</code>) is how we are are passing the Selenium driver object into the <code>attr_reader :driver</code> object (so that we don't have to use an instance variable to reference it) in our class methods. The <code>visit</code> method is a way to cleanly abstract navigation to the page. In it we are referencing an environemnt variable that should contain the base URL of the application we want to test, and appending the path to the page for this page object. The use of an environment variable is a simple way to pass global information like this between the test and the page object without explicitly passing it in. And the <code>verify_page</code> is more for sanity. The rule of thumb is to keep your assertions in your tests (and out of your page objects), but this is an exception to that rule. With it we can make sure that the browser is in the right place before proceeding. If not, the test will fail. While this is a helpful method, it's really only useful within the class, so it's marked as <code>private</code> (effectively making it invisible to our tests) and placed at the bottom of the class.</p>

<p>This leaves us with the behavior and assertion methods -- <code>now</code> and <code>success_message_present?</code>.</p>

<p>In <code>now</code> we are excercising the login form by inputting the user credentials and submitting the form. It's named <code>now</code> for simplicity. You can break apart these actions (inputting and submitting) if you wish, or name it something more explicit, but there's no pressing need, so we'll leave it for now.</p>

<p>Since our behavior now lives in a page object, we want a clean way to make an assertion in our test. This is where <code>success_message_present?</code> comes in. Notice that it ends with a question mark. Methods that end like this are known as mutator methods. And when they end with a question mark, they imply that they will return a boolean. So in it we want to ask a question of the page so that we can return a boolean. And in our test we will put this boolean to work by making an assertion against it.</p>

<p>Now let's update our test to use this page object.</p>
<div class="highlight"><pre><span class="c1"># filename: login_spec.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="n">require_relative</span> <span class="s1">'login'</span>

<span class="n">describe</span> <span class="s1">'Login'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:login</span><span class="p">)</span> <span class="p">{</span> <span class="no">Login</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'successful'</span> <span class="k">do</span>
    <span class="n">login</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s1">'username'</span>
    <span class="n">login</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s1">'password'</span>
    <span class="n">login</span><span class="o">.</span><span class="n">now</span>
    <span class="n">login</span><span class="o">.</span><span class="n">success_message_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>At the top of the file we include the page object file by using a <code>require_relative</code>. This enables us to reference a file relative to our present working diretory. We then insantiate the environment variable for the base_url (<code>ENV['base_url']</code>). Since we only have one test file, it will live here and be hard-coded for now. But don't worry, we'll address this later.</p>

<p>Next we set up our login page object for instantiation by using RSpec's <code>let</code> functionality. With it we can set the class to a variable that will have a local scope (<code>login</code> instead of <code>@login</code>) that will only be loaded if it's referenced in a test (a.k.a. memoized).</p>

<p>Last we wire up our test to use the page object and make an assertion against the final outcome (<code>login.success_message_present?.should be_true</code>).</p>
<h2>Simpler Test Writing</h2>

<p>This may feel like more work than what we had when we first started. But we're in a much sturdier position and able to write follow-on tests more easily. Let's add another test to demonstrate a failed login.</p>

<p>If we provide incorrect credentials, the following markup gets rendered on the page.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;flash-messages&quot;</span> <span class="na">class=</span><span class="s">&quot;large-12 columns&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">data-alert=</span><span class="s">&quot;&quot;</span> <span class="na">id=</span><span class="s">&quot;flash&quot;</span> <span class="na">class=</span><span class="s">&quot;flash error&quot;</span><span class="nt">&gt;</span>
    Your username is invalid!
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">class=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>x<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
<p>This is similar to the markup from our successful flash message, so let's mimic the behavior we used in our page object to create another mutator method to help in our assertion.</p>

<p>First we add a new locator for the failure message at the top of the file, just below the success message locator.</p>
<div class="highlight"><pre><span class="c1"># filename: login.rb</span>

<span class="k">class</span> <span class="nc">Login</span>

  <span class="no">PAGE_HEADING</span> <span class="o">=</span> <span class="s1">'h2'</span>
  <span class="no">LOGIN_FORM</span> <span class="o">=</span> <span class="s1">'#login'</span>
    <span class="no">USERNAME_INPUT</span> <span class="o">=</span> <span class="s1">'#username'</span>
    <span class="no">PASSWORD_INPUT</span> <span class="o">=</span> <span class="s1">'#password'</span>
  <span class="no">SUCCESS_MESSAGE</span> <span class="o">=</span> <span class="s1">'.flash.success'</span>
  <span class="no">FAILURE_MESSAGE</span> <span class="o">=</span> <span class="s1">'.flash.error'</span>
</pre></div>
<p>Further down the file (next to the existing mutator method) we add a new method to check for the existence of this message and return a boolean response.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">success_message_present?</span>
  <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="no">SUCCESS_MESSAGE</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">failure_message_present?</span>
  <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="no">FAILURE_MESSAGE</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
<span class="k">end</span>
</pre></div>
<p>Lastly, we add a new test in our spec file.</p>
<div class="highlight"><pre><span class="n">it</span> <span class="s1">'failed'</span> <span class="k">do</span>
  <span class="n">login</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s1">'asdf'</span>
  <span class="n">login</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s1">'asdf'</span>
  <span class="n">login</span><span class="o">.</span><span class="n">now</span>
  <span class="n">login</span><span class="o">.</span><span class="n">failure_message_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
<span class="k">end</span>
</pre></div>
<p>Now if we run our spec file (<code>rspec login_spec.rb</code>) we will see two browser windows open (one after the other) testing both the successful and failure login conditions.</p>
<h1 id="chapter8"><small>Chapter 8</small><br>Writing Really Re-usable Test Code</h1>

<p>In the previous chapter we stepped through creating a simple page object to capture the behavior of the page we were interacting with. While this was a good start, it leaves a lot of room for improvement.</p>

<p>As our test suite grows and we add more page objects, we will start to see common behavior that we will want to use over and over again. If we leave this unchecked we will end up with duplicative code which will slowly make our test suite harder to maintain. And right now we are using Selenium actions directly in our page object. While on the face of it this may seem fine, it has some long term impacts, like</p>

<ul>
<li>the inability to drive your tests with a different driver (e.g. mobile)</li>
<li>test maintenance issues when Selenium actions change (e.g. major upgrades ala RC to WebDriver)</li>
<li>slower test writing due to the lack of a simple Domain Specific Language (DSL)</li>
</ul>

<p>With a Base Page Object (a.k.a. a facade layer) we can easily side step these concerns by abstracting all of our common actions into a central location and leverage them in our page objects.</p>

<p>Let's step through an example with our login page object.</p>
<h2>An Example</h2>

<p>First we will need to create the base page object.</p>
<div class="highlight"><pre><span class="c1"># filename: base_page.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="k">class</span> <span class="nc">BasePage</span>

  <span class="kp">attr_reader</span> <span class="ss">:driver</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="n">driver</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="n">locator</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="n">locator</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">text</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">submit</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">is_displayed?</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">text_of</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>We first <code>require</code> our Selenium bindings. By placing them here, we no longer need to include it anywhere else in our test suite. And it makes more sense since this is the only file where we will be referencing Selenium commands directly. Next we declare our class and name it appropriately with camel-casing (<code>BasePage</code>).</p>

<p>True to how we did things in our original page object, we will use the <code>attr</code> construct here to store and reference the <code>driver</code> object. And this is the only thing that the <code>initialize</code> method is responsible for. That leaves the common methods that we will want to reference in our page objects -- <code>find</code>, <code>type</code>, <code>submit</code>, <code>is_displayed?</code>, and <code>text_of</code>.</p>

<p>Now let's update our login page to leverage this.</p>
<div class="highlight"><pre><span class="c1"># filename: login.rb</span>

<span class="n">require_relative</span> <span class="s1">'base_page'</span>

<span class="k">class</span> <span class="nc">Login</span> <span class="o">&lt;</span> <span class="no">BasePage</span>

  <span class="no">PAGE_HEADING</span> <span class="o">=</span> <span class="s1">'h2'</span>
  <span class="no">LOGIN_FORM</span> <span class="o">=</span> <span class="s1">'#login'</span>
    <span class="no">USERNAME_INPUT</span> <span class="o">=</span> <span class="s1">'#username'</span>
    <span class="no">PASSWORD_INPUT</span> <span class="o">=</span> <span class="s1">'#password'</span>
  <span class="no">SUCCESS_MESSAGE</span> <span class="o">=</span> <span class="s1">'.flash.success'</span>
  <span class="no">FAILURE_MESSAGE</span> <span class="o">=</span> <span class="s1">'.flash.error'</span>

  <span class="kp">attr_accessor</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">:password</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="n">driver</span>
    <span class="n">visit</span>
    <span class="n">verify_page</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">visit</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">+</span> <span class="s1">'/login'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">now</span>
    <span class="n">type</span> <span class="no">USERNAME_INPUT</span><span class="p">,</span> <span class="n">username</span>
    <span class="n">type</span> <span class="no">PASSWORD_INPUT</span><span class="p">,</span> <span class="n">password</span>
    <span class="n">submit</span> <span class="no">LOGIN_FORM</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">success_message_present?</span>
    <span class="n">is_displayed?</span> <span class="no">SUCCESS_MESSAGE</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">failure_message_present?</span>
    <span class="n">is_displayed?</span> <span class="no">FAILURE_MESSAGE</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">verify_page</span>
      <span class="n">text_of</span><span class="p">(</span><span class="no">PAGE_HEADING</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'Login Page'</span>
    <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>In order to use the base page object we need to do two things. First we need to include the file, which is handled using the <code>require_relative</code> at the top of the file. And second, we need to connect them using inheritance. This is handled in the class declaration with the <code>&lt;</code> operator. This is effectively saying <code>Login</code> is a child of <code>BasePage</code>. Or, <code>BasePage</code> is the parent of <code>Login</code>. This enables us to freely reference the methods we created in the base page object.</p>

<p><code>initialize</code> remains unchanged. But if we didn't have any actions that we wanted to run on load, then we wouldn't need <code>initialize</code> or the <code>attr_accessor</code>.</p>

<p>And to finish things off, we replace all of the driver incantations with calls to the methods we created in the base page object. Our test remains unchanged, but our page objects are now much more readable and flexible. And running our tests (<code>rspec login_spec.rb</code>) should still yield a passing result.</p>
<h1 id="chapter9"><small>Chapter 9</small><br>Writing Resilient Test Code</h1>

<p>Ideally, you should be able to write your tests once and run them across all supported browsers. While this is a rosy proposition, there is some work to make this a reliable success. And sometimes there may be a hack or two involved. But the lengths you must go really depends on the browsers you care about and the functionality you're dealing with.</p>

<p>By using CSS Selectors we are already well ahead of the pack, but there are still some persnickity issues to deal with. Most notably -- timing. This is especially true when working with dynamic, JavaScript heavy pages (which is more the rule than the exception in a majority of applications you'll deal with).</p>

<p>But there is a simple approach that makes up the bedrock of reliable and resilient tests -- and that's how you wait and interact with elements. Gone are the days of waiting for the page to finish loading before proceeding, or hard-coding sleeps, or doing blanket wait times (a.k.a. implicit waits). Nay. Now are the wonder years of waiting for a specific element to appear for a specific amount of time and taking an action against it.</p>

<p>And we accomplish this through the use of <strong>explicit waits</strong>.</p>
<h2>An Example</h2>

<p>Let's step through an example that demonstrates this against <a href="http://the-internet.herokuapp.com/dynamic_loading/1">a dynamic page on the-internet</a>. The functionality is pretty simple -- there is a button. When you click it a loading bar appears for 5 seconds, then disappears and gets replaced with the text 'Hello World!'.</p>

<p>Let's start by looking at the markup on the page.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h3&gt;</span>Dynamically Loaded Page Elements<span class="nt">&lt;/h3&gt;</span>
  <span class="nt">&lt;h4&gt;</span>Example 1: Element on page that is hidden<span class="nt">&lt;/h4&gt;</span>

  <span class="nt">&lt;br&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;start&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button&gt;</span>Start<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;finish&quot;</span> <span class="na">style=</span><span class="s">&quot;display:none&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h4&gt;</span>Hello World!<span class="nt">&lt;/h4&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/div&gt;</span>
</pre></div>
<p>At a glance it's simple enough to tell that there are unique <code>id</code> attributes that we can use to reference the start button and finish text.</p>

<p>From here you could do one of two things -- either create a new page object to represent this page and its functionality, or create a quick and dirty test to get your approach down in code. After which, you abstract it out into a page object; adding any necessary common actions to your base page object.</p>

<p>It's really a matter of preference which you choose. For this example I'm going to go with the first approach and dive straight into a page object.</p>
<div class="highlight"><pre><span class="c1"># filename: dynamic_loading.rb</span>

<span class="n">require_relative</span> <span class="s1">'base_page'</span>

<span class="k">class</span> <span class="nc">DynamicLoading</span> <span class="o">&lt;</span> <span class="no">BasePage</span>

  <span class="no">START_BUTTON</span> <span class="o">=</span> <span class="s1">'#start button'</span>
  <span class="no">FINISH_TEXT</span> <span class="o">=</span> <span class="s1">'#finish'</span>

  <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="n">example_number</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">+</span> <span class="s1">'/dynamic_loading/'</span> <span class="o">+</span> <span class="n">example_number</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">start</span>
    <span class="n">click</span> <span class="no">START_BUTTON</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">finish_text_present?</span>
    <span class="n">wait_for</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">{</span> <span class="n">is_displayed?</span> <span class="no">FINISH_TEXT</span> <span class="p">}</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>At the top of the file we require our base page object and set up inheritance when declaring our class so we get the common Selenium actions and access to the driver object. After that we wire up our CSS Selectors in constants and drop in our methods for visiting, starting, and grabbing a boolean for an assertion.</p>

<p><code>visit</code> is set to take an argument because there are actually <a href="http://the-internet.herokuapp.com/dynamic_loading">two dynamic loading examples</a>. But they are both built with the same markup. They just have slightly different behavior and slightly different URLs. So we can actually capture them both in this one page object. And making the <code>visit</code> method take an example number as an argument is the only thing we need to do to accommodate that.</p>

<p>In <code>start</code> and <code>finish_text_present?</code> we are using two methods which have not yet been added to our base page object. One to click an element, and another to wait. So we hop into our base page object and add them to the bottom of the class.</p>
<div class="highlight"><pre><span class="c1"># filename: base_page.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="k">class</span> <span class="nc">BasePage</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="k">def</span> <span class="nf">click</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">seconds</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">timeout</span><span class="p">:</span> <span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p><code>click</code> is simply finding an element and clicking on it. But <code>wait_for</code> is where we are defining our explicit wait.</p>

<p>With <code>wait_for</code> we are accepting an integer for the number of seconds that we would like to wait. If nothing is provided, 2 seconds will be used. We then use this value to tell the explicit wait mechanism that Selenium offers how long to wait, and what to wait for. By using a <code>yield</code> we are able to easily pass in a code block to exercise.</p>

<p>So in our page object when we're using <code>wait_for(6) { is_displayed? FINISH_TEXT }</code> we are telling Selenium to to see if the finish text is displayed. It will keep trying until either it returns <code>true</code> or reaches six seconds and times out -- whichever comes first. This provides a huge benefit to the longer term reliability of our test, because if the behavior on the page takes longer than we expect (e.g. due to slow load times, or a feature change), we can simply adjust this one wait time to fix the test -- rather than increase a blanket wait time (which impacts every test). That, and it's dynamic, so it won't always take the full amount of time.</p>

<p>Now that we have our page object and requisite base page methods we can wire this up in a spec file to test it.</p>
<div class="highlight"><pre><span class="n">require_relative</span> <span class="s1">'dynamic_loading'</span>

<span class="n">describe</span> <span class="s1">'Dynamic Loading'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:dynamic_loading</span><span class="p">)</span> <span class="p">{</span> <span class="no">DynamicLoading</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'Example 1: Hidden Element'</span> <span class="k">do</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">visit_example</span> <span class="s2">&quot;1&quot;</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">start</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">finish_text_present?</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>And when we run it (<code>rspec dynamic_loading_page.rb</code>) it should pass.</p>
<h2>But Wait, There's More</h2>

<p>Remember when I mentioned there were actually two dynamic loading examples? Well, the first one was built to demonstrate a page that has the final result we want already on the page, but hidden until we want it displayed. The second one is the same but slightly different -- the final result we want is not on the page. Instead it gets rendered after the progress bar completes.</p>

<p>Let's see if our approach for the first example holds steady for the second.</p>

<p>Here's the markup for <a href="http://the-internet.herokuapp.com/dynamic_loading/2">the second example</a>.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h3&gt;</span>Dynamically Loaded Page Elements<span class="nt">&lt;/h3&gt;</span>
  <span class="nt">&lt;h4&gt;</span>Example 2: Element rendered after the fact<span class="nt">&lt;/h4&gt;</span>

  <span class="nt">&lt;br&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;start&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button&gt;</span>Start<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
<p>Note that there isn't any finish text on the page. In order to find the selector for the finish text element (or in this case, just double check it) we need to inspect the page after the loading bar sequence finishes. And it looks like this.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;finish&quot;</span> <span class="na">style=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;h4&gt;</span>Hello World!<span class="nt">&lt;/h4&gt;&lt;/div&gt;</span>
</pre></div>
<p>Now that we have that, we can wire up a second test in our spec file.</p>
<div class="highlight"><pre>  <span class="n">it</span> <span class="s1">'Example 2: Renderd after the fact'</span> <span class="k">do</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">visit_example</span> <span class="s2">&quot;2&quot;</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">start</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">finish_text_present?</span>
  <span class="k">end</span>
</pre></div>
<p>And if we run the spec (<code>rspec dynamic_loading_spec.rb</code>) the same approach should work for both cases.</p>

<p>By checking to see if something is displayed (rather than just doing a simple find for an element) we are placed in a better position since Selenium will keep trying for the specified amount of time rather than throwing an exception.</p>
<h3>Browser Timing</h3>

<p>Using explicit waits gets you pretty far. But there are a few things you'll want to think about when it comes to writing your tests to work against various browsers.</p>

<p>It's simple enough to write your tests locally against Firefox and assume you're all set. But once you start to run things against other browsers, you may be in for a rude awakening. The first thing you're likely to run into is the speed of execution. A lot of your tests will start to fail when you point them at either Chrome or Internet Explorer, and likely for different reasons. Let's peel back the onion.</p>

<p>In my experience, Chrome execution is inherently faster, so you will see some odd timeout failures. This is an indicator that you need to add explicit waits to parts of your page objects that don't already have them. And the inverse is true when running things against older version of Internet Explorer (e.g. IE 8). This is an indicator that your explicit wait times are not long enough. The browser is taking longer to respond and so your tests timeout.</p>

<p>The best approach to solve this is an iterative one. Run your tests and find the failures. Take each failed test, tweak your code as needed, and run it against the browsers you care about. Repeat until you make a pass all the way through each of the failed tests. And then run a batch of all your tests to see where they fall down. Repeat until everything's green.</p>
<h1 id="chapter10"><small>Chapter 10</small><br>Prepping For Use</h1>

<p>Now that we have tests, page objects, and a base page object, let's package things into a more useful structure and add the beginnings of our own lightweight framework.</p>
<h2>Global Setup and Teardown</h2>

<p>First we'll need to pull the test setup and teardown actions out of our tests and into a central place. In RSpec this is straight-forward through the use of a 'spec_helper' file.</p>
<div class="highlight"><pre><span class="c1"># filename: spec_helper.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>We need to include the Selenium bindings here, and by doing so, can remove them from our base page object. And by having our test configuration bits here, we can now remove them from our tests -- replacing them with a simple require statement (<code>require_relative 'spec_helper'</code>).</p>
<h2>Base URL</h2>

<p>As for setting our base URL, we want to do two things. First, put it someplace that's a little more configurable. So we'll create a 'config.rb' file and place it there.</p>
<div class="highlight"><pre><span class="c1"># filename: config.rb</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
</pre></div>
<p>And second, we only need to reference the base_url when visiting a page. So rather than have it in each page object, let's create a generic visit action in our base page object and reference that instead.</p>
<div class="highlight"><pre><span class="c1"># filename: base_page.rb</span>

<span class="k">class</span> <span class="nc">BasePage</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="n">url_path</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">+</span> <span class="n">url_path</span><span class="p">)</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>Then it's just a simple matter of updating our existing page objects usage of visit.</p>
<div class="highlight"><pre><span class="c1"># filename: dynamic_loading.rb</span>

<span class="k">def</span> <span class="nf">visit_example</span><span class="p">(</span><span class="n">example_number</span><span class="p">)</span>
   <span class="n">visit</span><span class="p">(</span><span class="s1">'/dynamic_loading/'</span> <span class="o">+</span> <span class="n">example_number</span><span class="p">)</span>
<span class="k">end</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: login.rb</span>

<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="n">driver</span>
  <span class="n">visit</span> <span class="s1">'/login'</span>
  <span class="n">verify_page</span>
<span class="k">end</span>

<span class="c1"># and removed the visit method</span>
</pre></div>
<p>Now instead of each page object having its own visit method, we are leveraging the one in the base page object which accepts the URL path as an argument.</p>
<h2>Folder Organization</h2>

<p>It's about time we create some folders for our specs and page objects. It's only a matter of time until things become cluttered and untenable. To do this, we'll need to update the page object require statements in our tests. To err on the side of simplicity, let's call the folders 'spec' and 'pages'. We are using 'spec' in the singular form since that is an RSpec default.</p>

<p>Here's everything we should have once we implement our new folders:</p>
<div class="highlight"><pre>.
|-- config.rb
|-- Gemfile
|-- pages
|   |-- base_page.rb
|   |-- dynamic_loading.rb
|   <span class="sb">`</span>-- login.rb
<span class="sb">`</span>-- spec
    |-- dynamic_loading_spec.rb
    |-- login_spec.rb
    <span class="sb">`</span>-- spec_helper.rb
</pre></div>
<p>And here are what the updated specs look like.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/login_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'spec_helper'</span>
<span class="n">require_relative</span> <span class="s1">'../pages/login'</span>

<span class="n">describe</span> <span class="s1">'Login'</span> <span class="k">do</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:login</span><span class="p">)</span> <span class="p">{</span> <span class="no">Login</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'successful'</span> <span class="k">do</span>
    <span class="n">login</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s1">'username'</span>
    <span class="n">login</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s1">'password'</span>
    <span class="n">login</span><span class="o">.</span><span class="n">now</span>
    <span class="n">login</span><span class="o">.</span><span class="n">success_message_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'failed'</span> <span class="k">do</span>
    <span class="n">login</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s1">'asdf'</span>
    <span class="n">login</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s1">'asdf'</span>
    <span class="n">login</span><span class="o">.</span><span class="n">now</span>
    <span class="n">login</span><span class="o">.</span><span class="n">failure_message_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: spec/dynamic_loadin_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'spec_helper'</span>
<span class="n">require_relative</span> <span class="s1">'../pages/dynamic_loading'</span>

<span class="n">describe</span> <span class="s1">'Dynamic Loading'</span> <span class="k">do</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:dynamic_loading</span><span class="p">)</span> <span class="p">{</span> <span class="no">DynamicLoading</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'Example 1: Hidden Element'</span> <span class="k">do</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">visit_example</span> <span class="s2">&quot;1&quot;</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">start</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">finish_text_present?</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'Example 2: Renderd after the fact'</span> <span class="k">do</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">visit_example</span> <span class="s2">&quot;2&quot;</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">start</span>
    <span class="n">dynamic_loading</span><span class="o">.</span><span class="n">finish_text_present?</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>Note the use of <code>..</code> in the page object require statement in our specs. This is because we need to traverse up a directory before we can access the page objects folder from our spec directory. And the spec_helper require remains unchanged since this file lives in the spec directory.</p>

<p>Now that things are cleaned up, we can run everything while specifying the config file (<code>rspec --require ./config.rb</code>), and everything should pass.</p>
<h1 id="chapter11"><small>Chapter 11</small><br>Running A Different Browser Locally</h1>

<p>It's straightforward to get your tests running locally against Firefox (that's what we've been doing up until now). But when you want to run them against a different browser like Chrome you quickly run into configuration overhead that can seem overly complex and lacking in code examples.</p>
<h2>A Brief Primer on Browser Drivers</h2>

<p>With the introduction of WebDriver (circa Selenium 2) a lot of benefits were realized (e.g. more effective &amp; faster browser execution, no more single host origin issues, etc). But with it came some architectural &amp; configuration differences that may not be widely known. Namely -- browser drivers.</p>

<p>WebDriver works with each of the major browsers through a browser driver which is (ideally) maintained by the browser manufacturer. It is an executable file (consider it a thin layer or a shim) that acts as a bridge between Selenium and the browser.</p>

<p>Let's step through an example using <a href="https://code.google.com/p/selenium/wiki/ChromeDriver">ChromeDriver</a>.</p>
<h2>An Example</h2>

<p>Before starting, we'll need to <a href="http://chromedriver.storage.googleapis.com/index.html">grab the latest ChromeDriver binary executable from Google</a> and store its unzipped contents with our test code. The simplest thing to do is create a new folder for it (and other things like it). So, we'll create a 'vendor' directory and place it there.</p>

<p>So now our directory tree looks like this:</p>
<div class="highlight"><pre>.
|-- config.rb
|-- Gemfile
|-- pages
|   |-- base_page.rb
|   |-- dynamic_loading.rb
|   <span class="sb">`</span>-- login.rb
|-- spec
|   |-- dynamic_loading_spec.rb
|   |-- login_spec.rb
|   <span class="sb">`</span>-- spec_helper.rb
<span class="sb">`</span>-- vendor
    <span class="sb">`</span>-- chromedriver
</pre></div>
<p>In order for Selenium to use this binary we have to make sure it knows where it is, and there are two ways to do that. We can add this file to the path of our system, or pass in the file path when launching Selenium. Let's do the latter option.</p>

<p>But before we go too far, we want to make it so our test suite can run either Firefox or Chrome. To do that, we need to add a browser environment variable to our 'config.rb' and some conditional logic to our 'spec_helper' file.</p>
<div class="highlight"><pre><span class="c1"># filename: config.rb</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'chrome'</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: spec/spec_helper.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">case</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>
    <span class="k">when</span> <span class="s1">'firefox'</span>
      <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
    <span class="k">when</span> <span class="s1">'chrome'</span>
      <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">::</span><span class="ss">Chrome</span><span class="p">:</span><span class="ss">:Service</span><span class="o">.</span><span class="n">executable_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="p">,</span> <span class="s1">'vendor/chromedriver'</span><span class="p">)</span>
      <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:chrome</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>In the <code>config.before(:each)</code> block of our 'spec_helper' we're keying off of the browser environment variable we set in 'config.rb' and using a conditional to determine which browser driver to load. For Chrome we are first telling Selenium where the chromedriver binary executable is located on disk, and then instantiating it.</p>

<p>Assuming Chrome is already installed on the system (and it's in a standard location) when we run our tests (<code>rspec -r ./config.rb</code>), we should see them execute in Chrome. If that's not the case for you, then check out <a href="https://code.google.com/p/selenium/wiki/ChromeDriver">the ChromeDriver documentation site</a> to see if there are additional requirements for your specific system setup.</p>

<p>It's worth noting that this will only be reasonably performant since it is launching and terminating the chromedriver binary executable before and after every test. There are alternative approaches we can take, but this approach is good enough to see where our tests fall down in Chrome, and this is not the primary method in which our tests will be run a majority of the time.</p>
<h2>Multiple Config Files</h2>

<p>If you want to run Firefox, now all you need to do is update the browser value in 'config.rb'. Alternatively, you can create a second config file and use that at run time. Let's do that.</p>

<p>I'll rename config.rb to config<em>chrome.rb and add a second file called 'config</em>firefox.rb'.</p>
<div class="highlight"><pre><span class="c1"># filename: config_chrome.rb</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'chrome'</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: config_firefox.rb</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'firefox'</span>
</pre></div>
<p>Now all we need to do is change which file we use at runtime. For Firefox, we would use <code>rspec -r ./config_firefox.rb</code> and for Chrome, <code>rspec -r ./config_chrome.rb</code>.</p>

<p>When we're done, our directory tree should look like this:</p>
<div class="highlight"><pre>.
|-- config_chrome.rb
|-- config_firefox.rb
|-- Gemfile
|-- pages
|   |-- base_page.rb
|   |-- dynamic_loading.rb
|   <span class="sb">`</span>-- login.rb
|-- spec
|   |-- dynamic_loading_spec.rb
|   |-- login_spec.rb
|   <span class="sb">`</span>-- spec_helper.rb
<span class="sb">`</span>-- vendor
    <span class="sb">`</span>-- chromedriver
</pre></div><h2>Additional Browsers</h2>

<p>A similar approach can be applied to other browser drivers, with the only real limitation being the operating system you're running. But remember -- no two browser drivers are alike, so be sure to check out the documentation for the browser you care about to find out its specific requirements:</p>

<ul>
<li><a href="https://code.google.com/p/selenium/wiki/ChromeDriver">ChromeDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/FirefoxDriver">FirefoxDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/InternetExplorerDriver">InternetExplorer Driver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/OperaDriver">OperaDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/SafariDriver">SafariDriver</a></li>
</ul>
<h1 id="chapter12"><small>Chapter 12</small><br>Running Browsers In The Cloud</h1>

<p>If you've ever needed to test features in an older browser like Internet Explorer 6 then odds are you ran a virtual machine (VM) on your computer with a &quot;legit&quot; version of Windows XP.</p>

<p>Handy, but what happens when you need to check things on multiple versions of IE? Now you're looking at multiple VMs. And what about when you need to scale and cover other browser and Operating System (OS) combinations? Now you're looking at provisioning, running, and maintaining your own farm of machines and standing up something like Selenium Grid to coordinate tests across them.</p>

<p>And all you wanted to do was run your tests on the browsers you cared about...</p>

<p>Rather than take on the overhead of a test infrastructure you can easily outsource things to a third-party cloud provider. There are a handful of players in this space, but there's one that stands out -- Sauce Labs.</p>
<h2>Why Sauce Labs?</h2>

<p>They don't stand out because they enable you to run your tests on pretty much every browser/OS/platform combination. Or because they have great test reporting (like screenshots AND video recordings of your tests). Or for any of the other <a href="https://saucelabs.com/features">killer features they have</a>.</p>

<p>They stand out because they're not just building something to sell. They work hard to help make the Selenium Community (and open source software) better. And it's through their contributions that they are able to discern what to build -- so it's something that is attuned to the needs of the community.</p>
<h2>A brief primer on Selenium Remote, Selenium Grid, and Sauce Labs</h2>

<p>At the heart of Selenium at scale is the use of Selenium Grid and Selenium Remote. Selenium Grid lets you distribute test execution across several machines and you connect to it with Selenium Remote -- specifying the browser type and version through the use of Selenium Remote's <code>Capabilities</code>.</p>

<p>This is fundamentally how Sauce Labs works. Behind the curtain they are ultimately running Selenium Grid, and they receive and execute your tests through Selenium Remote -- knowing which browser and operating system to use because of the <code>Capabilities</code> specified.</p>

<p>Let's dig in with an example.</p>
<h2>An Example</h2>

<p><strong>NOTE: You'll need an account to use Sauce Labs. Their free one offers enough to get you started. And if you're signing up because you want to test an open source project, then be sure to give <a href="https://saucelabs.com/opensauce">their 'Open Sauce' account</a> a look.</strong></p>

<p>With Sauce Labs we need to provide specifics about what we want in our test environment, our credentials, and configure Selenium a little bit differently than we have been. Let's start by creating a new config file ('config_cloud.rb').</p>
<div class="highlight"><pre><span class="c1"># filename: config_cloud.rb</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span>         <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span>             <span class="o">=</span> <span class="s1">'saucelabs'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'Windows XP'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>          <span class="o">=</span> <span class="s1">'internet_explorer'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'8'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'sauce_username'</span><span class="o">]</span>   <span class="o">=</span> <span class="s1">'your_username'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'sauce_access_key'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'your_api_key'</span>
</pre></div>
<p>Notice the use of a host variable. This is what we'll use in our 'spec_helper' file to determine whether to run things locally or in the cloud. That means we'll need to add a host variable to our local configs as well.</p>
<div class="highlight"><pre><span class="c1"># filename: config_firefox.rb</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span>     <span class="o">=</span> <span class="s1">'localhost'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'firefox'</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: config_chrome.rb</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span>     <span class="o">=</span> <span class="s1">'localhost'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'chrome'</span>
</pre></div>
<p>Now that we have that sorted, let's update our 'spec_helper' file.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">case</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span>
    <span class="k">when</span> <span class="s1">'localhost'</span>
      <span class="k">case</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>
      <span class="k">when</span> <span class="s1">'firefox'</span>
        <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
      <span class="k">when</span> <span class="s1">'chrome'</span>
        <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">::</span><span class="ss">Chrome</span><span class="p">:</span><span class="ss">:Service</span><span class="o">.</span><span class="n">executable_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="p">,</span> <span class="s1">'vendor/chromedriver'</span><span class="p">)</span>
        <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:chrome</span>
      <span class="k">end</span>
    <span class="k">when</span> <span class="s1">'saucelabs'</span>
      <span class="n">caps</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">::</span><span class="ss">Remote</span><span class="p">:</span><span class="ss">:Capabilities</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span><span class="p">)</span>
      <span class="n">caps</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span>
      <span class="n">caps</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span>
      <span class="n">caps</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">metadata</span><span class="o">[</span><span class="ss">:full_description</span><span class="o">]</span>

      <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
        <span class="ss">:remote</span><span class="p">,</span>
        <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">&quot;http://</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'sauce_username'</span><span class="o">]</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'sauce_access_key'</span><span class="o">]</span><span class="si">}</span><span class="s2">@ondemand.saucelabs.com:80/wd/hub&quot;</span><span class="p">,</span>
        <span class="ss">:desired_capabilities</span> <span class="o">=&gt;</span> <span class="n">caps</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>We've taken our original conditional and made it nested underneath a check for the host environment variable. If the host is set to 'localhost', then we check the browser type and execute things accordingly. If the host is set to 'saucelabs' then we configure the capabilities for Selenium Remote, passing in the requisite informaiton that we will need for our Sauce Labs session.</p>

<p>The actual username and API key have been omitted from this example. To make this work, simply add yours in to the 'config_cloud.rb' file.</p>

<p>There are a few things in this example that may be worth elaborating on.</p>

<p>First, we are using some metaprogramming when we are instantiating <code>Selenium::WebDriver::Remote::Capabilities</code>. We are using the <code>.send</code> method to pass in the environment variable. The value of which, in this case, is the same name as the method to configure Selenium Remote to use Internet Explorer. So, we are in effect, creating <code>Selenium::WebDriver::Remote::Capabilitites.internet_explorer</code>. And if we were to change <code>ENV['browser']</code> to 'chrome', then it would give us <code>Selenium::WebDriver::Remote::Capabilities.chrome</code>.</p>

<p>Second, for <code>caps[:name]</code> we are using an available hook in RSpec that gives us the name of each test as it is being run. This will make it so each individual job that executes in Sauce Labs will have the name of your test.</p>

<p>Third, for the <code>:url =&gt;</code> line in our <code>@driver</code> instantiation, we are injecting our environment variable through the use of string interpolation. This is why we are using double-quoted strings. If they were single-quotes then we wouldn't be able to do it.</p>

<p>Now if we run our test suite (<code>rspec -r ./config_cloud.rb</code>) and navigate to <a href="https://saucelabs.com/account">our Sauce Labs Account page</a> then we should see each of the tests running in their own job, with proper names, against Internet Explorer 8.</p>
<h2>Test Status</h2>

<p>The only thing missing now is the pass/fail status of the job. In our local terminal window everything should be coming up green. But in the list of our Sauce jobs, the 'Results' panel for everything just says 'Finished'. This will make our results less useful in the long run so let's fix it.</p>

<p>And thanks to Sauce Labs' 'sauce_whisk' library, it's really simple to do.</p>

<p>After we install it we will need to require it somewhere, and our 'config_cloud.rb' file seems like a logical place. Also, we'll need to adjust our Sauce credential environment variables slightly since the library expects them to be capitalized.</p>
<div class="highlight"><pre><span class="c1"># filename: config_cloud.rb</span>

<span class="nb">require</span> <span class="s1">'sauce_whisk'</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span>         <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span>             <span class="o">=</span> <span class="s1">'saucelabs'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'Windows XP'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>          <span class="o">=</span> <span class="s1">'internet_explorer'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'8'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_USERNAME'</span><span class="o">]</span>   <span class="o">=</span> <span class="s1">'the-internet'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_ACCESS_KEY'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'26bd4eac-9ef2-4cf0-a6e0-3b7736bd5359'</span>
</pre></div>
<p>All that's left is to add an action to our <code>after(:each)</code> block in our 'spec_helper' file. Before we issue <code>@driver.quit</code> we will want to grab the job ID from our <code>@driver</code> object and set the job status based on the test result. Also, we'll want to make sure that it only executes when running tests against Sauce Labs -- so we'll want to wrap it in a conditional check against the host environment variable.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/spec_helper.rb</span>
<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'saucelabs'</span>
      <span class="k">if</span> <span class="n">example</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">nil?</span>
        <span class="ss">SauceWhisk</span><span class="p">:</span><span class="ss">:Jobs</span><span class="o">.</span><span class="n">pass_job</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">session_id</span>
      <span class="k">else</span>
        <span class="ss">SauceWhisk</span><span class="p">:</span><span class="ss">:Jobs</span><span class="o">.</span><span class="n">fail_job</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">session_id</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>Now when we run our tests (<code>rspec -r ./config_cloud.rb</code>) and navigate to <a href="https://saucelabs.com/account">our Sauce Labs Account page</a>, we should see our tests running like before -- but now when they finish there should be a boolean result (e.g. 'Pass' or 'Fail').</p>
<h2>Accessing Secure Apps</h2>

<p>There are various ways that companies make their pre-production application available for testing. Some make it available thorugh an obscure public URL and protect it with some form of authentication (e.g. Basic Auth, or cert based authentication). Others keep it hidden behind their firewall.</p>

<p>For those in the camp that stay behind a firewall, Sauce Labs has got you covered. They have a program called <a href="https://saucelabs.com/docs/connect">Sauce Connect</a> that creates a secure tunnel between your machine and their cloud. With it, you can run tests in Sauce Labs and still have them reach the apps that are only available on your network.</p>

<p>In Ruby there are two ways to leverage Sauce Connect; a separate download, or through another one of Sauce's Ruby libraries -- 'sauce-connect'.</p>

<p>Let's step through an example using the 'sauce-connect' library.</p>
<h2>An Example</h2>

<p>First we'll need to install the sauce-connect library. Once we have that we'll want to create a new config file for this since there will be some differences (e.g. base<em>url, specifying a tunnel value, etc). So lets' create one called 'config</em>cloud_tunnel.rb'.</p>
<div class="highlight"><pre><span class="c1"># filename: config_cloud_tunnel.rb</span>

<span class="nb">require</span> <span class="s1">'sauce_whisk'</span>
<span class="nb">require</span> <span class="s1">'sauce'</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span>         <span class="o">=</span> <span class="s1">'http://the-internet-local:4567'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span>             <span class="o">=</span> <span class="s1">'saucelabs'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'Windows XP'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>          <span class="o">=</span> <span class="s1">'internet_explorer'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'8'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_USERNAME'</span><span class="o">]</span>   <span class="o">=</span> <span class="s1">'the-internet'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_ACCESS_KEY'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'26bd4eac-9ef2-4cf0-a6e0-3b7736bd5359'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'tunnel'</span><span class="o">]</span>
</pre></div>
<p>Compared to our previous cloud configuration, this one is slightly different.</p>

<p>In addition to the 'sauce_whisk' library we are requiring 'sauce'. And we're doing this instead of requiring 'sauce-connect' because 'sauce-connect' is not built to be required. But since it is a subset of the 'sauce' library, we can include that instead and get access to the functionality that we will need.</p>

<p>At the bottom of the file we are including a tunnel environment variable. We only need this variable to exist, it doesn't have to contain a value. And we don't need it to exist in the other config files.</p>

<p>And notice that our base_url is different. It's set to <code>the-internet-local:4567</code>. This is because we're going to be run a copy of 'the-internet' locally. To do that we'll first need to download and upzip a copy of the master branch from <a href="https://github.com/tourdedave/the-internet">its GitHub repo</a> and place it in 'vendor/the-internet'.</p>

<p>In order to take advantage of this we need to update our local hosts file to map 127.0.0.1 to a DNS helper name ('the-internet-local' in this case). This is so our tests running Sauce Labs will be able to find our local server. If we just provide 'localhost' or 127.0.0.1, it won't work (as noted in <a href="http://support.saucelabs.com/entries/20912606-Localhost-ports-for-Sauce-Connect">this Sauce Support post</a>. Updating the hosts file varies depending on your operating system. So if you're not sure how to do it, or what that means, then <a href="http://www.howtogeek.com/howto/27350/">read this</a>.</p>

<p>Now that we have that sorted, we can open a new terminal window, navigate into the 'vendor/the-internet' directory, and start the app (<code>ruby server.rb</code>) -- which will fire up on port 4567.</p>

<p>All that's left to do now is tell RSpec how to connect and disconnect from the tunnel -- and we can do that in our 'spec_helper' file.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/spec_helper.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span> <span class="k">do</span>
    <span class="ss">Sauce</span><span class="p">:</span><span class="ss">:Connect</span><span class="o">.</span><span class="n">connect</span> <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'tunnel'</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span> <span class="k">do</span>
    <span class="ss">Sauce</span><span class="p">:</span><span class="ss">:Connect</span><span class="o">.</span><span class="n">connect</span> <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'tunnel'</span><span class="o">]</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>We're effectively telling RSpec to start the tunnel before all of our tests, and close it down after they are all done. And in order to make sure this only occurs when we intend to use Sauce Connect we add a conditional that keys off of the tunnel environment variable, which only exists in our 'config<em>cloud</em>tunnel.rb' file.</p>

<p>Now if we run our tests (<code>rspec -r ./config_cloud_tunnel.rb</code>) it will connect the tunnel and run the tests in Sauce which will then connect and exercise our local app.</p>
<h2>A small bit of clean-up</h2>

<p>One by-product of this setup is that a 'sauce_connect.log' file will get outputted into our root directory. We won't really end up using it, nor is it easily configurable to suppress or move it to a different location. So we can choose to ignore it by adding it to our ignore file (which is '.gitignore' in my case) so that it doesn't get pushed up into version control.</p>
<div class="highlight"><pre><span class="c1"># filename: .gitignore</span>

<span class="o">*.</span><span class="n">log</span>
</pre></div>
<p>This leaves our directory tree structure looking like this:</p>
<div class="highlight"><pre>.
|-- config_chrome.rb
|-- config_cloud.rb
|-- config_cloud_tunnel.rb
|-- config_firefox.rb
|-- Gemfile
|-- pages
|   |-- base_page.rb
|   |-- dynamic_loading.rb
|   <span class="sb">`</span>-- login.rb
|-- spec
|   |-- dynamic_loading_spec.rb
|   |-- login_spec.rb
|   <span class="sb">`</span>-- spec_helper.rb
<span class="sb">`</span>-- vendor
    |-- chromedriver
    <span class="sb">`</span>-- the-internet/
</pre></div><h1 id="chapter13"><small>Chapter 13</small><br>Speeding Up Your Test Runs</h1>

<p>It's great that we can easily run our tests in Sauce Labs. But it's a real bummer that all of our tests are executing in series. As our suite grows, things will quickly start to add up and really hamper our ability to get feedback quickly.</p>

<p>But with parallelization we can quickly remedy this. And in Ruby, there is a library that makes this easy to accomplish -- and that's 'parallel_tests'. After we install it all we need to do is change how we execute our test runs. And that's done through the use of the executable command that the library has installed for use with RSpec -- <code>parallel_rspec</code>.</p>

<p><code>parallel_rspec</code> is effectively a wrapper around RSpec. It's responsible for breaking our spec files out into groups and launching each of them in separate system processes along with any arguments we pass in. So if we run <code>parallel_rspec --test-options '-r ./config_cloud.rb' spec</code> our tests will execute in Sauce Labs, except this time they will be running in parallel -- finishing much faster than previous runs.</p>

<p>Notice that we have to pass in <code>--test-options</code> and then our normal RSpec arguments (<code>-r ./config_cloud.rb</code>), along with where our specs live (<code>specs</code>). It can be a little verbose, but this is a necessary evil with this library.</p>

<p>The default <code>parallel_rspec</code> will launch our tests in two processes. We can increase this number by passing an additional argument of <code>-n</code> and the number of processes that we want -- e.g. <code>-n 5</code>. But keep in mind that the actual number of parallel processes that get spawned depends on how many spec files there are (since this library works at the file level). So for now, two processes is all we'll get. But as our suite grows, increasing our number of processes will yield a huge performance improvement.</p>

<p>And it's worth noting that Sauce Labs is built to handle test execution in parallel. You just need to be cogniscent of how many parallel sessions your account is set up to handle (e.g. three for Sauce Open accounts).</p>
<h2>Randomizing</h2>

<p>A great way to make sure your tests are truly atomic and to potentially ferret out anomalies in your application under test is to run your tests in a random order. Within RSpec this is an easy thing to accomplish. It's just another command-line argument to pass in on test execution <code>--order random</code>.</p>

<p>Now our test launch sequence looks like this:</p>
<div class="highlight"><pre><span class="n">parralel_rspec</span> <span class="o">--</span><span class="nb">test</span><span class="o">-</span><span class="n">options</span> <span class="s1">'-r ./config_cloud.rb --order random'</span>
</pre></div>
<p>That's a lot to remember and type out every time we want to run our tests. Let's clean things up with some simple Rake tasks.</p>
<h2>Rake Tasks</h2>

<p>Rake is a simple library in Ruby that enables us to capture and run repetitive tasks.</p>

<p>To set it up, we just need to install the library, add a 'Rakefile', and fill it in with our tasks.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>

<span class="nb">require</span> <span class="s1">'rake'</span>

<span class="k">def</span> <span class="nf">launch_in_parallel</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;parallel_rspec --test-options '--require </span><span class="si">#{</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">config_file</span><span class="si">}</span><span class="s2"> --order random' spec&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">desc</span> <span class="s1">'Run tests locally in parallel'</span>
<span class="n">task</span> <span class="ss">:local</span><span class="p">,</span> <span class="ss">:browser</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
  <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s2">&quot;config_</span><span class="si">#{</span><span class="n">args</span><span class="o">[</span><span class="ss">:browser</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">desc</span> <span class="s2">&quot;Run tests in Sauce in parallel&quot;</span>
<span class="n">task</span> <span class="ss">:cloud</span> <span class="k">do</span>
  <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config_cloud.rb'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">desc</span> <span class="s2">&quot;Run tests in Sauce Connect in parallel&quot;</span>
<span class="n">task</span> <span class="ss">:cloud_tunnel</span> <span class="k">do</span>
  <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config_cloud_tunnel.rb'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
<p>The first thing to note is that this looks very similar to a standard Ruby file. We are requiring a library ('rake') and declaring a method. The rest is what's a little bit different. Task declaration in Rake has its own Domain Specific Language which reads similar to Ruby code. For more of a primer on Rake, check out <a href="http://jasonseifer.com/2010/04/06/rake-tutorial">this tutorial</a>.</p>

<p>In our <code>launch_in_parallel</code> method we pulled out the executor string, wrapped it in a <code>system</code> command to launch it, and made it configurable by adding an argument for the config file (injecting it into the string with interpolation). This keep our tasks clean by removing redundancy and makes them more flexible to change if we have additional arguments we want to start using with RSpec.</p>

<p>The only task that's different is <code>local</code>. In it we are taking a browser as an additional argument. This enables us to only have one task for local runs, switching between the local configs we have for each browser.</p>

<p>If we save this file, close it, and run <code>rake -T</code> from our terminal window, we should see a list of our available Rake actions.</p>
<div class="highlight"><pre>rake cloud                    <span class="c"># Run tests in Sauce in parallel</span>
rake cloud_tunnel             <span class="c"># Run tests in Sauce Connect in parallel</span>
rake <span class="nb">local</span><span class="o">[</span>browser<span class="o">]</span>           <span class="c"># Run tests locally in parallel</span>
</pre></div>
<p>And to run one (e.g. <code>rake local['firefox']</code>) then it should run everything in parallel, in random order, and the tests should all pass.</p>

<p>The same pattern applied to our local runs (for browser selection) can easily be done for our cloud configuration as well. It's just a simple matter of updating our Rakefile cloud tasks, adding additional config files as needed.</p>
<h1 id="chapter14"><small>Chapter 14</small><br>Automating Your Test Runs</h1>

<p>You'll probably get a lot of mileage out of your test suite in its current form if you just run things from your computer, look at the results, and inform people when there are issues. But that will only help you solve part of the problem.</p>

<p>The real goal in all of this is to find issues reliably and quickly. We've built things reliably, now we need to make them run quickly -- and ideally in sync with the development workflow you are a part of. And in order to do that, we will want to use a Continuous Integration (CI) server.</p>
<h2>A primer on Continuous Integration</h2>

<p>Continous Integration (a.k.a. CI) is the practice of merging code that is actively being worked on into a shared mainline (e.g. trunk or master) as often as possible (e.g. several times a day) with the hopes of finding issues early and avoiding merging and integration issues which are not only considered a special kind of hell, but can dramatically slow the time it takes to release software.</p>

<p>The use of a CI server (a.k.a. build server) enables this practice to be automated, and to have tests run as part of the work flow. The lion's share of tests that are typically run on a CI Server are unit (and potentially integration) tests. But we can very easily add in our automated acceptance tests.</p>

<p>There are numerous CI Servers available for use today, most notably -- <a href="http://en.wikipedia.org/wiki/Bamboo_(software">Bamboo</a>, <a href="http://en.wikipedia.org/wiki/Jenkins_(software">Jenkins</a>, and <a href="http://en.wikipedia.org/wiki/Travis_CI">TravisCI</a>.</p>
<h2>Tagging</h2>

<p>In order to get the most out of our test runs in a CI environment, we will want to break up our test suite into small, relevant chunks and have separate jobs for each. This will help keep test runs fast (so people on your team will care about them) and informative. <a href="http://gojko.net/2011/05/16/setting-up-a-build-pipeline-in-a-legacy-environment/">Gojko Adzic refers to these as 'Test Packs'</a>.</p>

<p>The workflow is pretty straightforward. The CI Server pulls the latest code, merges it, and runs unit tests. We can then have the CI Server execute another job to run a subset of our acceptance tests -- our critical ones (e.g. smoke or sanity tests). And assuming those pass, then we can have another job run the remaining tests -- our longer running tests. <a href="https://github.com/adamgoucher/rspec-selenium-pageobjects#tags">Adam Goucher refers to this strategy as a 'shallow' and 'deep' tagging model</a>.</p>

<p>To demonstrate this, let's tag our tests and update our rake tasks to use them.</p>
<h2>A Tagging Example</h2>

<p>RSpec comes built in with tagging support. It's a simple matter of adding a key and value to denote what you want. And you can place it on individual tests, or a group of tests. And you can use as many tags as you want, separating them with commas. So let's add some to our specs -- following Adam Goucher's shallow and deep approach.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/dynamic_loading_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'spec_helper'</span>
<span class="n">require_relative</span> <span class="s1">'../pages/dynamic_loading'</span>

<span class="n">describe</span> <span class="s1">'Dynamic Loading'</span><span class="p">,</span> <span class="ss">depth</span><span class="p">:</span> <span class="s1">'deep'</span> <span class="k">do</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: spec/login_spec.rb</span>
<span class="n">require_relative</span> <span class="s1">'spec_helper'</span>
<span class="n">require_relative</span> <span class="s1">'../pages/login'</span>

<span class="n">describe</span> <span class="s1">'Login'</span><span class="p">,</span> <span class="ss">depth</span><span class="p">:</span> <span class="s1">'shallow'</span> <span class="k">do</span>
</pre></div>
<p>If we wanted to apply them directly to a test, then we could have done the following instead:</p>
<div class="highlight"><pre><span class="n">it</span> <span class="s1">'successful'</span><span class="p">,</span> <span class="ss">depth</span><span class="p">:</span> <span class="s1">'shallow'</span> <span class="k">do</span>
</pre></div>
<p>Now to run our tests and take advantage of these tags we just need to pass along <code>--tag</code> and the key:value information when we run our tests (e.g. <code>--tag depth:shallow</code> or <code>--tag depth:deep</code>).</p>

<p>Let's update one of our 'Rakefile' tasks to demonstrate how to do this.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>

<span class="nb">require</span> <span class="s1">'rake'</span>

<span class="k">def</span> <span class="nf">launch_in_parallel</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">tags</span>
    <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;parallel_rspec --test-options '--require </span><span class="si">#{</span><span class="n">config_file</span><span class="si">}</span><span class="s2"> --order random --tag </span><span class="si">#{</span><span class="n">tags</span><span class="si">}</span><span class="s2">' spec&quot;</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;parallel_rspec --test-options '--require </span><span class="si">#{</span><span class="n">config_file</span><span class="si">}</span><span class="s2"> --order random' spec&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">desc</span> <span class="s1">'Run tests locally in parallel'</span>
<span class="n">task</span> <span class="ss">:local</span><span class="p">,</span> <span class="ss">:browser</span><span class="p">,</span> <span class="ss">:tags</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
  <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="si">}</span><span class="s2">/config_</span><span class="si">#{</span><span class="n">args</span><span class="o">[</span><span class="ss">:browser</span><span class="o">]</span><span class="si">}</span><span class="s2">.rb&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">[</span><span class="ss">:tags</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
<p>By updating our <code>launch_in_parallel</code> method to take a second argument for tags, we are able to add a conditional to alter our execution string based on whether or not tags are passed in.</p>

<p>In our rake task, we add an additional argument to consume tags, passing it in when we call <code>launch_in_parallel</code>. And as a matter of cleanup, we've pulled the <code>Dir.pwd</code> incantation down to the rake task.</p>

<p>Now when we run <code>rake -T</code> we should see the following:</p>
<div class="highlight"><pre>rake cloud                       <span class="c"># Run tests in Sauce in parallel</span>
rake cloud_tunnel                <span class="c"># Run tests in Sauce Connect in parallel</span>
rake <span class="nb">local</span><span class="o">[</span>browser,tags<span class="o">]</span>         <span class="c"># Run tests locally in parallel</span>
</pre></div>
<p>Now we can run our tests locally both with and without tags against the browsers we've configured -- e.g. <code>rake local['chrome','depth:shallow']</code> or <code>rake local['firefox','depth:deep']</code>.</p>

<p>The same pattern can be applied to our cloud tasks. So while we're in here, let's do that, and also make additional configs for them as well.</p>

<p>The first thing we should do is create a 'configs' directory and move our configs there. This way our root folder doesn't get cluttered and our approach becomes more manageable. Once we have that, we can create additional cloud configs for both cloud and cloud_tunnel.</p>

<p>And since we now have multiple Sauce Labs files, we should abstract out our access credentials into a separate config.</p>
<div class="highlight"><pre><span class="c1"># filename: configs/config_sauce.rb</span>

<span class="nb">require</span> <span class="s1">'sauce_whisk'</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_USERNAME'</span><span class="o">]</span>   <span class="o">=</span> <span class="s1">'the-internet'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_ACCESS_KEY'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'26bd4eac-9ef2-4cf0-a6e0-3b7736bd5359'</span>
</pre></div>
<p>We can safely move the require statement for our 'sauce_whisk' library here. But we'll want to keep the require for the 'sauce' library in the tunnel specific configs. Otherwise it will trigger the tunnel when we don't intend to.</p>

<p>Next we need to update all of our cloud and cloud<em>tunnel configs to require our config</em>sauce file and remove the environment variables for <code>SAUCE_USERNAME</code> and <code>SAUCE_ACCESS_KEY</code>.</p>

<p>Here's what a config_cloud file should look like:</p>
<div class="highlight"><pre><span class="c1"># filename: configs/config_cloud_firefox.rb</span>

<span class="n">require_relative</span> <span class="s1">'config_sauce'</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span>         <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span>             <span class="o">=</span> <span class="s1">'saucelabs'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'Windows XP'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>          <span class="o">=</span> <span class="s1">'firefox'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'23'</span>
</pre></div>
<p>And here's what a config<em>cloud</em>tunnel file should look like:</p>
<div class="highlight"><pre><span class="n">require_relative</span> <span class="s1">'config_sauce'</span>
<span class="nb">require</span> <span class="s1">'sauce'</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span>         <span class="o">=</span> <span class="s1">'http://the-internet-local:4567'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span>             <span class="o">=</span> <span class="s1">'saucelabs'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'Windows XP'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>          <span class="o">=</span> <span class="s1">'firefox'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'23'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'tunnel'</span><span class="o">]</span>
</pre></div>
<p>And we can rename our local config files to make it obvious that they are meant for local runs.</p>

<p>When we're done, here is what our final directory structure should look like:</p>
<div class="highlight"><pre>.
|-- configs
|   |-- config_cloud_firefox.rb
|   |-- config_cloud_internet_explorer.rb
|   |-- config_cloud_tunnel_firefox.rb
|   |-- config_cloud_tunnel_internet_explorer.rb
|   |-- config_local_chrome.rb
|   |-- config_local_firefox.rb
|   <span class="sb">`</span>-- config_sauce.rb
|-- Gemfile
|-- pages
|   |-- base_page.rb
|   |-- dynamic_loading.rb
|   <span class="sb">`</span>-- login.rb
|-- Rakefile
|-- spec
|   |-- dynamic_loading_spec.rb
|   |-- login_spec.rb
|   <span class="sb">`</span>-- spec_helper.rb
<span class="sb">`</span>-- vendor
    |-- chromedriver
    <span class="sb">`</span>-- the-internet/
</pre></div>
<p>And now we just need to update the tasks in our 'Rakefile'.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>

<span class="n">desc</span> <span class="s1">'Run tests locally in parallel'</span>
<span class="n">task</span> <span class="ss">:local</span><span class="p">,</span> <span class="ss">:browser</span><span class="p">,</span> <span class="ss">:tags</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
  <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="si">}</span><span class="s2">/configs/config_local_</span><span class="si">#{</span><span class="n">args</span><span class="o">[</span><span class="ss">:browser</span><span class="o">]</span><span class="si">}</span><span class="s2">.rb&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">[</span><span class="ss">:tags</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">desc</span> <span class="s2">&quot;Run tests in Sauce in parallel&quot;</span>
<span class="n">task</span> <span class="ss">:cloud</span><span class="p">,</span> <span class="ss">:browser</span><span class="p">,</span> <span class="ss">:tags</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
  <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="si">}</span><span class="s2">/configs/config_cloud_</span><span class="si">#{</span><span class="n">args</span><span class="o">[</span><span class="ss">:browser</span><span class="o">]</span><span class="si">}</span><span class="s2">.rb&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">[</span><span class="ss">:tags</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">desc</span> <span class="s2">&quot;Run tests in Sauce Connect in parallel&quot;</span>
<span class="n">task</span> <span class="ss">:cloud_tunnel</span><span class="p">,</span> <span class="ss">:browser</span><span class="p">,</span> <span class="ss">:tags</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
  <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="si">}</span><span class="s2">/configs/config_cloud_tunnel_</span><span class="si">#{</span><span class="n">args</span><span class="o">[</span><span class="ss">:browser</span><span class="o">]</span><span class="si">}</span><span class="s2">.rb&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">[</span><span class="ss">:tags</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
<p>By having a consistent naming convention across our config files we can easily concatenate the config file name by using the browser provided as an argument in the rake task and apply this pattern across all of our rake tasks.</p>

<p>So now when we run <code>rake -T</code> we get the following:</p>
<div class="highlight"><pre>rake cloud<span class="o">[</span>browser,tags<span class="o">]</span>         <span class="c"># Run tests in Sauce in parallel</span>
rake cloud_tunnel<span class="o">[</span>browser,tags<span class="o">]</span>  <span class="c"># Run tests in Sauce Connect in parallel</span>
rake <span class="nb">local</span><span class="o">[</span>browser,tags<span class="o">]</span>         <span class="c"># Run tests locally in parallel</span>
</pre></div>
<p>Now we're able to easily run our tests against the browsers we care about locally, in the cloud, or in the cloud across a secure tunnel with the use of tags.</p>
<h2>A More Configurable Base URL</h2>

<p>But there's still one thing we're missing -- the ability to easily specify a base URL without having to update our configs. You will likely have multiple base URLs to test against, so having multiple config permutations or updating files all the time feels a bit heavy. And it's a simple fix, so let's add it.</p>

<p>We just need to update the base_url environment variable instantiation in our config files so they are open to receiving alternative input. Here's what it looks like:</p>
<div class="highlight"><pre><span class="c1"># filename: configs/config_cloud_internet_explorer.rb</span>

<span class="n">require_relative</span> <span class="s1">'config_sauce'</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span>         <span class="o">||=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>By adding a <code>||</code> in front of the <code>=</code> we are effectively saying &quot;if the base<em>url environment variable already exists then use it, otherwise, let's set it to this instead&quot;. So now when we run our tests we have the option of overriding our base</em>url without having to update our configs -- <code>rake cloud['internet_explorer'] base_url='http://the-internet-staging.heroku-app.com'</code></p>

<p>While there are more sophisticated approaches we can take to handle our configs, this one is simple and has everything nailed down and obvious for others to see and use.</p>
<h2>Reporting</h2>

<p>In order to make our test output useful for a CI Server we will need to generate it in a standard way. One format that works across most CI Servers is JUnit XML.</p>

<p>Let's implement it in our test harness.</p>
<h2>A JUnit XML Example</h2>

<p>This functionality doesn't come built into RSpec, but it's simple enough to add through the use of a third-party library. There are plenty to choose from, but we'll go with <a href="https://github.com/sj26/rspec_junit_formatter">'rspec<em>junit</em>formatter'</a>.</p>

<p>After we have it installed we need to specify the formatter type and the output file we want. This is done through the use of two new arguments during test execution -- <code>--format RspecJunitFormatter</code> and <code>--out results.xml</code>.</p>

<p>Let's update our Rakefile to use these.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>

<span class="nb">require</span> <span class="s1">'rake'</span>

<span class="k">def</span> <span class="nf">launch_in_parallel</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">tags</span>
    <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;parallel_rspec --test-options '--require </span><span class="si">#{</span><span class="n">config_file</span><span class="si">}</span><span class="s2"> --order random --tag </span><span class="si">#{</span><span class="n">tags</span><span class="si">}</span><span class="s2"> --format RspecJunitFormatter --out results.xml' spec&quot;</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;parallel_rspec --test-options '--require </span><span class="si">#{</span><span class="n">config_file</span><span class="si">}</span><span class="s2"> --order random --format RspecJunitFormatter --out results.xml' spec&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>Now when we run our tests, we should see a results.xml file in our root folder. It should contain a bunch of info the tests ran. This is what our CI server will use to track test passes, failures, time to complete, and trend it over time.</p>

<p>But we don't want to commit this file to our repository, so let's add it to our ignore file.</p>
<div class="highlight"><pre><span class="cp"># filename: .gitignore</span>

<span class="o">*</span><span class="p">.</span><span class="n">log</span>
<span class="o">*</span><span class="p">.</span><span class="n">xml</span>
</pre></div>
<p>Now we're ready to wire things up to our CI Server.</p>
<h2>A Primer On CI Server Job Configuration</h2>

<p>The first things you'll need to do (assuming you already have a CI Server setup) is to create a job, name it appropriately (e.g. 'Shallow Tests IE8'), and configure it to meet the needs of you and your team.</p>

<p>If your team already uses Jenkins and has a job that runs unit or integration tests, you can configure your job to key off of that one -- e.g. if the unit tests pass, then run your shallow tests. This is ideal since their job is already tightly coupled to their workflow (e.g. triggering every time code is pushed to the mainline), or some kind of time delayed polling (e.g. see if new code was pushed every 5 minutes). This means code is compiled and tests are run often. So by keying your job off of theirs, you are plugging your test suite directly into the development workflow. This is why running shallow tests to start is important -- we want only fast and critical tests to run.</p>

<p>If this is not how things are set up, then look to set up your own polling mechanism for the codebase so that your tests can be coupled to their workflow.</p>

<p>You can also setup scheduled runs for different times of the day or week. But these are more ideal for longer running tests to run at off hours.</p>

<p>Let's take a look at some examples.</p>
<h2>A Jenkins Example</h2>

<p>Coming soon...</p>
<h2>A TravisCI Example</h2>

<p>Coming soon...</p>
<h1 id="chapter15"><small>Chapter 15</small><br>Things You will See And How To Work With Them</h1>

<p>The examples in this section aim to give you a glimpse at things you will see in the wild, and a reference for to deal with them.</p>

<p>They will not build upon previous examples like the earlier parts of this book. But instead, serve as standalone works that can be consumed individually -- and alphabetically.</p>

<p>Enjoy!</p>
<h1 id="chapter15_1"><small>Chapter 15.1</small><br>A/B Testing</h1>

<p>Sometimes when running tests you may hit unexpected behavior due to <a href="http://en.wikipedia.org/wiki/A/B_testing">A/B testing</a> being done in the application you're working with.</p>

<p>In order to keep your tests running without issue we need a clean way to opt-out of these tests.</p>

<p>The standard opt-out behavior we have seen with A/B testing platforms (both commercial and custom) tends to be either an appended URL that you can pass in when navigating to a page (e.g. '?optimizely<em>opt</em>out=true') or forging a cookie (or some combination of the two).</p>
<h2>An Example</h2>

<p>For this example we are going to demonstrate how to opt-out of a page that is controlled by Optimizely (a popular A/B Testing platform) by forging a cookie.</p>

<p>And on the page we are testing, the heading text will change based on which test group we are in.</p>

<p>You can see the example application we are testing <a href="http://the-internet.herokuapp.com/abtest">here</a>.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>We start off the example by loading our libraries and preparing our setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/abtest'</span>
  <span class="n">heading_text</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">heading_text</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'A/B Test Control'</span><span class="p">)</span> <span class="o">||</span>
    <span class="n">heading_text</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'A/B Test Variation 1'</span><span class="p">)</span>
  <span class="n">result</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">add_cookie</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">'optimizelyOptOut'</span><span class="p">,</span> <span class="ss">value</span><span class="p">:</span> <span class="s1">'true'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">navigate</span><span class="o">.</span><span class="n">refresh</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'No A/B Test'</span>
<span class="k">end</span>
</pre></div>
<p>In our run action we navigate to the page we want to test. We confirm that we are in one of the A/B test cells by grabbing the heading text and seeing if it includes the proper content.</p>

<p>After that we add the opt-out cookie, refresh the page, and then confirm that we are no longer in the A/B test cells (again, by confirming that the heading text has changed).</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">add_cookie</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">'optimizelyOptOut'</span><span class="p">,</span> <span class="ss">value</span><span class="p">:</span> <span class="s1">'true'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/abtest'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'No A/B Test'</span>
<span class="k">end</span>
</pre></div>
<p>Alternatively we can go to the main page of the site first, add the opt-out cookie, and then navigate to the page of interest &amp; perform our checks.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load a page on the site</li>
<li>Add the opt-out cookie</li>
<li>Access the page of interest</li>
<li>Assert that the header text is correct</li>
</ul>
<h1 id="chapter15_2"><small>Chapter 15.2</small><br>Basic Auth</h1>

<p>On some occasions you may work with apps that are secured with <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">Basic HTTP Authentication</a>. And in order to access them you will need to pass credentials to the server when requesting a page.</p>

<p>Before Selenium 2 we were able to accomplish this by injecting credentials into a custom header, but now the cool kid way is to use something like <a href="http://bmp.lightbody.net/">BrowserMob Proxy</a>. And some people are solving this with browser specific configurations.</p>

<p>But all of this feels heavy. Instead, let's look at a simple approach that is browser agnostic.</p>
<h2>An Example</h2>

<p>We can simply pass in the username and password in the URL that we are requesting (for both HTTP or HTTPS). Let's take a look at an example.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>We start off by requiring our libraries and implementing setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://admin:admin@the-internet.herokuapp.com/basic_auth'</span>
  <span class="n">page_message</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'p'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">page_message</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/Congratulations!/</span>
<span class="k">end</span>
</pre></div>
<p>In the run action we are getting the page by passing in the username and password in the URL. Once it loads we grab text from the page, and make an assertion against it.</p>

<p>Alternatively, we could have accessed the page with credentials as part of the setup action and then accessed the page again (or any other HTTP page behind basic auth) <strong>without</strong> credentials.</p>

<p>Here's what that would look like.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://admin:admin@the-internet.herokuapp.com/basic_auth'</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/basic_auth'</span>
  <span class="n">page_message</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'p'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">page_message</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/Congratulations!/</span>
<span class="k">end</span>
</pre></div>
<p>NOTE: If your application serves both HTTP and HTTPS pages from behind basic auth then you will need to load one of each type before executing your test steps. Otherwise you will get authorization errors when switching between HTTP and HTTPS. This happens because the browser can't use basic auth credentials interchangeably (e.g. HTTP for HTTP and vice versa).</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the HTTP and/or HTTPS page caching basic auth credentials</li>
<li>Load the page</li>
<li>Get the page text</li>
<li>Assert that it contains what it should</li>
</ul>
<h1 id="chapter15_3"><small>Chapter 15.3</small><br>Dropdown Lists</h1>

<p>Selecting from a dropdown list <em>seems</em> like one of those simple things. Just grab the list by its element and select one of its items based on the text you want.</p>

<p>While it sounds pretty straightforward, there is a bit more finessing to it than you may realize.</p>

<p>Let's take a look at a couple of different approaches.</p>
<h2>An Example</h2>

<p>NOTE: You can see the example app we are using to test <a href="http://the-internet.herokuapp.com/dropdown">here</a></p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>First we load our libraries and wire up our setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dropdown'</span>
  <span class="n">drop_down_list</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'dropdown'</span><span class="p">)</span>

  <span class="n">options</span> <span class="o">=</span> <span class="n">drop_down_list</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">tag_name</span><span class="p">:</span> <span class="s1">'option'</span><span class="p">)</span>
  <span class="n">options</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">option</span><span class="o">|</span> <span class="n">option</span><span class="o">.</span><span class="n">click</span> <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">'Option 1'</span> <span class="p">}</span>

  <span class="n">selected_option</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">option</span><span class="o">|</span> <span class="n">option</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">selected?</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span>
  <span class="n">selected_option</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'Option 1'</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
<span class="p">}</span>
</pre></div>
<p>Next we go to our example application, find the dropdown list by its ID, and store it in a variable. From this variable we are able to tease out all of its available options to click on -- storing them in a variable as well.</p>

<p>Grabbing the list's options returns a collection that we then iterate over. When the text matches what we want, we click on it.</p>

<p>And to polish things off, we check to see if our selection was made correctly by reiterating over the dropdown options collection, getting the text of the one that was selected, returning its text, storing it in a variable, and making an assertion against it.</p>

<p>While this works, there is a simpler, built-in way to do this within Selenium. Let's give that a go.</p>
<h2>Another Example</h2>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dropdown'</span>

  <span class="n">dropdown</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'dropdown'</span><span class="p">)</span>
  <span class="n">select_list</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">::</span><span class="ss">Support</span><span class="p">:</span><span class="ss">:Select</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">dropdown</span><span class="p">)</span>
  <span class="n">select_list</span><span class="o">.</span><span class="n">select_by</span><span class="p">(</span><span class="ss">:text</span><span class="p">,</span> <span class="s2">&quot;Option 1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>Similar to the first example, we are finding the dropdown list by ID. But instead of iterating over it and clicking based on a conditional, we are leveraging a built-in helper function of Selenium, <a href="http://selenium.googlecode.com/svn-history/r15117/trunk/docs/api/rb/Selenium/WebDriver/Support/Select.html">Select</a>, and its <a href="http://selenium.googlecode.com/svn-history/r15117/trunk/docs/api/rb/Selenium/WebDriver/Support/Select.html#select_by-instance_method">select_by</a> action.</p>

<p>In addition to selecting by text, we can also select by value. Like so...</p>
<div class="highlight"><pre>  <span class="n">select_list</span><span class="o">.</span><span class="n">select_by</span><span class="p">(</span><span class="ss">:value</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
</pre></div><h2>Expected Behavior</h2>

<p>Under the hood both of these approaches follow the same basic behavior:</p>

<ul>
<li>Load the page</li>
<li>Find the dropdown list</li>
<li>Grab all elements in the list</li>
<li>Iterate through them</li>
<li>Click on the one that matches what we want</li>
</ul>
<h1 id="chapter15_4"><small>Chapter 15.4</small><br>File Download (browser specific)</h1>

<p>Just like with file uploads, we hit the same issue with downloading them -- a dialog box just out of Selenium's reach.</p>

<p>Conventional wisdom posits that automating file downloads may be a foolish endeavor since in addition to the dialog box problem it is a deep rabbit hole to fall down. But here is a reasonable approach that will get you there without too much fuss.</p>
<h2>A Solution</h2>

<p>We are going to side-step the dialog box by telling our browser to ignore it and specify a location where to automatically download files to. Depending on the file's type, we will need to provide some additional configuration -- overriding some sensible defaults.</p>

<p>Once the file is downloaded we will make a quick and dirty assertion on it to see that it exists and is not empty.</p>

<p>Let's dig in with an example in Ruby using Selenium WebDriver against <a href="http://the-internet.herokuapp.com/download">our test app</a>.</p>
<h2>An Example</h2>

<p>First we will include the requisite libraries and wire-up our setup, teardown, and run actions in helper methods.</p>

<p>We are using the selenium-webdriver gem so we can demonstrate the browser profile configuration inline. And rspec-expectations is for our assertion action.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@download_dir</span> <span class="o">=</span> <span class="s2">&quot;/Users/more/Desktop/tmp/</span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m%d%y_%H%M%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">profile</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">::</span><span class="ss">Firefox</span><span class="p">:</span><span class="ss">:Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.download.folderList'</span><span class="o">]</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.download.dir'</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@download_dir</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.helperApps.neverAsk.saveToDisk'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'image/jpeg, application/pdf'</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'pdfjs.disabled'</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>

  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:profile</span> <span class="o">=&gt;</span> <span class="n">profile</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;rm -rf </span><span class="si">#{</span><span class="vi">@download_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>The setup method is where the magic is happening. In it we are creating an instance variable and setting it to an absolute path for the directory we would like to use (e.g. a uniquely named temp folder that exists on my Desktop). This will come in handy later when we need to access the downloaded file and make an assertion against it.</p>

<p>Next we create a Firefox profile object and ply it with some configuration parameters:
+ <strong>browser.download.folderList</strong> tells Firefox where to place its downloads. A 2 tells it to use a custom download path whereas a 1 is the browser's default path and a 0 is the Desktop.
+ <strong>browser.download.dir</strong> is where we set the custom download path.
+ <strong>browser.helperApps.neverAsk.saveToDisk</strong> tells Firefox when NOT to prompt us for a file download. It requires us to pass in a comma-separated string of MIME types that we care about. You can find a full list of MIME types <a href="http://www.webmaster-toolkit.com/mime-types.shtml">here</a>. For this example we have a PDF and JPG files to play with.
+ <strong>pdfjs.disabled</strong> is for when downloading PDFs. This overrides the sensible default set in Firefox that previews them in the browser.</p>

<p>After setting these bits we instantiate Selenium WebDriver and pass in the now configured profile object.</p>

<p>Our teardown and run methods are pretty straightforward. Teardown quits the Selenium object when done and cleans up the temp directory with a system call. And we wrap everything up neatly into a single run method that we can pass a block of commands to.</p>

<p>Now that we have setup Firefox appropriately we move on to our Selenium and assertion actions.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/download'</span>
  <span class="n">download_link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span>
  <span class="n">download_link</span><span class="o">.</span><span class="n">click</span>

  <span class="n">downloaded_files</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@download_dir</span><span class="si">}</span><span class="s2">/**/*&quot;</span><span class="p">)</span>
  <span class="n">sorted_downloads</span> <span class="o">=</span> <span class="n">downloaded_files</span><span class="o">.</span><span class="n">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span> <span class="no">File</span><span class="o">.</span><span class="n">mtime</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="p">}</span>
  <span class="no">File</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sorted_downloads</span><span class="o">.</span><span class="n">last</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
<p>After loading the page we find the first link available and click it. Alternatively, we could have clicked the second link</p>
<div class="highlight"><pre>  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">click</span>
</pre></div>
<p>...or we could have clicked all of the links.</p>
<div class="highlight"><pre>  <span class="n">download_links</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span>
  <span class="n">download_links</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">download_link</span><span class="o">|</span>
    <span class="n">download_link</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="k">end</span>
</pre></div>
<p>All of these actions trigger an automatic download to the folder specified in setup. So we then check to see that a file is there and not empty.</p>

<p>This is done by getting a list of the files stored in the directory and sorting it from oldest to newest based on its modified date timestamp. This ensures that the last item in the list is the newest one.</p>

<p>Once we have it, we check its file size to make sure that it is greater than 0.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Find the first download link</li>
<li>Click it</li>
<li>Download the file to a specified location on disk without prompting</li>
<li>Check that the downloaded file is there and not empty</li>
</ul>
<h2>Outro</h2>

<p>It's worth noting that the same approach can be applied to some browsers (e.g. Chrome) with a slightly different setup configuration, but not others (e.g. Internet Explorer). This is why I prefer to leverage a browser agnostic approach.</p>
<h1 id="chapter15_5"><small>Chapter 15.5</small><br>File Download (browser agnostic)</h1>

<p>While downloading files with a custom browser configuration works it is not portable from browser to browser.</p>

<p>And ultimately we shouldn't care if the browser can download something or not. Instead we should care that the file was downloaded and that it is of the correct type and size -- a subtle but important distinction.</p>

<p>Alongside our Selenium actions we can leverage an HTTP library to initiate a download and inspect the response header to confirm it is what we expect. And all this without actually downloading the file to disk. Such an approach enables us to keep with Selenium, but decouples us from a browser specific configuration.</p>

<p>Let's dig with an example.</p>
<h2>An Example</h2>

<p>In the first part of this example we take care of including our third-party libraries and setting up some helper methods (e.g. setup, teardown, and run).</p>

<p>The only thing that is different from most of our previous examples is that we have included the <code>rest-client</code> gem to handle the mechanics of our HTTP interactions for downloading files and viewing their response headers.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="nb">require</span> <span class="s1">'rest-client'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>In our run acton we use Selenium to load the page that has our download links and grab the URL for the first one listed.</p>

<p>We then use the <code>rest-client</code> gem to initiate the download and store its response into a variable called <code>response</code>.</p>

<p>From this object we are able to access the headers and perform checks against it. Primarily focusing on the <code>content_type</code> and <code>content_length</code> portions. For this example we are confirming that the file to be downloaded is an <code>image/jpeg</code> and that its contents are not empty.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/download'</span>
  <span class="n">link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="no">RestClient</span><span class="o">.</span><span class="n">get</span> <span class="n">link</span>
  <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_type</span><span class="o">].</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'image/jpeg'</span>
  <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_length</span><span class="o">].</span><span class="n">to_i</span><span class="o">.</span><span class="n">should</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div><h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Get the URL of the first download link</li>
<li>Perform a GET action against the URL with an HTTP library</li>
<li>Store the response</li>
<li>Assert that the file type is correct</li>
<li>Assert that the file is not empty</li>
</ul>
<h1 id="chapter15_6"><small>Chapter 15.6</small><br>File Upload</h1>

<p>Normally when interacting with forms to upload a file you're prompted with a dialog box that is just out of reach for Selenium.</p>

<p>In these cases, people tend to turn to a tool to drive the GUI, such as Auto-IT. While this helps solve short-term pain, it sets you up for long term hurt later by chaining you to a specific platform -- limiting your ability to effectively test different browser/OS combinations.</p>

<p>A work-around for this problem is to side-step the dialog box experience entirely, and rather, inject the path of the file you want to upload into the form element, and then submit the form.</p>

<p>Let's break down this approach with some example Ruby code using Selenium WebDriver Remote and an example file upload form.</p>
<h2>An Example</h2>

<p>You can see the application we are running against <a href="http://the-internet.herokuapp.com/upload">here</a>, or view the code for it <a href="https://github.com/arrgyle/the-internet/blob/master/views/upload.erb">here</a>.</p>

<p>For our test script, first we'll include the requisite libraries and wire-up our setup and teardown actions in helper methods.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-connect'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="no">SeleniumConnect</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
    <span class="n">c</span><span class="o">.</span><span class="n">host</span>    <span class="o">=</span> <span class="s1">'localhost'</span>
    <span class="n">c</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="s1">'chrome'</span>
  <span class="k">end</span>

  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">SeleniumConnect</span><span class="o">.</span><span class="n">start</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="no">SeleniumConnect</span><span class="o">.</span><span class="n">finish</span>
<span class="k">end</span>
</pre></div>
<p>We are using the selenium-connect gem to make configuring and running a local instance of Selenium Remote a snap. And we are using rspec-expectations for our assertion action.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://localhost:4567/upload'</span>
  <span class="n">uploader</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'file-upload'</span><span class="p">)</span>
  <span class="n">uploader</span><span class="o">.</span><span class="n">send_keys</span> <span class="s1">'/Users/more/Desktop/daveHaeffner.jpg'</span>
  <span class="n">uploader</span><span class="o">.</span><span class="n">submit</span>

  <span class="n">uploaded_image</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'img'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'src'</span><span class="p">)</span>
  <span class="n">uploaded_image</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/daveHaeffner.jpg/</span>
<span class="p">}</span>
</pre></div>
<p>We created a helper method called 'run' to easily call our setup and teardown actions without being overly verbose.</p>

<p>In our run block we are driving the test script using standard Selenium commands and ending things off with an RSpec assertion.</p>
<h2>Expected Behavior</h2>

<p>So the intended behavior is:
+ Load the page
+ Grab the form element we want to work with
+ Inject the path to the file we want to upload
+ Submit the form
+ Grab the source path for the image once it renders in the browser
+ Check to see that the image path contains the proper filename</p>
<h1 id="chapter15_7"><small>Chapter 15.7</small><br>Frames</h1>

<p>More often than not you'll run into a throwback relic of the front-end world -- in this case, frames. Rather than curse and spit when it comes to writing automated tests against them, there is a simple approach we can use to tap dance through them.</p>

<p>In order to access the elements within a frame we need to tell Selenium to switch to it.</p>

<p>Let's demonstrate this with a couple of test scripts.</p>
<h2>An Example</h2>

<p>Our general script setup is pretty straightforward. Nothing special -- just the standard setup, teardown, and run methods.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>Our first example demonstrates how to deal with nested frames. You can see the page we are testing against <a href="http://the-internet.herokuapp.com/frames">here</a>.</p>
<div class="highlight"><pre><span class="c1"># Nested Frames</span>
<span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/frames'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="s1">'frame-top'</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="s1">'frame-middle'</span><span class="p">)</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'content'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/MIDDLE/</span>
<span class="p">}</span>
</pre></div>
<p>In order to get the text of the middle frame, we need to switch to it. But in order for Selenium to see it, we need to switch to the parent frame first, then the child frame.</p>

<p>Once we've done that, we are able to freely find the element we want and assert that the relevant text appears.</p>

<p>While this example helps illustrate the point of frame switching, it is not very practical. So here is a more likely use case you'll run into -- working with the TinyMCE Editor.</p>
<h2>Another Example</h2>

<p>You can find the page we are testing against <a href="http://the-internet.herokuapp.com/tinymce">here</a>.</p>
<div class="highlight"><pre><span class="c1"># Iframes</span>
<span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tinymce'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="s1">'mce_0_ifr'</span><span class="p">)</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'tinymce'</span><span class="p">)</span>
    <span class="n">before_text</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">text</span>
    <span class="n">editor</span><span class="o">.</span><span class="n">clear</span>
    <span class="n">editor</span><span class="o">.</span><span class="n">send_keys</span> <span class="s1">'Hello World!'</span>
    <span class="n">after_text</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">text</span>

  <span class="n">after_text</span><span class="o">.</span><span class="n">should_not</span> <span class="o">==</span> <span class="n">before_text</span>
<span class="p">}</span>
</pre></div>
<p>Once the page renders we switch into the TinyMCE frame. While the frame element does not have a 'name' attirbute it does have an id. This works just the same in the switch_to.frame call, so we use it.</p>

<p>Now that Selenium is properly scoped we are able to use the top-level id of the TinyMCE widget to:
+ grab its text
+ clear its text
+ input new text
+ grab the altered text
+ assert that the before and after texts are not the same</p>

<p>Keep in mind that if we need to access a part of the page outside of the frame we are currently in then we will need to switch to it. For instance...</p>
<div class="highlight"><pre><span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">default_content</span>
<span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should_not</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</pre></div>
<p>This switches us back to the main page and enables us to assert that the heading on the page is there.</p>

<p>And that's pretty much all there is to it.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Switch to the frame you want</li>
<li>Find and take an action against an element</li>
<li>Switch to another frame or the main document if needbe</li>
<li>Assert that the desired outcome has occured</li>
</ul>
<h1 id="chapter15_8"><small>Chapter 15.8</small><br>HTTP Status Codes</h1>

<p>There are times when you are testing a page (or numerous pages) and you want to verify that it responded correctly. A great way to handle this is by checking the HTTP Status Code that the browser received. But this functionality is not available in Selenium WebDriver.</p>

<p>But fear not because there is more than one way to fall down this deep rabbit hole.</p>

<p>The tried and true approach that Selenium Committers and Practitioners recommend is to use a proxy server. With it, we will be able to watch and manipulate network traffic to and from the application under test -- giving us access to a whole host of functionality that we wouldn't have otherwise had.</p>

<p>Let's step through an example using <a href="http://bmp.lightbody.net/">BrowserMob Proxy</a>.</p>
<h2>An Example</h2>

<p>First we have to download BrowserMob Proxy to our working directory (available on <a href="http://bmp.lightbody.net/">their website</a>). With that in hand, we are ready to wire up our script.  </p>

<p>At the top of the file we include the libraries we need -- <code>selenium-webdriver</code> to drive the browser, <code>rspec-expectations</code> for our assertions, and <code>browsermob/proxy</code> to use the proxy server. You can find more info on the <code>browsermob-proxy</code> gem we are using <a href="https://rubygems.org/gems/browsermob-proxy">here</a>.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="nb">require</span> <span class="s1">'browsermob/proxy'</span>
</pre></div>
<p>Next we create a <code>configure_proxy</code> method to prepare the proxy for use with Selenium. In it we start the proxy server and create a configurable instance of it. We then create a browser profile (Firefox in this case) and set it to use the proxy server.  </p>

<p>Once that's done, we wire up the <code>configure_proxy</code> method into the setup action, and pass in the profile object to our Selenium instance.  </p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">configure_proxy</span>
  <span class="n">server</span> <span class="o">=</span> <span class="ss">BrowserMob</span><span class="p">:</span><span class="ss">:Proxy</span><span class="o">::</span><span class="no">Server</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'./browsermob-proxy/bin/browsermob-proxy'</span><span class="p">)</span>
  <span class="n">server</span><span class="o">.</span><span class="n">start</span>
  <span class="vi">@proxy</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">create_proxy</span>
  <span class="vi">@profile</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">::</span><span class="ss">Firefox</span><span class="p">:</span><span class="ss">:Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="vi">@profile</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="vi">@proxy</span><span class="o">.</span><span class="n">selenium_proxy</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="n">configure_proxy</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:profile</span> <span class="o">=&gt;</span> <span class="vi">@profile</span>
<span class="k">end</span>
</pre></div>
<p>After that, we wire up our teardown and run actions.  </p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">close</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>And to make things clean we wrap up our proxy calls to get the status code from the <a href="http://www.softwareishard.com/blog/har-12-spec/">HTTP Archive</a> (a.k.a. HAR) in a <code>visit</code> action that returns it after it visits the page.  </p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">new_har</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="n">url</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">har</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status</span>
<span class="k">end</span>
</pre></div>
<p>All that's left is our run action, which is simple and to the point.  </p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="n">status_code</span> <span class="o">=</span> <span class="n">visit</span> <span class="s1">'http://the-internet.herokuapp.com/status_codes/404'</span>
  <span class="n">status_code</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">404</span>
<span class="k">end</span>
</pre></div><h2>Expected Behavior</h2>

<ul>
<li>Visit the URL</li>
<li>Retrieve the HTTP Status Code</li>
<li>Assert that it is the correct status code</li>
</ul>
<h2>Outro</h2>

<p>This was inspired by <a href="https://twitter.com/jimevansmusic">Jim Evans</a>' multi-part blog post series on doing the same thing in C# with Fiddler (<a href="http://jimevansmusic.blogspot.com/2013/08/implementing-webdriver-http-status.html">1</a>, <a href="http://jimevansmusic.blogspot.com/2013/08/implementing-http-status-codes-in.html">2</a>, <a href="http://jimevansmusic.blogspot.com/2013/08/implementing-http-status-codes-in_17.html">3</a>) which was in response to <a href="https://code.google.com/p/selenium/issues/detail?id=141">Selenium Issue 141</a>. Thanks Jim!</p>
<h1 id="chapter15_9"><small>Chapter 15.9</small><br>Mobile</h1>

<p>Mobile is kind of a big deal. And if you haven't needed to test a mobile app yet, it's only a matter of time. But where do you start? And how do you do it in a way that is complimentary to your exisitng automation and experience?</p>

<p>Give <a href="http://appium.io/">Appium</a> a try. It's open source, works for both iPhone &amp; Android, and works through the use of the Selenium WebDriver API (without having to recompile the app in order to test it).</p>

<p>That is to say -- you can write tests pretty much the same way as you do now, there are just some aditional things to think about -- like new functionality (e.g. pinch, swipe, etc.) and setup (e.g. serving your app, running simulators and a server locally, or sending things off to the cloud).</p>

<p>To simplify things, let's step through 2 examples using Sauce Labs to test native apps -- one for iPhone and another for Android.</p>

<p><strong>NOTE: These examples were borrowed from <a href="https://github.com/appium/appium/tree/master/sample-code/examples/ruby">the Appium project</a> and modified for simplicity.</strong></p>
<h2>A brief primer on Native App Testing In SauceLabs</h2>

<p>In order to test your app in SauceLabs you will need to zip it up and serve it somehow. Here are some options on how to do that:</p>

<ul>
<li>make it publically available (e.g. from AWS)</li>
<li>use <a href="http://saucelabs.com/docs/rest#storage">Sauce Labs' temporary storage</a></li>
<li>use <a href="https://saucelabs.com/docs/connect">Sauce Connect</a> and grab it from a machine behind your firewall</li>
</ul>

<p>Once you have that you just need to set your test's desired capabilities accordingly. You can see a list of options <a href="https://saucelabs.com/docs/platforms/appium">here</a>.</p>
<h2>An iPhone Example</h2>

<p>In this example we will be testing an application that has a form that takes 2 numbers, adds them together, and displays the result.</p>

<p><strong>NOTE: Contrary to the Appium philosophy of not needing to recompile your app, there is one SMALL tweak you'll need to make before your app is ready for Sauce (if you care about testing against an iPhone). It's to make sure that the correct simulator gets loaded. Instructions available <a href="https://saucelabs.com/appium/tutorial/2#compiling">here</a>.</strong></p>

<p>We kick off our iPhone example by requiring our dependent libraries (<code>selenium-webdriver</code> to drive the browser, and <code>rspec-expectations</code> for handling assertions). After that, we wire up our setup, teardown, and run methods.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'platform'</span>            <span class="o">=&gt;</span> <span class="s1">'Mac 10.8'</span><span class="p">,</span>
    <span class="s1">'version'</span>             <span class="o">=&gt;</span> <span class="s1">'6.1'</span><span class="p">,</span>
    <span class="s1">'device'</span>              <span class="o">=&gt;</span> <span class="s1">'iPhone Simulator'</span><span class="p">,</span>
    <span class="s1">'app'</span>                 <span class="o">=&gt;</span> <span class="s1">'http://appium.s3.amazonaws.com/TestApp6.0.app.zip'</span><span class="p">,</span>
    <span class="s1">'name'</span>                <span class="o">=&gt;</span> <span class="s1">'Ruby/iPhone Example for Appium'</span>
  <span class="p">}</span>

  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
    <span class="ss">:remote</span><span class="p">,</span>
    <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">&quot;http://SAUCE_USERNAME:SAUCE_API_KEY@ondemand.saucelabs.com:80/wd/hub&quot;</span><span class="p">,</span>
    <span class="ss">:desired_capabilities</span> <span class="o">=&gt;</span> <span class="n">caps</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>Note that in <code>setup</code> we configure our capabilities by setting them to a hash and storing them in a variable called <code>caps</code>. In it we are specifying the platform we would like (<code>Mac 10.8</code>), the iOS version (<code>6.1</code>), the device (<code>iPhone Simulator</code>), and the app we would like to load (zipped up and served from AWS).</p>

<p>We then instantiate Selenium Remote in a <code>@driver</code> object; pointing it at Sauce Labs, and passing in our desired capabilities.</p>

<p>And in our test we wire up interaction with the app using familiar Selenium WebDriver API actions and an assertion.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
    <span class="n">values</span> <span class="o">=</span> <span class="o">[</span><span class="nb">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">]</span>
    <span class="n">expected_sum</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:+</span><span class="p">)</span>

    <span class="n">elements</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">:tag_name</span><span class="p">,</span> <span class="s1">'textField'</span><span class="p">)</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">element</span><span class="p">,</span> <span class="n">index</span><span class="o">|</span>
      <span class="n">element</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">values</span><span class="o">[</span><span class="n">index</span><span class="o">]</span>
    <span class="k">end</span>

    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:tag_name</span><span class="p">,</span> <span class="s1">'button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:tag_name</span><span class="p">,</span> <span class="s1">'staticText'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="n">expected_sum</span><span class="o">.</span><span class="n">to_s</span>
<span class="k">end</span>
</pre></div><h2>Expected Behavior</h2>

<ul>
<li>Open a job with Sauce Labs</li>
<li>Load an iPhone simulator on a Mac</li>
<li>Load the test app</li>
<li>Input two random numbers</li>
<li>Sum them them together</li>
<li>Assert that they are correctly added together</li>
</ul>

<p><strong>NOTE: You can see the test result complete with video <a href="https://saucelabs.com/tests/6736add27ae544409e7ae918ff74ae8d">here</a>.</strong></p>
<h2>An Android Example</h2>

<p>In this example we will be testing a simple note taking app.</p>

<p>We kick off our Android example by requiring our dependent libraries (<code>selenium-webdriver</code> to drive the browser, and <code>rspec-expectations</code> for handling assertions). After that, we wire up our setup, teardown, and run methods.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'platform'</span>            <span class="o">=&gt;</span> <span class="s1">'Linux'</span><span class="p">,</span>
    <span class="s1">'version'</span>             <span class="o">=&gt;</span> <span class="s1">'4.2'</span><span class="p">,</span>
    <span class="s1">'device'</span>              <span class="o">=&gt;</span> <span class="s1">'Android'</span><span class="p">,</span>
    <span class="s1">'app'</span>                 <span class="o">=&gt;</span> <span class="s1">'http://appium.s3.amazonaws.com/NotesList.apk'</span><span class="p">,</span>
    <span class="s1">'app-package'</span>         <span class="o">=&gt;</span> <span class="s1">'com.example.android.notepad'</span><span class="p">,</span>
    <span class="s1">'app-activity'</span>        <span class="o">=&gt;</span> <span class="s1">'.NotesList'</span><span class="p">,</span>
    <span class="s1">'name'</span>                <span class="o">=&gt;</span> <span class="s1">'Ruby/Android Example for Appium'</span>
  <span class="p">}</span>

  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
    <span class="ss">:remote</span><span class="p">,</span>
    <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">&quot;http://SAUCE_USERNAME:SAUCE_API_KEY@ondemand.saucelabs.com:80/wd/hub&quot;</span><span class="p">,</span>
    <span class="ss">:desired_capabilities</span> <span class="o">=&gt;</span> <span class="n">caps</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>In <code>setup</code>, we configure our capabilities by setting them to a hash and storing them in a variable called <code>caps</code>. In it we are specifying the platform (<code>Linux</code>), the Android version (<code>4.2</code>), the device (<code>Android</code>), and where to find the app (zipped and served from AWS). We then instantiate Selenium Remote in a <code>@driver</code> object; pointing it at Sauce Labs, and passing in our desired capabilities.</p>

<p>The additional bits of info we need to provide in <code>caps</code> (versus in our iPhone example) are <code>app-package</code> and <code>app-activity</code>. <code>app-package</code> being the package name of your app, and <code>app-activity</code> being the name of the activity you would like to start. <code>app-activity</code> gets appended to <code>app-package</code> and is used at Sauce run time to launch your app (e.g. <code>com.example.android.notepad.NotesList</code>).</p>

<p>And in our test we wire up interaction with the app using familiar Selenium WebDriver API actions and an assertion.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s1">'New note'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:tag_name</span><span class="p">,</span> <span class="s1">'textfield'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="s1">'This is a new note, from Ruby'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s1">'Save'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">notes</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">:tag_name</span><span class="p">,</span> <span class="s1">'text'</span><span class="p">)</span>
  <span class="n">notes</span><span class="o">[</span><span class="mi">2</span><span class="o">].</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'This is a new note, from Ruby'</span>
<span class="k">end</span>
</pre></div><h2>Expected Behavior</h2>

<ul>
<li>Open a job with Sauce Labs</li>
<li>Load an Android simulator on a Linux machine</li>
<li>Load the test app</li>
<li>Create a new note</li>
<li>Fill in the new note</li>
<li>Grab the note text and assert that it's what we inputted</li>
</ul>

<p><strong>NOTE: You can see the test result complete with video <a href="https://saucelabs.com/tests/e0dbb98af23540d8b43f0806d743fbd8">here</a>.</strong></p>
<h2>Other Helpful Tidbits</h2>
<h3>Inspecting Elements</h3>

<p>In order to easily inspect and identify the elements in your app, you can use Appium's Inspector which comes in <a href="https://github.com/appium/appium-dot-app">appium-dot-app</a> and requires you to set up Appium locally.</p>

<p><strong>NOTE: You can see a demo of it in action with an iOS app <a href="http://www.youtube.com/watch?v=Hv9A9WfYF4g">here</a>.</strong></p>
<h3>Mobile Web Apps</h3>

<p>If instead you have a mobile web app, you can launch mobile Safari by switching out the URL in <code>app</code> with <code>safari</code>, like so:</p>
<div class="highlight"><pre>  <span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'platform'</span>            <span class="o">=&gt;</span> <span class="s1">'Mac 10.8'</span><span class="p">,</span>
    <span class="s1">'version'</span>             <span class="o">=&gt;</span> <span class="s1">'6.1'</span><span class="p">,</span>
    <span class="s1">'device'</span>              <span class="o">=&gt;</span> <span class="s1">'iPhone Simulator'</span><span class="p">,</span>
    <span class="s1">'app'</span>                 <span class="o">=&gt;</span> <span class="s1">'safari'</span><span class="p">,</span>
    <span class="s1">'name'</span>                <span class="o">=&gt;</span> <span class="s1">'Ruby/iPhone Example for Appium'</span><span class="p">,</span>
  <span class="p">}</span>
</pre></div>
<p>But it's worth noting that Sauce Labs does not currently support the ability launch a mobile browser on Android (e.g. <code>chrome</code>). This functionality is, however, available when running Appium locally (as documented <a href="https://github.com/appium/appium/blob/master/docs/mobile-web.md#mobile-chrome-on-emulator-or-real-device">here</a>).</p>
<h3>Hybrid Apps</h3>

<p>If you have a hybrid mobile app (e.g. an app with a native container that leverages the built in browser engine), then you should be good to go both locally and in Sauce. For details, go <a href="https://github.com/appium/appium/blob/master/docs/hybrid.md">here</a>.</p>
<h3>Location Services</h3>

<p>If you have an iOS app that deals with geolocation, then working with the Location Services dialog can be a little tricky.</p>

<p>You can either do a blanket dismiss (which requires some elbow grease -- see <a href="https://groups.google.com/d/msg/appium-discuss/k5gbfVFRPsE/cCkje7tczQcJ">this Appium Google Groups thread</a> for details), or capture and dismiss the dialog as it appears (using functionality found in a library like <a href="https://github.com/appium/ruby_lib/blob/master/docs/ios_docs.md#alert_click-ios">ruby_lib</a>).</p>

<p>And in Sauce Labs, Location Services is disabled by default on iOS 6.1, but enabled by default on iOS 7.1. This is not configurable, but may be in the future through desired capabilities (there's <a href="http://support.saucelabs.com/entries/25117411-Location-services-enabled-by-default-on-iOS-devices">an active thread about this on Sauce's support site</a>, feel free to chime in!).</p>
<h2>Outro</h2>

<p>In order to take full advantage of what Appium has to offer, getting it set up locally is key. I encourage you to check out the installation docs (available for <a href="https://github.com/appium/appium/blob/master/docs/running-on-osx.md">OS X</a>, <a href="https://github.com/appium/appium/blob/master/docs/running-on-linux.md">Linux</a>, and <a href="https://github.com/appium/appium/blob/master/docs/running-on-windows.md">Windows</a>).</p>

<p>And if you're curious about other mobile automation frameworks, Alister Scott has <a href="http://watirmelon.com/2013/11/04/the-current-state-of-ios-automated-functional-testing/">a good breakdown of them</a>.</p>
<h1 id="chapter15_10"><small>Chapter 15.10</small><br>Multiple Windows</h1>

<p>Occasionally you will run into a link or action on a site that opens a new window. In order to work within this new window, or the originating one, you will need to switch between them.</p>

<p>On the face of it, this is a pretty straightforward thing. But lurking within it is a small gotcha to watch out for.</p>

<p>Let's step through it.</p>
<h2>An Example</h2>

<p>NOTE: You can find a link to our example application <a href="http://the-internet.herokuapp.com/windows">here</a>.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>Nothing fancy here. Just loading the libraries necessary to run Selenium Webdriver and perform our assertions. That and wiring up some simple setup, teardown, and run actions to keep things clean.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/windows'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'.example a'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">window_handles</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should_not</span> <span class="o">=~</span> <span class="sr">/New Window/</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">window_handles</span><span class="o">.</span><span class="n">last</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/New Window/</span>
<span class="p">}</span>
</pre></div>
<p>After loading the page and clicking the link (which spawns a new window) we grab the window handles (a.k.a. non-sensical identifier strings which represent each open browser window) and traverse between them based on the order of the list -- making assertions based on each page's title.</p>

<p><strong>While this may feel intuitively correct, this approach is going to bite you later.</strong></p>

<p>The order of the window handles is not consistent across all browsers. Some return in the order opened, others alphabetically.</p>

<p>Here's a more effective approach.</p>
<h2>A Better Example</h2>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/windows'</span>
  <span class="n">main_window</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">window_handle</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'.example a'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="n">windows</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">window_handles</span>
  <span class="n">windows</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">window</span><span class="o">|</span>
    <span class="k">if</span> <span class="n">main_window</span> <span class="o">!=</span> <span class="n">window</span>
      <span class="vi">@new_window</span> <span class="o">=</span> <span class="n">window</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">main_window</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should_not</span> <span class="o">=~</span> <span class="sr">/New Window/</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="vi">@new_window</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/New Window/</span>
<span class="p">}</span>
</pre></div>
<p>After we load the page, but before we click the new window link, we get the window handle for the main window. Then we click the link and get the window handles for both open windows.</p>

<p>Since this returns an array we iterate through it and find the window handle that is different -- a.k.a. the new window -- and store its value.</p>

<p>Once we have that it's all down hill from there. We're able to switch between the main window and the new window and assert that the page title contains the correct text.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Get the window handle for the current window</li>
<li>Take an action that opens a new window</li>
<li>Get the window handle for the new window</li>
<li>Switch between the windows as needed</li>
</ul>
<h1 id="chapter15_11"><small>Chapter 15.11</small><br>Secure File Downloads</h1>

<p>In a previous chapter we covered how to write tests to download files in a browser agnostic way by leveraging Selenium Webdriver and an HTTP library in tandem. This approach is great, but there are often times where the file you want to download is behind authentication, presenting a hurdle to overcome.</p>

<p>In order to access secure files with an HTTP library, we want to pull the authenticated session information out of Selenium's cookie store and pass it into the HTTP library when we perform the download action.</p>

<p>Let's dig in with an example.</p>
<h2>An Example</h2>

<p>We start by requiring our libraries (Selenium to drive the browser, RSpec for our assertions, and RestClient for our download action) and wire up our setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="nb">require</span> <span class="s1">'rest-client'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>Next we access a page of download links that is behind Basic HTTP Authentication, grab the first download link, and pull the authentication session cookie from the cookie store. Once we have that we fire up RestClient and perform a HEAD request against the download link with the cookie information and then check the headers to make sure it has the correct type and is not empty.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://admin:admin@the-internet.herokuapp.com/download_secure'</span>
  <span class="n">link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
  <span class="n">cookie</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">cookie_named</span> <span class="s1">'rack.session'</span>
  <span class="n">response</span> <span class="o">=</span> <span class="no">RestClient</span><span class="o">.</span><span class="n">head</span> <span class="n">link</span><span class="p">,</span> <span class="ss">cookie</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">cookie</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2">=</span><span class="si">#{</span><span class="n">cookie</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span><span class="si">}</span><span class="s2">;&quot;</span>
  <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_type</span><span class="o">].</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'application/pdf'</span>
  <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_length</span><span class="o">].</span><span class="n">to_i</span><span class="o">.</span><span class="n">should</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="k">end</span>
</pre></div>
<p>In order for things to work correctly with RestClient we have to stringify the cookie values (due to <a href="https://github.com/rest-client/rest-client/issues/89#issuecomment-17923328">an open issue</a> in the library). But your cookie configuration will likely vary depending on your HTTP library of choice.</p>

<p>And note that we are using a HEAD request instead of a GET request. Since we only care about the header information this will perform a partial fetch of data, avoiding a full download of the file.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Get the first download link</li>
<li>Pull the authenticated cookie information</li>
<li>Use it to perform a HEAD request against the download link</li>
<li>Check the headers to make sure the file is the correct type and not empty</li>
</ul>
<h2>Outro</h2>

<p>While this example demonstrates accessing files behind Basic HTTP Authentication it should also work with form-based authentication.</p>
<h1 id="chapter15_12"><small>Chapter 15.12</small><br>Tables</h1>

<p>Odds are at some point you've come across the use of tables in a web application to display data or information to a user, enabling them to sort and manipulate it. Depending on your application it can be quite common and something you will want to write automation for.</p>

<p>But when that table has no helpful markup (e.g. <code>id</code> or <code>class</code> attributes) it quickly becomes more difficult to work with and write tests against. And if you're able to pull something together, it will likely not work against older browsers.</p>

<p>All hope is not lost because you can traverse the table through the use of CSS Pseudo-classes.</p>

<p>But keep in mind that if you care about older browsers, then this approach won't work on them. In those cases it's better to get something working in the short term and file a fix with your front-end developer(s) to update the table with helpful attributes.</p>
<h2>A quick primer on Tables and CSS Pseudo-classes</h2>

<p>Understanding the broad strokes of an HTML table's structure goes a long way in writing effective automation against it. So here's a quick primer.</p>

<p>A table has...</p>

<ul>
<li>a header (e.g. <code>&lt;thead&gt;</code>)</li>
<li>a body (e.g. <code>&lt;tbody&gt;</code>).</li>
<li>rows (e.g. <code>&lt;tr&gt;</code>) -- horizontal slats of data</li>
<li>columns -- vertical slats of data</li>
</ul>

<p>Columns are made up of cells which are represented as...</p>

<ul>
<li><code>&lt;th&gt;</code> in a header</li>
<li><code>&lt;td&gt;</code> in a body (also known as <strong>table data</strong>)</li>
</ul>

<p>CSS Pseudo-classes work by walking through the structure of an object and targeting a specific part of it based on a relative number (e.g. the <strong>third</strong> <code>&lt;td&gt;</code> cell from a row in the table body). This works well with tables since we can couple it with Selenium to grab all instances of a target (e.g. the third <code>&lt;td&gt;</code> cell from <strong>all rows</strong> in the table body) -- which gives us all of the data for a specific column.</p>

<p>Let's dig in with an example for a common set of table functionality -- sorting columns in ascending and descending order.</p>
<h2>An Example</h2>

<p><strong>NOTE: You can see the application under test <a href="http://the-internet.herokuapp.com/tables">here</a>. There are 2 tables. We will start with Example 1 and then work with Example 2</strong></p>

<p>We kick things off by requiring our dependent libraries (<code>selenium-webriver</code> to drive the browser and <code>rspec-expectations</code> to handle our assertions) and wiring up our <code>setup</code>, <code>teardown</code>, and <code>run</code> actions.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>Here is a snippet from the first table we are working with. Note that it does not have any <code>id</code> or <code>class</code> attributes.</p>
<div class="highlight"><pre><span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">&quot;table1&quot;</span> <span class="na">class=</span><span class="s">&quot;tablesorter&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Last Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>First Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Email<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Due<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Web Site<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Action<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td&gt;</span>Smith<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>John<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>jsmith@gmail.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>$50.00<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>http://www.jsmith.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#edit'</span><span class="nt">&gt;</span>edit<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#delete'</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
</pre></div>
<p>There are 6 columns (<code>Last Name</code>, <code>First Name</code>, <code>Email</code>, <code>Due</code>, <code>Web Site</code>, and <code>Action</code>). Each one is sortable. The first click should sort them in ascending order, the second click in descending order.</p>

<p>And there is a small sampling of data in the table to work with (4 rows worth), so we should be able to sort and confirm that it actually worked. So let's do that -- starting with the <code>Due</code> column.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(4)'</span><span class="p">)</span>
  <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>

  <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
</pre></div>
<p>After navigating to the page we find and click the column heading that we want with a CSS Pseudo-class (e.g. <code>#table1 thead tr th:nth-of-type(4)</code>) which is effectively saying 'give me the 4th <code>th</code> element in the table heading' which is the placement of <code>Due</code>.</p>

<p>We then use another pseudo-class to find all of the <code>td</code> elements found within each row of the table body that are <code>Due</code>s -- which is effectively the 4th column.</p>

<p>Once we have them we create an array and iterate over the collection of <code>td</code> elements we found, stripping off the dollar sign, converting them into a decimal number, and shoveling them into the array. With this array of numbers we can then compare it against a sorted version of itself to make sure that they match. If they do then the table data on the page was sorted in ascending order.</p>

<p>If we click the <code>Due</code> heading again it should sort in descending order. The code for that is identical except for the assertion which is checking the same thing but seeing if it's false.</p>
<div class="highlight"><pre>  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(4)'</span><span class="p">)</span>
  <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span> <span class="p">}</span>

  <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">false</span>
</pre></div>
<p>We can then expand our sort check to a different column and see that it gets sorted correctly. So let's focus on the <code>Email</code> column.</p>
<div class="highlight"><pre>  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(3)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">emails</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(3)'</span><span class="p">)</span>
  <span class="n">email_values</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">emails</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">email</span><span class="o">|</span> <span class="n">email_values</span> <span class="o">&lt;&lt;</span> <span class="n">email</span><span class="o">.</span><span class="n">text</span> <span class="p">}</span>

  <span class="p">(</span><span class="n">email_values</span> <span class="o">==</span> <span class="n">email_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
<p>The mechanism for this is the same except that we are not manipulating the text before checking it. We are just doing a straight comparision. This is because Ruby will sort a collection of numbers that are represented as strings in descending order. Whereas all other comparisons will sort in ascending order.</p>
<h2>But What About Older Browsers?</h2>

<p>So, now we have a working example that will load the page and check sorting three different ways. Great! But as soon as we run this againt an older browser (like Internet Explorer 8) it will throw an exception stating <code>Unable to find element</code>. This is because older browsers don't support CSS Pseudo-classes.</p>

<p>You've already come a long way, so it's best to get value out of what you've just written. You can run these tests on current browsers, file a fix with your front-end developers to improve the table design with some <code>class</code> attributes, and then update these tests once they've made the necessary changes.</p>

<p>Here is a snippet of what our original table would look like with helpful attributes added in.</p>
<div class="highlight"><pre><span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">&quot;table2&quot;</span> <span class="na">class=</span><span class="s">&quot;tablesorter&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'last-name'</span><span class="nt">&gt;</span>Last Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'first-name'</span><span class="nt">&gt;</span>First Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'email'</span><span class="nt">&gt;</span>Email<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'dues'</span><span class="nt">&gt;</span>Due<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'web-site'</span><span class="nt">&gt;</span>Web Site<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'action'</span><span class="nt">&gt;</span>Action<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'last-name'</span><span class="nt">&gt;</span>Smith<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'first-name'</span><span class="nt">&gt;</span>John<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'email'</span><span class="nt">&gt;</span>jsmith@gmail.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'dues'</span><span class="nt">&gt;</span>$50.00<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'web-site'</span><span class="nt">&gt;</span>http://www.jsmith.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'action'</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#edit'</span><span class="nt">&gt;</span>edit<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#delete'</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
</pre></div>
<p>With that, the selectors for our sorting tests become a lot simpler and more expressive. Here's an example of the <code>Due</code> ascending test being written against it.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table2 thead .dues'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table2 tbody .dues'</span><span class="p">)</span>
  <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>
  <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
<p>Not only will these selectors work in both current and older browsers, but they are more resilient to changes in the table column order since they're not hard-coded values any more.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Click the column heading</li>
<li>Grab the values for that column</li>
<li>Assert that they are sorted in the correct order (ascending or descending)</li>
</ul>
<h2>Outro</h2>

<p>CSS Pseudo-classes are a great resource and unlock a lot of potential for your tests -- enabling a bit of CSS gymnastics (assuming you've come up with an automation strategy that rules out older browsers).</p>

<p>For more info on CSS Pseudo-classes you should check out <a href="http://sauceio.com/index.php/2010/01/selenium-totw-css-selectors-in-selenium-demystified/">a nice write-up by Sauce Labs</a>. And maybe <a href="http://www.w3.org/TR/css3-selectors/#structural-pseudos">the W3C spec</a>, but that may be a bit more of a rabbit hole than you may want to fall down.</p>

<p>And for a more in-depth walk-through on HTML Table design you can check out <a href="http://blog.teamtreehouse.com/how-to-code-sortable-tabular-data-with-jquery">Treehouse's write-up</a>.</p>
<h1 id="chapter15_13"><small>Chapter 15.13</small><br>Upgrading From Selenium RC</h1>

<p>As the Selenium project continues to evolve, Selenium RC is moving closer to end-of-life. This is especially true with the upcoming release of Selenium 3 where minimal support will be offered for RC (details of which you can learn more about from <a href="http://seleniumhq.wordpress.com/2013/10/09/selenium-hangout-2-recap/">a recent Selenium Hangout</a>).</p>

<p>But how do you approach an upgrade like this? Especially if you have an enormous amount of tests that you rely on?</p>
<h2>A Solution</h2>

<p>Take Jason Leyba's advice. He works at Google and oversaw their transition from Selenium RC to WebDriver. And he posits that it can be done by following 4 simple steps:  </p>

<ul>
<li>Clean up your tests<br></li>
<li>Swap in WebDriver-backed Selenium<br></li>
<li>Use WebDriver for all new features<br></li>
<li>Replace RC usage as tests break<br></li>
</ul>

<p>To give you some context, Google's Selenium tests spawn something on the order of <em>3 million unique browser sessions per day</em>. And they were able to make this transition happen with minimal disruption to this. If they were able to make this happen at such a scale, then hopefully this serves as inspiration for you to do the same at your organization.</p>

<p><strong>NOTE: Jason discussed this in detail in his keynote at Selenium Conf 2013. His talking points and code examples are recapped below. You can view his full talk <a href="http://www.youtube.com/watch?v=cSLmfegT36A">here</a>.</strong></p>
<h2>4 Simple Steps</h2>
<h3>1. Clean Up Your Tests</h3>

<blockquote>
<p>&quot;Turns out that tests that are easy to maintain are tests that are easy to migrate.&quot; -- Jason Leyba</p>
</blockquote>

<p>The best thing you can do to keep your tests clean is to practice good abstractions. In the simplest form this means not referencing Selenium commands directly in your tests -- pulling these out into something like page objects instead.</p>
<h3>2. Swap in WebDriver-backed Selenium</h3>

<p>With WebDriver-backed Selenium you get two driver instances to use in your tests -- one for Selenium RC and another for WebDriver. This enables you to keep your Selenium RC tests running while simultaneously building out WebDriver functionality as you transition things over.</p>

<p>You can see an example of what this looks like <a href="https://code.google.com/p/selenium/wiki/RubyBindings#-backed_Selenium">here</a>.</p>
<h3>3. &amp; 4. Improve Things Incrementally</h3>

<p>For every new feature you write tests for, use WebDriver. And as your Selenium RC tests break go back and replace the broken bits with WebDriver.</p>

<p>Chip away at this over time and before you know it you'll be upgraded!</p>
<h2>Common Pitfalls</h2>

<p>There are a handfull of pitfalls to be cognizant of when stepping through this upgrade.</p>
<h3>Alert Handling</h3>

<p>WebDriver handles JavaScript alerts in a fundamentally different and incompatible way between Selenium RC and WebDriver that won't jive in WebDriver-backed Selenium.</p>

<p>The best way to address this is to port your alert handling from Selenium RC to WebDriver -- which is pretty straightforward and should be easy to accomplish assuming you have things abstracted (re: Step #1 above).</p>

<p>Here is an example of the difference:</p>
<div class="highlight"><pre><span class="c1">// Selenium RC</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">chooseCancelOnNextConfirmation</span><span class="o">();</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">click</span><span class="o">(</span><span class="s">&quot;id=foo&quot;</span><span class="o">);</span>

<span class="c1">// WebDriver</span>
<span class="n">webdriver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">By</span><span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">)).</span><span class="na">click</span><span class="o">();</span>
<span class="n">webdriver</span><span class="o">.</span><span class="na">switchTo</span><span class="o">().</span><span class="na">alert</span><span class="o">().</span><span class="na">dismiss</span><span class="o">();</span>
</pre></div><h3>Waiting For The Page To Load</h3>

<p>There's no need to explicitly wait for the page to load anymore since WebDriver is implicitly doing this. Save your tests some time and remove it. It's also not a bad idea to explicitly wait for the element you wan to interact with.</p>

<p>Here's an example:</p>
<div class="highlight"><pre><span class="c1">// Selenium RC</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">);</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">waitForPageToLoad</span><span class="o">();</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">typeKeys</span><span class="o">(</span><span class="s">&quot;name=q&quot;</span><span class="o">,</span> <span class="s">&quot;bears&quot;</span><span class="o">);</span>

<span class="c1">// WebDriver</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">);</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">typeKeys</span><span class="o">(</span><span class="s">&quot;name=q&quot;</span><span class="o">,</span> <span class="s">&quot;bears&quot;</span><span class="o">);</span>
</pre></div><h3>Getting Text From The Page</h3>

<p>It's an expensive operation (and overkill) to get ALL of the text from the page to make a verification. And it takes longer to execute this in WebDriver.</p>

<p>A better approach is to find the element that has the text you want and check its text instead. Alternatively, if you want to search the entire page, it's better to get the page's source and parse that.</p>
<div class="highlight"><pre><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">selenium</span><span class="o">.</span><span class="na">getBodyText</span><span class="o">();</span>
<span class="n">assertTrue</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">));</span>

<span class="n">WebElement</span> <span class="n">body</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span>
     <span class="n">By</span><span class="o">.</span><span class="na">tagName</span><span class="o">(</span><span class="s">&quot;body&quot;</span><span class="o">));</span>
<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="na">getText</span><span class="o">();</span>
<span class="n">assertTrue</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">));</span>
</pre></div><h3>Be careful with JavaScript</h3>

<p>WebDriver-backed Selenium is not built for performance, it's meant to be a transitional tool. So things will run slower in it. The worst offender being issuing JavaScript commands directly to the Selenium Core API. So do your best to avoid things like this.</p>
<div class="highlight"><pre><span class="n">selenium</span><span class="o">.</span><span class="na">getEval</span><span class="o">(</span>
     <span class="s">&quot;selenium.isElementPresent('id=foo') &amp;&amp; &quot;</span> <span class="o">+</span>
     <span class="s">&quot;selenium.isVisible('id=foo')&quot;</span><span class="o">);</span>
</pre></div><h3>Inertia</h3>

<p>It's worth noting that the hardest part of Google's transition wasn't technical -- it was inertia. Teams were really slow to adopt WebDriver -- even when the tools were readily available, well documented, and easy to use. Jason and his team were able to perservere and succeed through various means (e.g carrot, stick, elbow grease, etc.), but this really slowed their progress.</p>

<p>If you find yourself in a similar situation at your organization, it's worth giving <a href="http://www.youtube.com/watch?v=cSLmfegT36A">Jason's talk</a> a watch for inspiration.</p>
<h1 id="chapter16"><small>Chapter 16</small><br>Finding Information On Your Own</h1>
<h2>Available Resources</h2>

<p>Coming soon...</p>
<h2>Chatting With the Community</h2>

<p>You can go to the heart of the Selenium Community and talk directly with the Committers of the Selenium project and various practioners without ever leaving your house. You can do this by hopping on to the Selenium IRC Chat Channel! It is a great place to ask questions, find answers, and get pointed in the right direction when you're stuck.</p>
<h3>Brief Intro to IRC</h3>

<p>IRC (short for Internet Relay Chat) is a protocol that freely enables live chatting (both in groups and person to person) and file sharing. It's been around for a while (circa 1988) and is the preferred mode of communication among certain tech circles.</p>

<p>Within the realm of IRC there are numerous servers you can connect to. Each one containing people and bots logged in and joined to 1 or more chat rooms talking, sharing files, etc.</p>

<p>One of the beautiful things about IRC is that there is no sign-up required to join the party. You just need to download a client that handles the IRC protocol (there's at least one available for every platform), point it at a server, and pick a unique nickname for yourself on that server.</p>

<p>Once you're on you can join a chat room and start jib-jabbing.</p>
<h3>How To Get Connected</h3>
<h4>Step 1 -- Get an IRC Chat Client</h4>

<p>First thing's first, get a chat client that supports IRC.</p>

<p>You may already have one and not even know. For example, <a href="https://adium.im/">Adium</a> (for OSX) supports a staggering number of chat protocols. If you already have it (or something like it) then use that to connect. If you don't, then you'll need to grab one (or one that is built specifically for IRC).</p>

<p>Here are some worthwhile IRC chat clients (broken out by platform -- and are free unless otherwise noted).</p>

<p><strong>OSX</strong></p>

<ul>
<li><a href="http://limechat.net/mac/">LimeChat</a></li>
<li><a href="http://www.codeux.com/textual/">Textual</a> ($4.99 to buy)</li>
</ul>

<p><strong>Windows</strong></p>

<ul>
<li><a href="http://www.mirc.com/?/">mIRC</a> (free, but asks for donations)</li>
</ul>

<p><strong>Linux</strong></p>

<ul>
<li><a href="http://www.irssi.org/">Irssi</a></li>
</ul>

<p><strong>Web-only</strong></p>

<ul>
<li><a href="http://webchat.freenode.net/">Webchat</a></li>
</ul>
<h4>Step 2 -- Connect to the proper server</h4>

<p>The Selenium chat channel lives on the Freenode server. To connect to it directly you would use <code>irc.freenode.net</code>.</p>

<p>Before connecting you should be able to set a nickname and perhaps even specify which channel you would like to connect to after connecting (e.g. <code>#selenium</code>). If you don't see these bits, don't sweat it. Connect and proceed to the next step.</p>

<p>Note: If you're using Webchat, it will automatically connect you to Freenode.</p>
<h4>Step 3 -- Join the chat channel</h4>

<p>In IRC parlance channels are prepended with a <code>#</code> and are lower-case. So the Selenium channel is <code>#selenium</code>.</p>

<p>If you were able to configure your chat client to join the channel for you, then proceed to the next step. Otherwise, you'll need to issue a command in the status window. There are a series of commands you can issue in IRC. They are all prepended with a <code>/</code>. To join a chat channel type <code>/join #selenium</code> and press <code>Enter</code>.</p>

<p>This should open a new window in the app and in it should be the Selenium chat channel. Woohoo!</p>
<h4>Step 4 -- Talk and hangout!</h4>

<p>Feel free to say hello and introduce yourself. But more importantly, ask your question. And if it looks like no one is chatting, ask it anyway. Someone will see it and eventually respond. They always do.</p>

<p>In order to get your answer, you'll probably want to hang around for a bit. But the benefit of being a fly on the wall is that you quickly gain insight into other problems people face, possible solutions, and the current status of the Selenium project and its various pieces.</p>
<h2>Getting Involved</h2>

<p>Coming soon...</p>

  </body>
</html>
