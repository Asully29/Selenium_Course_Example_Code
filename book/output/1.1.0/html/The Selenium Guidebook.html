<html>
  <head>
    <title>The Selenium Guidebook: How To Use Selenium, successfully</title>
    <style type="text/css">
      @font-face {
        font-family: 'Droid Sans';
        font-style: normal;
        font-weight: 400;
        src: url('droid_sans.ttf');
        -fs-pdf-font-embed: embed;
        -fs-pdf-font-encoding: Identity-H;
      }
      body {
        font-family: 'Droid Sans';
      }
      div.page_footer {
      }
      h1 {
        page-break-before: always;
      }
      pre {
        white-space: pre;
        white-space: pre-wrap;
        page-break-inside: avoid;
        orphans: 0;
        widows: 0;
        background-color: #f5f5f5;
        border: 1px solid #ccc;
        border: 1px solid rgba(0, 0, 0, 0.15);
        border-radius: 4px;
        display: block;
        padding: 9.5px;
        margin: 0 0 10px;
        font-size: 13px;
        line-height: 20px;
      }
      code {
          padding: 2px 4px;
          background-color: #f7f7f9;
      }
      img {
        width: 600px;
      }
      .hll { background-color: #ffffcc }
.c { color: #408080; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cp { color: #BC7A00 } /* Comment.Preproc */
.c1 { color: #408080; font-style: italic } /* Comment.Single */
.cs { color: #408080; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #FF0000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #00A000 } /* Generic.Inserted */
.go { color: #888888 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #7D9029 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #999999; font-weight: bold } /* Name.Entity */
.ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #A0A000 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #BB6688 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
  </head>
  <body>
    <p align="center">
  <img src="bookcover.png" alt="Book Cover Image" style="width: 100%"/>
</p>
<h1>Preface</h1>

<p>This book is not a full and comprehensive treatise that outlines every possible permutation of Selenium (the open-source software test automation tool for web applications). There are other books that already do this. My goal, instead, is to teach you the necessary bits to use Selenium <strong>successfully</strong> for your circumstance.</p>

<p>What you have before you is a distilled and actionable guide culled from my consulting practice and full time positions held doing Quality Assurance over the last five years.</p>

<p>My goal in writing this is to provide you with the materials I wish existed when I was starting out with automated acceptance testing. I hope it serves you well.</p>

<h2>What This Book Will Cover</h2>

<p>This book focuses on the latest version of Selenium (a.k.a. Selenium WebDriver) and its use to test desktop browsers. It's predecessor, Selenium RC, will be covered only insofar as to help you upgrade from it. Mobile testing with Appium will also briefly be covered.</p>

<p>Record and Playback tools like Selenium IDE and Selenium Builder are great for getting started, but abysmal for growing past that point. To that end, they will not be covered in this book. An approach on writing well factored tests, in code, will be the focus instead.</p>

<h2>Who This Book Is For</h2>

<p>This book is for anyone who wants to take automated acceptance testing seriously and isn't afraid to get their hands a little dirty. That is to say, this book is for anyone who wants to use computers for what they are good at, and free up you and people on your team to do what they are inherently good at (which does not include repetitive, mundane testing tasks). And don't worry if you're super new to programming, I'll cover the basics so you'll have a good platform to build from.</p>

<h2>About The Examples In This Book</h2>

<p>The examples in this book are written in Ruby. This is partly because that is the language in which I am strongest. But really, it has more to do with how readable and approachable the language is. By sticking with a scripting language that reads a lot like English, this book can be picked up by almost anyone regardless of their technical background and be immediately useful. And even if Ruby isn't your preferred language, the strategies and patterns used are applicable regardless of your tech stack.</p>

<p>The web functionality used to write tests against is from an open source project called the-internet -- available on <a href="https://github.com/tourdedave/the-internet">GitHub</a> and viewable through <a href="http://the-internet.herokuapp.com/">a Heroku site</a>.</p>

<p>The tests are written for version 2.14 of <a href="http://rspec.info/">RSpec</a> (a popular Ruby testing framework).</p>

<p>All third-party libraries (a.k.a. &quot;gems&quot;) are specified in a <code>Gemfile</code> and installed using <a href="http://bundler.io/">Bundler</a>.</p>

<p>This book is accompanied by a zipfile of all code examples referenced in the text. If you get stuck or want a quick reference on how something is supposed to look -- take a look there. There are a number of issues you may run into, and this is sure to help save you some time and headache.</p>

<h2>How To Read This Book</h2>

<p>Chapters 1 through 5 are focused on priming you with knowledge and questions to consider when it comes to test strategy, language selection, and test design. Chapter 6 is where we first start to code. From there, the examples build upon each other through chapter 16.</p>

<p>Chapter 17 is an accumulation of 13 sub-chapters which outline things you will likely see and how to address them. They do not build upon each other or other parts of the book, and are each meant to stand alone.</p>

<p>Code examples will correspond to each chapter number. For chapters with multiple parts, code examples will be broken up into numbered sub-folders (e.g., code examples referenced in Part 2 of Chapter 9 can be found in <code>code_examples/09_base_page_object/02/</code>).</p>

<h2>Feedback</h2>

<p>If you find a glitch in the book (e.g., grammar issue, code issue, etc.) or have questions/feedback -- please feel free to e-mail me at <a href="mailto:dhaeffner@gmail.com">dhaeffner@gmail.com</a>.</p>

<p>If you submit something and I end up using it in a future version of the book, I'll give you a shout-out in the acknowledgements.</p>
<h1>Acknowledgements</h1>

<p>I'd like to take a moment to thank the following people (sorted alphabetically by last name):</p>

<ul>
<li>Matt Allen</li>
<li>Donald Bialer</li>
<li>Katy Burns</li>
<li>Sergey Franchuk</li>
<li>Brian Goad</li>
<li>Jonathan Lipps</li>
<li>Mary Ann May-Pumphrey</li>
<li>Jimi Odeyemi</li>
<li>Kent O'Driscoll</li>
<li>Matthew Pickle</li>
<li>Ken Pier</li>
<li>Jason Riley</li>
<li>Dmytro Shpakovskyi</li>
<li>Ilkka Urtti</li>
</ul>

<p>Katy, I somehow convinced you that doing one-on-one sessions with me over Google Hangout an hour a week would be a great way to learn more about Selenium. Over the course of that time an outline for the book emerged, and with your feedback and insights I was able to shape it into something useful and compelling. Without your help, I'm not sure how far along the book would be or if it would be as useful.</p>

<p>Brian, Ken, Jonathan, and Mary Ann -- your feedback was thorough and challenging. You asked tough questions and provided great suggestions for improvements. A good deal of the book has been rewritten based on your feedback. Examples have been refined. Concepts have been made more concise. And generally, there is a better build-up and flow throughout the book.</p>

<p>Donald, Dmytro, Ilkka, Jimi, Jason, Kent, Matt, Matthew, and Sergey -- your feedback has helped refine the book into something much more clear and concise than it was before. I'm ecstatic that you got so much out of reading it and provided so much great feedback in return.</p>

<p>THANK YOU!</p>
<h1>Table of Contents</h1><ol>
<li><a href="#chapter1">Selenium In A Nutshell</a></li>
<li><a href="#chapter2">Defining A Test Strategy</a></li>
<li><a href="#chapter3">Picking A Language</a></li>
<li><a href="#chapter4">A Programming Primer</a></li>
<li><a href="#chapter5">Anatomy Of A Good Acceptance Test</a></li>
<li><a href="#chapter6">Writing Your First Test</a></li>
<li><a href="#chapter7">Verifying Your Locators</a></li>
<li><a href="#chapter8">Writing Re-usable Test Code</a></li>
<li><a href="#chapter9">Writing Really Re-usable Test Code</a></li>
<li><a href="#chapter10">Writing Resilient Test Code</a></li>
<li><a href="#chapter11">Prepping For Use</a></li>
<li><a href="#chapter12">Running A Different Browser Locally</a></li>
<li><a href="#chapter13">Running Browsers In The Cloud</a></li>
<li><a href="#chapter14">Speeding Up Your Test Runs</a></li>
<li><a href="#chapter15">Organizing Your Test Runs</a></li>
<li><a href="#chapter16">Automating Your Test Runs</a></li>
<li><a href="#chapter17">Things You will See And How To Work With Them</a></li>
<ul><ol>
<li><a href="#chapter18">A/B Testing</a></li>
<li><a href="#chapter17_2">Basic Auth</a></li>
<li><a href="#chapter17_3">Checkboxes</a></li>
<li><a href="#chapter17_4">Drag And Drop</a></li>
<li><a href="#chapter17_5">Dropdown Lists</a></li>
<li><a href="#chapter17_6">File Download (Browser Agnostic)</a></li>
<li><a href="#chapter17_7">File Download (Browser Specific)</a></li>
<li><a href="#chapter17_8">File Upload</a></li>
<li><a href="#chapter17_9">Forgot Password</a></li>
<li><a href="#chapter17_10">Frames</a></li>
<li><a href="#chapter17_11">HTTP Status Codes</a></li>
<li><a href="#chapter17_12">Multiple Windows</a></li>
<li><a href="#chapter17_13">Secure File Downloads</a></li>
<li><a href="#chapter17_14">Selenium Grid</a></li>
<li><a href="#chapter17_15">Tables</a></li>
<li><a href="#chapter17_16">Upgrading From Selenium RC</a></li>
</ol></ul>
<li><a href="#chapter18">Finding Information On Your Own</a></li>
<li><a href="#chapter19">Now You Are Ready</a></li>
</ol>
<h1 id="chapter1"><small>Chapter 1</small><br>Selenium In A Nutshell</h1>
<h2>What Selenium Is and Is Not Good At</h2>

<p>Selenium is a software robot sent from the future to help us test web applications. But keep in mind that it's not one of those fancy shape-shifting robots than can run really fast. Instead it's more like one of those really strong robots that's not very fast and is best suited for accomplishing a certain objective.</p>

<p>That is to say -- Selenium is really good at a specific set of things. If you know what those are and stick to them then you will be able to easily write reliable, scalable, and maintainable tests that you and your team can trust.</p>

<p>Selenium is built to automate browsers, specifically human interaction with them -- things like navigating to pages, clicking, typing, dragging, and dropping.</p>

<p>It's less ideal for checking lower-level functionality like HTTP status codes or HTTP headers. While you can use Selenium this way, it necessitates additional setup of a third-party tool (e.g., BrowserMob Proxy), and it can be a bit of a rabbit hole to fall down since there are numerous test cases to consider at this level.</p>
<h2>Selenium Highlights</h2>

<p>Selenium works on every major browser, with a number of major programming languages, and on every major operating system. Each language binding and browser are actively being developed to stay current. Yes, even Internet Explorer (thanks to <a href="https://twitter.com/jimevansmusic">Jim Evans</a>!).</p>

<p>Selenium can be run on your local computer, on a server (with Selenium Remote), on your own set of servers (with Selenium Grid), or on a third-party cloud provider (like <a href="http://saucelabs.com/">Sauce Labs</a>). As your test suite grows, your test runs will take longer to complete. To speed them up you will want to run them in parallel, which is where the benefit of having your own servers or using a cloud provider comes in -- that, and the ability to have numerous browser and operating system combinations.</p>

<p>One of the guiding philosophies of Selenium is to be able to write your tests once and run them across multiple browsers. While this is a rosy picture, it's not entirely accurate. There are plenty of gotchas to watch out for. We'll cover these in detail throughout the book.</p>
<h1 id="chapter2"><small>Chapter 2</small><br>Defining A Test Strategy</h1>

<p>A great way to increase your chances of automated web testing success is to first map out a testing strategy. And the best way to do it is to answer these four questions:</p>

<ol>
<li>How does your business make money?<br></li>
<li>How do your users use your application?<br></li>
<li>What browsers are your users using?<br></li>
<li>What things have broken in the application before?<br></li>
</ol>

<p>Note: for entities that don't deal <em>directly</em> in dollars and cents (e.g., non-profits, federal agencies, etc.) you should focus on how the application generates value for the end user.</p>

<p>After answering these questions, you should have an understanding of the functionality and browsers that matter to the application you are testing. This will help you narrow down your efforts to the things that matter most.</p>

<p>This strategy works best for applications with existing functionality and does not speak directly to testing new functionality that's being actively developed. That's not to say that the two couldn't co-exist. It largely depends on your available resources and pace of development. But in order to reach high quality at speed, you first have to go slow.</p>
<h2>What To Do With The Answers</h2>

<p>After answering these you should end up with a prioritized backlog of test automation tasks that you can work off of and track progress against.</p>
<h3>Question 1: Money/Value</h3>

<p>Every company's application makes money (or generates value) through core functionality that is defined by a series of increasingly-valuable user interactions -- a.k.a. the 'funnel'. Your answers to this question will help you determine what your funnel is.</p>

<p>This will be your highest priority for automation. Start an automation backlog to keep track.</p>
<h3>Question 2: Usage Data</h3>

<p>Odds are your application offers a robust set of functionality well beyond the funnel. Your answers to this question will help highlight what it is. And if you're basing these answers on usage data, then it will be broken down from highly used to lightly used. Tack these items onto your automation backlog based on their frequency of use.</p>
<h3>Question 3: Browsers</h3>

<p>Now that you know what functionality is business critical and widely adopted by your users, you need to determine what browsers to focus your automated web testing efforts on. Your usage data will tell you this as well. It will help you determine which browsers you can reasonably avoid testing in (e.g., based on non-existent or low usage numbers). Note the top 2 (or 3 depending on your numbers), but focus on the top 1 for now. This is the browser you will start using for automation.</p>
<h3>Question 4: Risky Bits</h3>

<p>To round out the strategy it is also best to think about what things have broken in the application before. To answer this question it's best to check your defect/bug tracker (if you have one) and to ask around your team. What you end up with may read like a laundry list of browser specific issues or functionality that has been flaky or forgotten about in the past.</p>

<p>Be sure to check this list against your automation backlog. If it's not there, add it to the bottom of the backlog. If it is there, make a note in the backlog item that this has been an issue in the past.</p>

<p>If the issue has happened numerous times and has the potential to occur again, move that backlog item up in priority. And if issues keep cropping up that are related to a specific browser, compare this browser to your short list from question #3. If it's a browser that's not in your list but it's still important (e.g., a small pocket of users), track it on the backlog, but put it at the bottom.</p>
<h2>Now You Are Ready</h2>

<p>Having answered these questions, you should now have a prioritized backlog of critical business functionality, a short list of browsers to focus on, and an understanding of the risky parts of your application to watch out for. With it, you should be able to make sure you are on the right track -- focusing on things that matter for the business and its users.</p>
<h1 id="chapter3"><small>Chapter 3</small><br>Picking A Language</h1>

<p>In order to work well with Selenium, you need to choose a programming language to write your acceptance tests in. Conventional wisdom will tell you to choose the same language as what the application is written in. That way if you get stuck you can ask the developers on your team for help. But if you're not proficient in this language (or new to development), then your progress will be slow and you'll likely end up asking for more developer help than they have time for -- hindering your automation efforts and setting you up for failure.</p>

<p>A great way to determine which language to go with is to answer one simple question: <strong>Who will own the automated tests?</strong></p>

<p>The answer to this, and the discussion that unfolds from it, will help you more effectively choose a programming language.</p>
<h2>What To Do With The Answer</h2>

<p>If you're a tester (or a team of testers) and you will be building and maintaining the test automation, then it's best to consider what languages you (and your team) already have experience with, or are interested in gaining experience with, rather than what the application is built in. Your Selenium tests <strong>DO NOT</strong> have to be written in the same language as the application you are testing. Have a discussion with your team to see what interests them and go from there.</p>

<p>For example, there's not much advantage in writing your test automation in Java if your team has no previous development experience and will be the ones owning it. Instead, try to choose a language that is more approachable -- e.g., a scripting language like Ruby or Python.</p>

<p>But if you're a developer who is working on the application and just looking to add automated acceptance testing to the mix, then it makes sense to continue with the same language.</p>
<h2>Some Additional Food For Thought</h2>

<p>As your suite of tests grows you will find the need to add functionality to make things easier to use, run faster, offer better reporting, etc. When this happens you will effectively be doing two jobs, no longer just writing automated tests but also growing a framework (a.k.a. a test harness).</p>

<p>As you are considering which language to go with, consider what open source frameworks already exist for the languages you are eyeing. Going with one will save you a lot of time and give you a host of functionality out of the box that you would otherwise have to build and maintain yourself -- and it's FREE.</p>

<p>You can see a list of open source Selenium WebDriver frameworks and their respective languages <a href="http://davehaeffner.com/resources/selenium-frameworks/">here</a>.</p>
<h2>Outro</h2>

<p>Choosing a programming language for automated testing is not a decision that should be taken lightly. If you're just starting out (or looking to port your tests) then considering and discussing these things will help position you for greater success.</p>

<p>With all that being said, the rest of this book will show you how to build your own framework (in addition to writing well factored tests) in Ruby.</p>
<h1 id="chapter4"><small>Chapter 4</small><br>A Programming Primer</h1>

<p>This section will prime you with just enough programming concepts (and how they pertain to testing) to get you going so that you have some working knowledge and a vocabulary that will enable you to more effectively comprehend what you will see throughout the remainder of this book and in your work after you put this book down.</p>

<p>Don't get too hung up on the details yet. If something doesn't make sense, it should once we dig into the full examples in the following chapters. Consider this more of a glossary than a code school.</p>
<h2>Installation</h2>

<p>Ruby is a quickly-evolving ecosystem. In order to find the latest on how to install Ruby, I encourage you to <a href="https://www.ruby-lang.org/en/installation/">check out the official Ruby site's download page</a>.</p>

<p>That being said, here are some install instructions to help you get started quickly.</p>

<ul>
<li><a href="http://davehaeffner.com/selenium-guidebook/install/ruby/linux/">Linux</a></li>
<li><a href="http://davehaeffner.com/selenium-guidebook/install/ruby/mac/">OSX</a></li>
<li><a href="http://davehaeffner.com/selenium-guidebook/install/ruby/windows/">Windows</a></li>
</ul>

<p>If you plan on doing serious development with Ruby, then I would consider using a version manager instead of a direct Ruby installation (e.g., <a href="http://rvm.io/">RVM</a> or <a href="https://github.com/sstephenson/rbenv">rbenv</a>). This will enable you to run different versions of Ruby at the same time on your machine as well as have different sets of gems. It's crucial if you plan to work with multiple projects in Ruby that have different dependencies. But it's not required for this book.</p>

<p>The examples in this book have been test in Ruby 1.9.3 and 2.1.1. So as long as you have a fairly recent version (at least 1.9.3) you should be good to go.</p>
<h2>Installing Third-Party Libraries</h2>

<p>One of the main benefits of Ruby is that it has a vibrant open source community with copious libraries (a.k.a. &quot;gems&quot;) immediately available, making it extremely simple to quickly build complex things. You can find out more information on gems on <a href="https://www.ruby-lang.org/en/libraries/">the official Ruby site's libraries page</a>.</p>

<p>To install a gem, you just have to type <code>gem install</code> and the gem name (from your command-line) -- e.g., <code>gem install selenium-webdriver</code>. If you get a permission error then you will need to start the command with <code>sudo</code> in order to temporary elevate your terminal session to the correct level (e.g., <code>sudo gem install selenium-webdriver</code>). When this happens, you will be prompted for your password. Once provided, the gem will install and you'll be able to move forward.</p>

<p>A helpful library called <a href="http://bundler.io/">Bundler</a> is a great way to easily manage gems within a project. This is what I use and what was used in building out the examples for this book. All you need to know is that if you see a <code>Gemfile</code> in a directory, just run <code>bundle install</code> from your terminal window (assuming you have already installed the bundler gem -- <code>gem install bundler</code>). When you do, all the necessary gems (and their dependencies) will be installed for you.</p>
<h2>Interactive Prompt</h2>

<p>One of the immediate advantages to using a scripting language like Ruby is that you get access to an interactive prompt -- just type <code>irb</code> (which stands for interactive ruby shell) from the command-line. It will load a prompt that looks like this:</p>
<div class="highlight"><pre>irb<span class="o">(</span>main<span class="o">)</span>:001:0&gt;
</pre></div>
<p>In this prompt you can type out Ruby code. It will evaluate it and return the result. As you step through this chapter, it will serve as a great place to practice the commands and concepts you will see.</p>

<p>When you're done, just type <code>quit</code>.</p>
<h2>Choosing A Text Editor</h2>

<p>In order to write Ruby code, you will need to use a text editor. Some popular ones in the Ruby community are <a href="http://www.vim.org/">Vim</a>, <a href="http://www.gnu.org/software/emacs/">Emacs</a>, and <a href="http://www.sublimetext.com/">Sublime Text</a>.</p>

<p>It's important to pick an editor that works for you and makes you productive. So if you're new to programming and text editors, then it's probably best to go with something more intuitive like Sublime Text.</p>
<h2>Programming Concepts In A Nutshell</h2>

<p>Programming can be a deep and intimidating rabbit hole if you're new to it. But don't worry. When it comes to testing there is only a small subset of Ruby that we really need to work with to get started. Granted, the more you know, the better off you'll be. But you don't need to know a whole lot to be an effective test automator right now.</p>

<p>Of all the programming concepts out there, here are the ones you'll need to pay attention to first:</p>

<ul>
<li>Objects Structures (Variables, Methods, and Classes)</li>
<li>Scope</li>
<li>Object Types (Strings, Numbers, Collections, Booleans)</li>
<li>Actions (Assertions, Conditionals, Iteration)</li>
<li>Inheritance</li>
</ul>

<p>Let's step through each and how they pertain to testing with Selenium.</p>
<h2>Object Structures</h2>
<h3>Variables</h3>

<p>Variables are places to store and retrieve values of various types (e.g., Strings, Integers, Booleans, Collections, etc). Variables are created and referenced with names that:</p>

<ul>
<li>can be one or more words in length</li>
<li>use an underbar (<code>_</code>) to separate the words (e.g., <code>example_variable</code>)</li>
<li>start with a lowercase letter</li>
<li>are often entirely lowercase</li>
</ul>

<p>You can place things into them by using an equals sign (<code>=</code>). And a variable takes on the type of the value you store in it (more on object types later).</p>
<div class="highlight"><pre><span class="nv">example_variable</span> <span class="o">=</span> <span class="s2">&quot;42&quot;</span>
puts example_variable.class
<span class="c"># outputs: String</span>

<span class="nv">example_variable</span> <span class="o">=</span> 42
puts example_variable.class
<span class="c"># outputs: Fixnum</span>
</pre></div>
<p>In the above example <code>puts</code> is used to output a message. This is a common command that is useful for generating output to the terminal.</p>

<p>In Selenium, a common example of a variable is storing an element (or the value from an element) in the beginning of a test to be referenced later. For example, getting a page's title.</p>
<div class="highlight"><pre><span class="n">page_title</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span>
</pre></div>
<p><code>@driver</code> is the variable we will use to interact with Selenium. More on why it uses <code>@</code> soon (in Scope).</p>
<h3>Methods</h3>

<p>One way to group common actions and behavior for easy reuse is to place them into methods. We define a method with the opening keyword <code>def</code>, a name (in the same fashion as a variable), and close it with the keyword <code>end</code>. Referencing a method is done the same way as a variable -- by it's name.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">example_method</span>
  <span class="c1"># your code</span>
  <span class="c1"># goes here</span>
<span class="k">end</span>

<span class="n">example_method</span>
</pre></div>
<p>Additionally, we can specify arguments we want to pass in when calling the method.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">message</span>
<span class="k">end</span>

<span class="n">say</span> <span class="s1">'Hello World!'</span>

<span class="c1"># outputs:</span>
<span class="c1"># Hello World!</span>
</pre></div>
<p>When setting an argument, we can also set a default value to use if no argument is provided.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="s1">'Hello World!'</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">message</span>
<span class="k">end</span>

<span class="n">say</span>
<span class="n">say</span> <span class="s1">'something else'</span>

<span class="c1"># outputs:</span>
<span class="c1"># Hello World!</span>
<span class="c1"># something else</span>
</pre></div>
<p>We'll see this tactic used in Selenium when we are setting up our explicit wait action (more on that in Chapter 10).</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div><h3>Classes</h3>

<p>Classes are a useful way to represent concepts that will appear numerous times in multiple places.</p>

<p>They can contain variables and methods, and are defined with the word <code>class</code> followed by the name you wish to give it. Class names:</p>

<ul>
<li>must start with a capital letter</li>
<li>should be CamelCase for multiple words (e.g., <code>class ExampleClass</code>)</li>
<li>should be descriptive</li>
</ul>

<p>You first have to define a class, and then create an instance of it (a.k.a. instantiation) in order to use it. Once you have this instance, you can access the methods within it to trigger an action.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Message</span>
  <span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="s1">'Hello World!'</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="n">message</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">message_instance</span> <span class="o">=</span> <span class="no">Message</span><span class="o">.</span><span class="n">new</span>
<span class="n">message_instance</span><span class="o">.</span><span class="n">say</span> <span class="s1">'This is an instance of a class'</span>

<span class="c1"># outputs: This is an instance of a class</span>
</pre></div>
<p>An example of this in Selenium is the representation of a web page -- also known as a 'Page Object'. In it you store the page's elements and behavior.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Login</span>
  <span class="no">LOGIN_FORM</span>  <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span> <span class="p">}</span>
  <span class="no">USERNAME_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span> <span class="p">}</span>
  <span class="no">PASSWORD_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">with</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>The variables that are fully capitalized are called constants, the values in braces (<code>{}</code>) are called hashes, and they are using something called symbols. More on all that soon.</p>
<h2>Scope</h2>

<p>Now that we have our different object structures it's worth briefly noting how they can and cannot access one another -- a.k.a. Scope. The easiest way to do this is by discussing the different types of variables you are likely to run into.</p>
<h3>Local Variables</h3>

<p>Local variables enable you to store and retrieve values from within a confined area (this is no different than what was described in the variables section earlier). A variable that was declared within a method is a great example of this. It is useful within the method, but inaccessible outside of it.</p>

<p>In your Selenium tests, a local variable will only be available from within the test that it was created.</p>
<h3>Instance Variables</h3>

<p>Instance variables enable you to store and retrieve values more broadly -- both inside and outside of methods. They are annotated the same way as regular variables, except that they are prepended with an <code>@</code>.</p>

<p>A common example you will see throughout this book is the usage of a <code>@driver</code> variable. This is an instance of Selenium. This object is what enables us to control the browser. Storing it as an instance variable enables our test to more easily use it.</p>
<h3>Constants</h3>

<p>Constants are for storing information that will not dynamically change. They are easy to spot since they start with a capital letter, and are often all uppercase. They share similarities to instance variables since they can be accessed more broadly.</p>

<p>They are commonly used to store element locator information at the top of Page Objects.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Login</span>

  <span class="no">LOGIN_FORM</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span> <span class="p">}</span>
  <span class="no">USERNAME_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span> <span class="p">}</span>
  <span class="no">PASSWORD_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div><h3>Global Variables</h3>

<p>Global variables are a way to make information available to an entire program. They start with a dollar-sign (<code>$</code>) and are created the same way as regular variables.</p>
<div class="highlight"><pre><span class="vg">$example_global_variable</span> <span class="o">=</span> <span class="s1">'value you want to make widely available'</span>
</pre></div>
<p>They are powerful since they are so widely accessible and can be of any type. But they should be used sparingly because there are more intuitive and effective ways to construct your programs.</p>

<p>You will see them used in your tests for rare one-off circumstances when you need to access something that is not available within your current scope and an environment variable has not been set for it either.</p>
<h3>Environment Variables</h3>

<p>Environment variables are a way to pass information into Ruby from the command-line. They are also a way to make a value globally accessible (e.g., across an entire program). They can be set and retrieved from within your code by:</p>

<ul>
<li>starting with the keyword <code>ENV</code></li>
<li>specifying the name of the variable in brackets (<code>ENV[]</code>)</li>
<li>surrounding the variable name with single-quotes (<code>ENV['']</code>)</li>
<li>setting a value for the variable using an equals sign (<code>ENV['example_variable'] =</code>)</li>
<li>specifying a value to store in the variable with single quotes (<code>ENV['example_variable'] = 'example value'</code>)</li>
</ul>

<p>Environment variables are often used to store configuration values that could change. A great example of this is the base URL for your application.</p>
<div class="highlight"><pre><span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
</pre></div>
<p>To change the value when running your Ruby application, you just have to specify a new value before the application.</p>
<div class="highlight"><pre><span class="nv">base_url</span><span class="o">=</span><span class="s1">'http://localhost:4567'</span> ruby example_script.rb
</pre></div><h2>Object Types</h2>
<h3>Strings</h3>

<p>Strings are alpha-numeric characters strung together (e.g., letters, numbers, and most special characters) surrounded by either single (<code>'</code>) or double (<code>&quot;</code>) quotes. Single quotes are encouraged unless you intend to manipulate the string value through a tactic called interpolation -- which enables you to inject code into your string to create dynamic output.</p>
<div class="highlight"><pre><span class="n">motd</span> <span class="o">=</span> <span class="s1">'Hello World!'</span>
<span class="nb">puts</span> <span class="s2">&quot;The message of the day is: </span><span class="si">#{</span><span class="n">motd</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># outputs:</span>
<span class="c1"># The message of the day is: Hello World!</span>
</pre></div>
<p>You'll also want to use double-quotes if you need to have a single quote in your string.</p>
<div class="highlight"><pre><span class="nb">puts</span> <span class="s2">&quot;How's this?&quot;</span>
</pre></div>
<p>You'll run into Strings when working with copy on a page (e.g., pulling a page's URL, title, or h1 tag to determine if your test is in the right place before proceeding).</p>
<h3>Numbers</h3>

<p>You can do a lot of math in Ruby. The two common types of numbers you will run into with testing are Fixnum (whole numbers or integers) and Float (decimals).</p>

<p>If you have a test that needs to pull some values from a page and add/subtract/multiply/divide/etc them, then this will come in handy. Although, you may need to convert the values from a String to an Fixnum first -- which is trivial to do in Ruby since it is a dynamically typed language.</p>
<div class="highlight"><pre><span class="n">count</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#count'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">to_i</span>
<span class="c1"># do your comparison or maths with count here</span>
</pre></div>
<p>The conversion from a String to an Fixnum was done with <code>.to_i</code> (the 'i' stands for Integer). If you're working with decimals, you can use <code>.to_f</code> to convert it to a Float instead.</p>
<h3>Collections</h3>

<p>Collections enable you to gather a set of data for later use.</p>

<p>In Ruby there are two types of built-in collections -- Arrays and Hashes. Array values are stored in an ordered list, each with an index number (which starts at 0), and are surrounded by square brackets (<code>[]</code>). Hashes store values in the order they were added -- but use a key/value pair to store and retrieve data. Hashes are surrounded by braces (<code>{}</code>).</p>

<p>Both Arrays and Hashes are able to receive values of any type.</p>
<div class="highlight"><pre><span class="c1"># Array Example</span>

<span class="n">an_array</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;four&quot;</span><span class="o">]</span>
<span class="nb">puts</span> <span class="n">an_array</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="nb">puts</span> <span class="n">an_array</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
<span class="nb">puts</span> <span class="n">an_array</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
<span class="nb">puts</span> <span class="n">an_array</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>

<span class="c1"># outputs:</span>
<span class="c1"># one</span>
<span class="c1"># 2</span>
<span class="c1"># 3.0</span>
<span class="c1"># four</span>
</pre></div>
<p>Note that in the array we are storing two strings, a fixnum, and a float. And we are accessing each of the values by their index.</p>

<p>You'll end up working with Arrays (or some type of object that is of a similar construct) if you need to test things like HTML data tables, drop-down lists, or if you need to take an action against a specific element within a large list but there are no specific locators for it.</p>
<div class="highlight"><pre><span class="c1"># Hash Example</span>

<span class="n">a_hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">one</span><span class="p">:</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="ss">two</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">three</span><span class="p">:</span> <span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">}</span>
<span class="nb">puts</span> <span class="n">a_hash</span><span class="o">[</span><span class="ss">:one</span><span class="o">]</span>
<span class="nb">puts</span> <span class="n">a_hash</span><span class="o">[</span><span class="ss">:two</span><span class="o">]</span>
<span class="nb">puts</span> <span class="n">a_hash</span><span class="o">[</span><span class="ss">:three</span><span class="o">].</span><span class="n">class</span>

<span class="c1"># outputs:</span>
<span class="n">one</span>
<span class="mi">2</span>
<span class="nb">Array</span>
</pre></div>
<p>Note that in the hash we are storing a string, a fixnum, and an array. And we are accessing each of the values by their key -- which in this case starts with a colon (<code>:</code>). This type of object is known as a Symbol, and it is often used as an identifier in Ruby.</p>

<p>You'll end up working with Hashes and Symbols in your Page Objects to store and retrieve your page's locators.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Login</span>

  <span class="no">LOGIN_FORM</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span> <span class="p">}</span>
  <span class="no">USERNAME_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span> <span class="p">}</span>
  <span class="no">PASSWORD_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div><h3>Booleans</h3>

<p>Booleans are binary values that are returned when asking a question of your code. They are what enable us to complete assertions.</p>

<p>There are numerous ways to ask questions. Some involve various <a href="http://www.tutorialspoint.com/ruby/ruby_operators.htm">comparison operators</a> (e.g., <code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=&gt;</code>), and others end in a question mark (e.g., <code>include?</code>). The response is either <code>true</code> or <code>false</code>.</p>
<div class="highlight"><pre><span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'The Internet'</span><span class="p">)</span>

<span class="c1"># outputs: true</span>
</pre></div><h2>Actions</h2>
<h3>Assertions</h3>

<p>Assertions are made against booleans and result in either a passing or failing test. In order to leverage assertions we will need to use a testing framework (e.g., <a href="http://rspec.info/">RSpec</a>, <a href="https://github.com/seattlerb/minitest">minitest</a>, or <a href="http://www.ruby-doc.org/stdlib-2.1.2/libdoc/test/unit/rdoc/Test/Unit.html">test-unit</a>) -- for this book we will be using RSpec (version 2.14).</p>

<p>RSpec enables easy to read assertions through it's <a href="https://github.com/rspec/rspec-expectations/blob/master/Should.md#using-built-in-matchers">built-in matchers</a>. With them, our assertions will start with things like <code>should</code>, <code>should_not</code>, <code>should be</code>, <code>should include</code>.</p>

<p>We use these matchers by calling them on the variable we want to ask a question of.</p>
<div class="highlight"><pre><span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should</span> <span class="kp">include</span><span class="p">(</span><span class="s1">'The Internet'</span><span class="p">)</span>

<span class="c1"># or</span>

<span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="n">title_boolean</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'The Internet'</span><span class="p">)</span>
<span class="n">title_boolean</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
</pre></div>
<p>Both approaches will work, resulting in a passing assertion. If this is the only assertion in your test (more on good test writing practices in Chapter 5), then this will result in a passing test.</p>
<h3>Conditionals</h3>

<p>Conditionals work off of booleans as well and enable you to accomplish different things based on context.</p>

<p>The most common conditionals in Ruby are <code>if</code> and <code>case</code> statements. They both accomplish the same thing. They are just stylistically different approaches (with some minute performance differences). Which approach you end up going with initially is really just a matter of preference.</p>
<div class="highlight"><pre><span class="n">number</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">if</span> <span class="n">number</span> <span class="o">&gt;</span> <span class="mi">10</span>
  <span class="nb">puts</span> <span class="s1">'The number is greater than 10'</span>
<span class="k">elsif</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">10</span>
  <span class="nb">puts</span> <span class="s1">'The number is less than 10'</span>
<span class="k">elsif</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">10</span>
  <span class="nb">puts</span> <span class="s1">'The number is 10'</span>
<span class="k">else</span>
  <span class="nb">puts</span> <span class="s2">&quot;I don't know what the number is.&quot;</span>
<span class="k">end</span>

<span class="c1"># outputs: The number is 10</span>
</pre></div>
<p>Note that in order to do an else/if statement it is <code>elsif</code>, not <code>elseif</code>.</p>
<div class="highlight"><pre><span class="n">number</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">case</span> <span class="n">number</span>
<span class="k">when</span> <span class="mi">11</span><span class="o">.</span><span class="n">.</span><span class="mi">100</span>
  <span class="nb">puts</span> <span class="s1">'The number is greater than 10'</span>
<span class="k">when</span> <span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">9</span>
  <span class="nb">puts</span> <span class="s1">'The number is less than 10'</span>
<span class="k">when</span> <span class="mi">10</span>
  <span class="nb">puts</span> <span class="s1">'The number is 10'</span>
<span class="k">else</span>
  <span class="nb">puts</span> <span class="s2">&quot;I don't know what the number is.&quot;</span>
<span class="k">end</span>
</pre></div>
<p>You can do <code>&gt;</code> and <code>&lt;</code> comparisons in a <code>case</code> statement as well, but it ends up looking quite a bit like an <code>if</code> block -- which takes away from the simplicity of the <code>case</code> statement.</p>

<p>You may end up working with Conditionals in your Page Objects. This is more likely if your application has tiered user accounts or if you support older browsers and run into issues with the locators you are using.</p>
<h3>Iteration</h3>

<p>Collections wouldn't be nearly as valuable without the ability to iterate over them one at a time. And in Ruby, it's simple to do. The syntax may initially feel awkward, but once you get the hang of it, it is pretty straightforward.</p>

<p>Each collection comes with a set of methods that enables various iterative functionality. The most common one is <code>.each</code>. When using it you will need to specify a block of code and a variable.</p>

<p>The variable will be enclosed in pipes (<code>||</code>). It represents each piece of the collection and is accessible only within the code block. The code block will open and close with the keywords <code>do</code> and <code>end</code>. In between the keywords is where you will put the code you want to execute (which will interact with the variable).</p>
<div class="highlight"><pre><span class="n">numbers</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="o">]</span>
<span class="n">numbers</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">number</span>
<span class="k">end</span>

<span class="c1"># outputs:</span>
<span class="c1"># 1</span>
<span class="c1"># 2</span>
<span class="c1"># 3</span>
<span class="c1"># 4</span>
<span class="c1"># 5</span>
<span class="c1"># 6</span>
<span class="c1"># 7</span>
<span class="c1"># 8</span>
<span class="c1"># 9</span>
<span class="c1"># 10</span>
</pre></div>
<p>After setting numbers to an array we are able to iterate over it and display each of its values with <code>puts</code>.</p>

<p>We can take this approach and couple it with a conditional to influence the output.</p>
<div class="highlight"><pre><span class="n">numbers</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="o">]</span>
<span class="n">numbers</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">number</span> <span class="k">if</span> <span class="n">number</span> <span class="o">&gt;</span> <span class="mi">5</span>
<span class="k">end</span>

<span class="c1"># outputs:</span>
<span class="c1"># 6</span>
<span class="c1"># 7</span>
<span class="c1"># 8</span>
<span class="c1"># 9</span>
<span class="c1"># 10</span>
</pre></div>
<p>Iteration will come in handy in your Selenium tests if you have to loop over a collection of page elements to interact with them (e.g., HTML data tables, drop-down lists, etc.).</p>
<h3>Inheritance</h3>

<p>Classes have the ability to connect to one-another through parent/child inheritance. By having a single parent class we can store common actions in methods that can be readily available to all child classes.</p>

<p>Inheritance is done when declaring a child class by:
+ providing the class name
+ using a less-than symbol (<code>&lt;</code>)
+ providing the name of the parent class</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Parent</span>
  <span class="k">def</span> <span class="nf">hair_color</span>
    <span class="nb">puts</span> <span class="s1">'Brown'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Child</span> <span class="o">&lt;</span> <span class="no">Parent</span>
<span class="k">end</span>

<span class="n">child</span> <span class="o">=</span> <span class="no">Child</span><span class="o">.</span><span class="n">new</span>
<span class="nb">puts</span> <span class="n">child</span><span class="o">.</span><span class="n">hair_color</span>

<span class="c1"># outputs: Brown</span>
</pre></div>
<p>You'll see this in your tests when writing all of the common Selenium actions you intend to use into methods in a parent class. Inheriting this class will allow you to call these methods in your child classes (more on this in Chapter 9).</p>
<h2>Additional Resources</h2>

<p>If you want to dive deeper into Ruby then I encourage you to check out some of the following resources:</p>

<ul>
<li><a href="https://rubymonk.com/">Ruby Monk</a></li>
<li><a href="http://www.codecademy.com/tracks/ruby">Codecademy</a></li>
<li><a href="http://pragprog.com/book/ltp2/learn-to-program">Learn To Program</a></li>
<li><a href="http://pragprog.com/book/ruby/programming-ruby">The Pick-axe book</a></li>
<li><a href="http://pragmaticstudio.com/ruby">The Pragmatic Studio's Online Course</a></li>
</ul>
<h1 id="chapter5"><small>Chapter 5</small><br>Anatomy Of A Good Acceptance Test</h1>

<p>In order to write acceptance tests that perform well and are both maintainable and resilient there are some simple guidelines to follow:</p>

<ul>
<li>Write atomic and autonomous tests</li>
<li>Group like tests together in small batches</li>
<li>Be descriptive</li>
<li>Use a Test Runner</li>
<li>Store tests in a Version Control System</li>
</ul>
<h3>Atomic &amp; Autonomous Tests</h3>

<p>Each test needs to be concise (e.g., testing a single feature rather than multiple features) and be capable of being run independently (e.g., sets up its own data rather than relying on a previous test to do it). Doing this may require a mental shift, discipline, and more up front effort. But <strong>it will make a dramatic impact on the quality, effectiveness, and maintainability of your tests</strong>.</p>
<h3>Grouping Tests</h3>

<p>As your test suite grows, you should have multiple test files, each containing a small grouping of tests broken out by functionality that they're exercising. This will go a long way towards organization and maintenance as your test suite grows -- as well as faster execution times (depending on your approach to parallelization).</p>
<h3>Being Descriptive</h3>

<p>Each test file should be named appropriately, and each test within it should have an informative name (even if it may be a bit verbose). Also, each test (or grouping of tests) should be tagged with some helpful information to provide context and enable more flexible test execution (more on Tagging in Chapter 16).</p>

<p>This way all or parts of your test suite can be run, and the results will be informative thanks to helpful naming.</p>

<p>This approach is useful for both humans and robots alike. It enables developers to run a subset of tests to exercise functionality they just modified (as part of their pre-check-in testing) while also enabling you to intelligently wire your suite up to a Continuous Integration server (more on them in Chapter 16) for fast and dynamic feedback.</p>
<h3>Test Runners</h3>

<p>At the heart of every test suite is some kind of a test runner that does a lot of the heavy lifting (e.g., test group execution, easy global configuration for setup and teardown, reporting, etc.). Rather than reinvent the wheel, you can use one of the many that already exists (there's more than one for every language). And with it you can bolt on third party libraries to extend its functionality if there's something missing -- like parallelization.</p>

<p>The examples in this book use <a href="http://rspec.info/">RSpec</a> as the test runner.</p>
<h3>Version Control</h3>

<p>In order to effectively collaborate with other testers and developers, your test code must live in a version control system of some sort. Look to see what your development team uses and add your code to it. Otherwise, set up one of the following:</p>

<ul>
<li><a href="http://git-scm.com/">Git</a></li>
<li><a href="http://mercurial.selenic.com/">Mercurial</a></li>
<li><a href="http://subversion.apache.org/">Subversion</a></li>
</ul>

<p>Keep in mind that your test code can live in a <strong>separate</strong> repository from the code of the application you're testing. Combining them may be advantageous, but if all you're doing is writing and running tests against web endpoints (which is a majority of what your testing will be with Selenium) then leaving your test code in a separate repository is a fine way to go.</p>
<h1 id="chapter6"><small>Chapter 6</small><br>Writing Your First Test</h1>

<p>Fundamentally, Selenium works with two pieces of information -- the element on a page you want to use and what you want to do with it. This one-two punch will be repeated over and over until you achieve the outcome you want in your application -- at which point you will perform an assertion to confirm that the result is what you intended.</p>

<p>Let's take logging in to a website as an example. With Selenium you would:</p>

<ol>
<li>Visit the main page of a site</li>
<li>Find the login button and click it</li>
<li>Find the login form's username field and input text</li>
<li>Find the login form's password field and input text</li>
<li>Find the login form submit button and click it</li>
</ol>

<p>Selenium is able to find and interact with elements on a page by way of various locator strategies. The list includes Class, CSS, ID, Link Text, Name, Partial Link Text, Tag Name, and XPath.</p>

<p>While each serves a purpose, you only need to know a few to start writing effective tests.</p>
<h2>How To Find Locators</h2>

<p>The simplest way to find locators is to inspect the elements on a page. The best way to do this is from within your web browser. Fortunately, popular browsers come pre-loaded with development tools that make this simple to accomplish.</p>

<p>When viewing the page, <strong>right-click</strong> on the element you want to interact with and <strong>click Inspect Element</strong>. This will bring up a small window with all of the HTML for the page but zoomed into your highlighted selection. From here you can see if there are unique or descriptive attributes you can work with.</p>
<h2>How To Find Quality Elements</h2>

<p>Your focus with picking an effective element should be on finding something that is <strong>unique</strong>, <strong>descriptive</strong>, and <strong>unlikely to change</strong>. Ripe candidates for this are <code>id</code> and <code>class</code> attributes. Whereas copy (e.g., text, or the text of a link) is less ideal since it is more apt to change. This may not hold true for when you make assertions, but it's a good goal to strive for.</p>

<p>If the elements you are attempting to work with don't have unique <code>id</code> or <code>class</code> attributes directly on them, look at the element that houses them (a.k.a. the parent element). Oftentimes the parent element has a unique locator that you can use to start with and drill down into the element you want to use.</p>

<p>And if you can't find any unique elements, have a conversation with your development team letting them know what you are trying to accomplish. It's not hard for them to add helpful, semantic markup to make test automation easier, especially when they know the use case you are trying to automate. The alternative can be a lengthy, painful process which will probably yield working test code -- but it will be brittle and hard to maintain.</p>
<h2>An Example</h2>
<h3>Part 1: Find The Elements And Write The Test</h3>

<p>Here's the markup for a standard login form (pulled from <a href="http://the-internet.herokuapp.com/login">the login example on the-internet</a>).</p>
<div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">&quot;login&quot;</span> <span class="na">id=</span><span class="s">&quot;login&quot;</span> <span class="na">action=</span><span class="s">&quot;/authenticate&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;large-6 small-12 columns&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;large-6 small-12 columns&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;radius&quot;</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">&quot;icon-2x icon-signin&quot;</span><span class="nt">&gt;</span> Login<span class="nt">&lt;/i&gt;&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
<p>Note the unique elements on the form. The username input field has a unique <code>id</code>, as does the password input field. The submit button doesn't, but the parent element (<code>form</code>) does. So instead of clicking the submit button, we will have to submit the form instead.</p>

<p>Let's put these elements to use in our first test (or 'spec' as it's called in RSpec).</p>

<p><strong>NOTE: Elements written in a test are called 'locators' and will be referenced as such.</strong></p>
<div class="highlight"><pre><span class="c1"># filename: login_spec.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="n">describe</span> <span class="s1">'Login'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'succeeded'</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/login'</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'tomsmith'</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'SuperSecretPassword!'</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>There are some new keywords in this code example that may not look familiar. Things like <code>describe</code>, <code>before(:each)</code>, <code>after(:each)</code>, and <code>it</code>. They are part of RSpec's syntax. Let's step through this piece by piece. After that, it should all make sense.</p>

<p>At the top of the file we are pulling in <code>selenium-webdriver</code> which is the official open-source library for Selenium. It gives us the bindings necessary to drive the browser.</p>

<p>Next is the <code>describe</code>, which is the title of this test suite. A simple and helpful name is chosen to note the suite's intent (e.g., 'Login'). And a closing <code>end</code> is required, which is placed at the end of the file.</p>

<p>In order to use Selenium, we need to create an instance of it. This is done with the command <code>Selenium::WebDriver.for :firefox</code>, which is made available to us through the <code>selenium-webdriver</code> library. And when we're done, we don't want the browser we opened to hang around, so we close it. This is what we're doing in the <code>before(:each)</code> and <code>after(:each)</code> blocks. Note that we are storing our instance of Selenium in an instance variable (<code>@driver</code>) so we can access it throughout our entire test suite.</p>

<p>Last up is the <code>it</code> block, which is the test. Similar to the <code>describe</code> block, we can give it a simple and helpful name (e.g., 'succeeded').</p>

<p>In the test we are using the locators we identified from the markup by finding them with <code>@driver.find_element</code>, passing in the locator type as a key (e.g., <code>id:</code>) and the locator value (e.g., <code>username</code>, <code>password</code>, and <code>login</code>). Once found, we take an action against each of them, which in this case is inputting text (with <code>.send_keys</code>) and submitting the form (with <code>.submit</code>).</p>

<p>If we run this (e.g., <code>rspec login_spec.rb</code> from the command-line), it will run and pass. But there's one thing missing -- an assertion. In order to find an element to make an assertion against, we need to see what the markup is after submitting the login form.</p>
<h3>Part 2: Figure Out What To Assert</h3>

<p>Here is the markup that renders on the page after submitting the login form.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;flash-messages&quot;</span> <span class="na">class=</span><span class="s">&quot;large-12 columns&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">data-alert=</span><span class="s">&quot;&quot;</span> <span class="na">id=</span><span class="s">&quot;flash&quot;</span> <span class="na">class=</span><span class="s">&quot;flash success&quot;</span><span class="nt">&gt;</span>
      You logged into a secure area!
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">class=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>x<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;content&quot;</span> <span class="na">class=</span><span class="s">&quot;large-12 columns&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;&lt;i</span> <span class="na">class=</span><span class="s">&quot;icon-lock&quot;</span><span class="nt">&gt;&lt;/i&gt;</span> Secure Area<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">&quot;subheader&quot;</span><span class="nt">&gt;</span>Welcome to the Secure Area. When you are done click logout below.<span class="nt">&lt;/h4&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;button secondary radius&quot;</span> <span class="na">href=</span><span class="s">&quot;/logout&quot;</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">&quot;icon-2x icon-signout&quot;</span><span class="nt">&gt;</span> Logout<span class="nt">&lt;/i&gt;&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
<p>After logging in, there looks to be a couple of things we can use for our assertion. There's the flash message class (most appealing), the logout button (appealing), or the copy from the h2 or the flash message (least appealing).</p>

<p>Since the flash message class name is descriptive, denotes success, and is less likely to change than the copy, let's go with that.</p>

<p>But whenever we try to access an element with multiple locators like this we will need to combine them together into a single locator string that is written in either CSS or XPath. Either approach works well, but the examples throughout this book will focus on how to use CSS.</p>
<h2>A Quick Primer on CSS Selectors</h2>

<p>In web design, CSS (Cascading Style Sheets) are used to apply styles to the markup (HTML) on a page. CSS is able to do this by declaring which bits of the markup it wants to interact with through the use of selectors. Selenium operates in a similar manner but instead of changing the style of elements, it interacts with them by clicking, getting values, typing, sending keys, etc.</p>

<p>CSS selectors are a pretty straightforward and handy way to write locators, especially for hard to reach elements.</p>

<p>For right now, here's what you need to know. In CSS, class names start with a dot (<code>.</code>). For classes with multiple words, put a dot in front of <strong>each</strong> word, and remove the spaces (e.g., <code>.flash.success</code> for <code>class='flash success'</code>).</p>

<p>For a good resource on CSS Selectors, I encourage you to check out <a href="http://saucelabs.com/resources/selenium/css-selectors">Sauce Labs' write up on them</a>.</p>
<h3>Part 3: Write The Assertion And Verify It</h3>
<div class="highlight"><pre><span class="c1"># filename: login_spec.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="n">describe</span> <span class="s1">'Login'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'succeeded'</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/login'</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'username'</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'password'</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'.flash.success'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>Now our test has an assertion! But there's a lot going on in that one line, let's step through it to make sure we understand what it's doing.</p>

<p>First, we are finding the element we want to make an assertion against (using the locator type <code>css</code> and the locator string <code>.flash.success</code>). After that, we are asking Selenium if this element is displayed on the page (with <code>.displayed?</code>). This returns a boolean response that we can make an assertion against. To make the assertion we leverage an RSpec assertion method (<code>.should</code>) and an RSpec matcher (<code>be_true</code>).</p>
<h3>Just To Make Sure</h3>

<p>Now when we run this test (<code>rspec login_spec.rb</code> from the command-line) it will pass just like before, but now there is an assertion which should catch a failure if something is amiss.</p>

<p>Just to make certain that this test is doing what we think it should, let's change the assertion to <strong>force a failure</strong> and run it again. A simple fudging of the locator will suffice.</p>
<div class="highlight"><pre><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'.flash.successasdf'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
</pre></div>
<p>If it fails, then we can feel confident that it's doing what we expect, and can change the assertion back to normal before committing our code. This trick will save you more trouble that you know. Practice it often.</p>
<h1 id="chapter7"><small>Chapter 7</small><br>Verifying Your Locators</h1>

<p>If you're fortunate enough to be working with unique IDs and Classes, then you're usually all set. But when you have to handle more complex actions like traversing a page -- or you need to run down odd test behavior -- it can be a real challenge to verify that you have the right locators to accomplish what you want.</p>

<p>Instead of the painful and tedious process of trying out various locators in your tests until you get what you're looking for, give Firefinder a try.</p>

<p><a href="https://addons.mozilla.org/en-US/firefox/addon/firefinder-for-firebug/">Firefinder</a> is an add-on to the popular web-development Firefox tool <a href="https://addons.mozilla.org/en-US/firefox/addon/firebug/">Firebug</a>.</p>

<p>You first need to install Firebug, then Firefinder. Once you have that, verifying locators is a trivial task. And it works for both CSS and XPath locators.</p>

<p><strong>NOTE: An alternative to FireFinder is <a href="https://addons.mozilla.org/en-US/firefox/addon/firepath/">FirePath</a>. If you have problems with FireFinder, or if you just want to see which one works better for you, then give it a try as well.</strong></p>
<h2>An Example</h2>

<p>Let's try to identify the locators necessary to traverse a few levels into a large set of nested divs.</p>
<div class="highlight"><pre># a snippet from http://the-internet.herokuapp.com/large

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'siblings'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-1.1'</span><span class="nt">&gt;</span>1.1
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-1.2'</span><span class="nt">&gt;</span>1.2<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-1.3'</span><span class="nt">&gt;</span>1.3<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-2.1'</span><span class="nt">&gt;</span>2.1
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-2.2'</span><span class="nt">&gt;</span>2.2<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-2.2'</span><span class="nt">&gt;</span>2.3<span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.1'</span><span class="nt">&gt;</span>3.1
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.2'</span><span class="nt">&gt;</span>3.2<span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.2'</span><span class="nt">&gt;</span>3.3<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.1'</span><span class="nt">&gt;</span>4.1
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.2'</span><span class="nt">&gt;</span>4.2<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.2'</span><span class="nt">&gt;</span>4.3<span class="nt">&lt;/div&gt;</span>
        ...
</pre></div>
<p>If we were to perform a <code>find_element</code> action using the following locator, it will work.</p>
<div class="highlight"><pre><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s2">&quot;div#siblings &gt; div:nth-of-type(1) &gt; div:nth-of-type(1)&quot;</span><span class="p">)</span>
</pre></div>
<p>But if we try to go one level deeper, it won't work.</p>
<div class="highlight"><pre><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s2">&quot;div#siblings &gt; div:nth-of-type(1) &gt; div:nth-of-type(1) &gt; div:nth-of-type(1)&quot;</span><span class="p">)</span>
</pre></div>
<p>Fortunately with Firefinder we can actually see what our locators are doing. Here's what it shows us for the locators that &quot;worked&quot;.</p>

<p><img src="http://elementalselenium.com/img/firefinder/wrong-match-css.png" alt="wrong-match-css"></p>

<p>It looks like our locators are scoping to the wrong part of the first level (1.2). We need to reference the third part of each level (e.g., 1.3, 2.3, 3.3) in order to traverse deeper since the nested divs live under the third part of each level.</p>

<p>So if we try this locator instead, it should work.</p>
<div class="highlight"><pre><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s2">&quot;div#siblings &gt; div:nth-of-type(1) &gt; div:nth-of-type(3) &gt; div:nth-of-type(3)&quot;</span><span class="p">)</span>
</pre></div>
<p>And we can confirm this before changing any test code by looking in Firefinder.</p>

<p><img src="http://elementalselenium.com/img/firefinder/right-match-css.png" alt="right-match-css"></p>

<p>This should help save you time and frustration when running down tricky locators in your tests. It definitely has for me.</p>
<h1 id="chapter8"><small>Chapter 8</small><br>Writing Re-usable Test Code</h1>

<p>One of the biggest challenges with Selenium tests is that they can be brittle and challenging to maintain over time. This is largely due to the fact that things in the app you're testing change, breaking your tests.</p>

<p>But the reality of a software project is that change is a constant. So we need to account for this reality somehow in our test code in order to be successful.</p>

<p>Enter Page Objects.</p>

<p>Rather than write your test code directly against your app, you can model the behavior of your application into simple objects -- and write your tests against them instead. That way when your app changes and your tests break, you only have to update your test code in one place to fix it.</p>

<p>And with this approach, we not only get the benefit of controlled chaos, we also get the benefit of reusable functionality across our tests.</p>
<h2>An Example</h2>
<h3>Part 1: Create A Page Object And Update Test</h3>

<p>Let's take our login example from the previous chapter and pull it out into a page object and update our test accordingly.</p>
<div class="highlight"><pre><span class="c1"># filename: login.rb</span>

<span class="k">class</span> <span class="nc">Login</span>

  <span class="no">LOGIN_FORM</span>  <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span> <span class="p">}</span>
    <span class="no">USERNAME_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span> <span class="p">}</span>
    <span class="no">PASSWORD_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span> <span class="p">}</span>
  <span class="no">SUCCESS_MESSAGE</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">css</span><span class="p">:</span> <span class="s1">'.flash.success'</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="n">driver</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">+</span> <span class="s1">'/login'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">with</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">USERNAME_INPUT</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">PASSWORD_INPUT</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">LOGIN_FORM</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">success_message_present?</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">SUCCESS_MESSAGE</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>We start by creating our own class, naming it accordingly (<code>Login</code>), and storing our locators in hashes within constants along the top.</p>

<p>We then use an <code>initialize</code> method. This is a built in method for classes in Ruby that enable you to automatically execute code upon instantiating the class. With it we are taking an argument to receive the Selenium driver object -- and storing it in an instance variable. This will enable the class to drive the browser. We're also visiting the page with the help of an environment variable (instead of a hard-coded value).</p>

<p>In our <code>with</code> method we are capturing the core functionality of the login page by accepting the username and password input values as well as housing the input and submit actions.</p>

<p>Since our behavior now lives in a page object, we want a clean way to make an assertion in our test. This is where <code>success_message_present?</code> comes in. Notice that it ends with a question mark. Methods that end like this are known as mutator methods. And when they end with a question mark, they imply that they will return a boolean. So in it we want to ask a question of the page so that we can return a boolean. And in our test we will put this boolean to work by making an assertion against it.</p>

<p>Now let's update our test to use this page object.</p>
<div class="highlight"><pre><span class="c1"># filename: login_spec.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="n">require_relative</span> <span class="s1">'login'</span>

<span class="n">describe</span> <span class="s1">'Login'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
    <span class="vi">@login</span> <span class="o">=</span> <span class="no">Login</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'succeeded'</span> <span class="k">do</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s1">'tomsmith'</span><span class="p">,</span> <span class="s1">'SuperSecretPassword!'</span><span class="p">)</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">success_message_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>At the top of the file we include the page object by using <code>require_relative</code>. This enables us to reference another file based on the current file's path. We then create an environment variable for the base_url (<code>ENV['base_url']</code>). Since we only have one test file, it will live here and be hard-coded for now. But don't worry, we'll address this later.</p>

<p>Next we instantiate our login page object in <code>before(:each)</code>, passing in <code>@driver</code> as an argument, and storing it all in an instance variable (<code>@login</code>). We then wire up our test to use the actions available in <code>@login</code>.</p>

<p>We finish things up by making an assertion against our helper method (<code>.success_message_present?.should be_true</code>).</p>
<h3>Part 2: Write Another Test</h3>

<p>This may feel like more work than what we had when we first started. But we're in a much sturdier position and able to write follow-on tests more easily. Let's add another test to demonstrate a failed login.</p>

<p>If we provide incorrect credentials, the following markup gets rendered on the page.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;flash-messages&quot;</span> <span class="na">class=</span><span class="s">&quot;large-12 columns&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">data-alert=</span><span class="s">&quot;&quot;</span> <span class="na">id=</span><span class="s">&quot;flash&quot;</span> <span class="na">class=</span><span class="s">&quot;flash error&quot;</span><span class="nt">&gt;</span>
    Your username is invalid!
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">class=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>x<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
<p>This is similar to the markup from our successful flash message, so let's mimic the behavior we used in our page object to create another mutator method to help in our assertion.</p>

<p>First we'll add a new locator for the failure message in our list of constants at the top of our class (just below our success message locator).</p>
<div class="highlight"><pre><span class="c1"># filename: login.rb</span>

<span class="k">class</span> <span class="nc">Login</span>

  <span class="no">LOGIN_FORM</span>  <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span> <span class="p">}</span>
    <span class="no">USERNAME_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span> <span class="p">}</span>
    <span class="no">PASSWORD_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span> <span class="p">}</span>
  <span class="no">SUCCESS_MESSAGE</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">css</span><span class="p">:</span> <span class="s1">'.flash.success'</span> <span class="p">}</span>
  <span class="no">FAILURE_MESSAGE</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">css</span><span class="p">:</span> <span class="s1">'.flash.error'</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>Further down the file (next to the existing mutator method) we'll add a new method to check for the existence of this message and return a boolean response.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">success_message_present?</span>
  <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">SUCCESS_MESSAGE</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">failure_message_present?</span>
  <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">FAILURE_MESSAGE</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
<span class="k">end</span>
</pre></div>
<p>Lastly, we add a new test in our spec file just below our existing one, specifying invalid credentials to force a failure.</p>
<div class="highlight"><pre><span class="n">it</span> <span class="s1">'succeeded'</span> <span class="k">do</span>
  <span class="vi">@login</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s1">'tomsmith'</span><span class="p">,</span> <span class="s1">'SuperSecretPassword!'</span><span class="p">)</span>
  <span class="vi">@login</span><span class="o">.</span><span class="n">success_message_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
<span class="k">end</span>

<span class="n">it</span> <span class="s1">'failed'</span> <span class="k">do</span>
  <span class="vi">@login</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s1">'asdf'</span><span class="p">,</span> <span class="s1">'asdf'</span><span class="p">)</span>
  <span class="vi">@login</span><span class="o">.</span><span class="n">failure_message_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
<span class="k">end</span>
</pre></div>
<p>Now if we run our spec file (<code>rspec login_spec.rb</code>) we will see two browser windows open (one after the other) testing both the successful and failure login conditions.</p>
<h2>Why Asserting False Won't Work (yet)</h2>

<p>You may be wondering why we didn't check to see if the success message wasn't present.</p>
<div class="highlight"><pre><span class="n">it</span> <span class="s1">'failed'</span> <span class="k">do</span>
  <span class="vi">@login</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s1">'asdf'</span><span class="p">,</span> <span class="s1">'asdf'</span><span class="p">)</span>
  <span class="vi">@login</span><span class="o">.</span><span class="n">success_message_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_false</span>
<span class="k">end</span>
</pre></div>
<p>There are two problems with this approach. First, our test will fail. This is because it errors out when looking for an element that's not present -- which looks like this:</p>
<div class="highlight"><pre>.F

Failures:

  1<span class="o">)</span> Login failed
     Failure/Error: @login.success_message_present?.should be_false
     Selenium::WebDriver::Error::NoSuchElementError:
       Unable to locate element: <span class="o">{</span><span class="s2">&quot;method&quot;</span>:<span class="s2">&quot;css selector&quot;</span>,<span class="s2">&quot;selector&quot;</span>:<span class="s2">&quot;.flash.success&quot;</span><span class="o">}</span>
     <span class="c"># [remote server] file:///tmp/webdriver-profile20140125-21003-3brprw/extensions/fxdriver@googlecode.com/components/driver_component.js:8860:in `FirefoxDriver.prototype.findElementInternal_'</span>
     <span class="c"># [remote server] file:///tmp/webdriver-profile20140125-21003-3brprw/extensions/fxdriver@googlecode.com/components/driver_component.js:8869:in `FirefoxDriver.prototype.findElement'</span>
     <span class="c"># [remote server] file:///tmp/webdriver-profile20140125-21003-3brprw/extensions/fxdriver@googlecode.com/components/command_processor.js:10831:in `DelayedCommand.prototype.executeInternal_/h'</span>
     <span class="c"># [remote server] file:///tmp/webdriver-profile20140125-21003-3brprw/extensions/fxdriver@googlecode.com/components/command_processor.js:10836:in `DelayedCommand.prototype.executeInternal_'</span>
     <span class="c"># [remote server] file:///tmp/webdriver-profile20140125-21003-3brprw/extensions/fxdriver@googlecode.com/components/command_processor.js:10778:in `DelayedCommand.prototype.execute/&lt;'</span>
     <span class="c"># ./code_examples/07/02/login.rb:21:in `success_message_present?'</span>
     <span class="c"># ./code_examples/07/02/login_spec.rb:23:in `block (2 levels) in &lt;top (required)&gt;'</span>

Finished in 12.08 seconds
<span class="m">2</span> examples, <span class="m">1</span> failure
</pre></div>
<p>But don't worry, we'll address this limitation in the next chapter.</p>

<p>Second, the absence of success message does not necessarily indicate a failed login. The assertion we ended up with is more concise.</p>
<h2>Part 3: Confirm We're In The Right Place</h2>

<p>Before we can call our page object finished, there's one more addition we'll want to make. We'll want to add an assertion to make sure that Selenium is in the right place before proceeding. This will add some initial resiliency to our test.</p>

<p>As a rule, you want to keep assertions in your tests and out of your page objects. But this is the exception to the rule.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Login</span>

  <span class="no">LOGIN_FORM</span>  <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span> <span class="p">}</span>
    <span class="no">USERNAME_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span> <span class="p">}</span>
    <span class="no">PASSWORD_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span> <span class="p">}</span>
  <span class="no">SUCCESS_MESSAGE</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">css</span><span class="p">:</span> <span class="s1">'.flash.success'</span> <span class="p">}</span>
  <span class="no">FAILURE_MESSAGE</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">css</span><span class="p">:</span> <span class="s1">'.flash.error'</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="n">driver</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">+</span> <span class="s1">'/login'</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">LOGIN_FORM</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
  <span class="k">end</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>We simply add a new line to the end of our <code>initialize</code> method. In it we are checking to see if the login form is displayed, and making an assertion against the boolean response returned from Selenium.</p>

<p>The only unfortunate part of doing an assertion in the page object is that we don't have access to RSpec's matchers (e.g., <code>be_true</code>). Instead we use a Ruby comparison operator to see if the boolean equals true (<code>== true</code>).</p>

<p>Now if we run our tests again, they should pass just like before. But now we can rest assured that the test will only proceed if the login form is present.</p>
<h1 id="chapter9"><small>Chapter 9</small><br>Writing Really Re-usable Test Code</h1>

<p>In the previous chapter we stepped through creating a simple page object to capture the behavior of the page we were interacting with. While this was a good start, it leaves a lot of room for improvement.</p>

<p>As our test suite grows and we add more page objects, we will start to see common behavior that we will want to use over and over again. If we leave this unchecked we will end up with duplicative code which will slowly make our test suite harder to maintain. And right now we are using Selenium actions directly in our page object. While on the face of it this may seem fine, it has some long term impacts, like:</p>

<ul>
<li>the inability to drive your tests with a different driver (e.g., mobile)</li>
<li>test maintenance issues when Selenium actions change (e.g., major upgrades ala RC to WebDriver)</li>
<li>slower test writing due to the lack of a simple Domain Specific Language (DSL)</li>
</ul>

<p>With a Base Page Object (a.k.a. a facade layer) we can easily side step these concerns by abstracting all of our common actions into a central location and leverage them in our page objects.</p>

<p>Let's step through an example with our login page object.</p>
<h2>An Example</h2>
<h3>Part 1: Create The Base Page Object</h3>

<p>First we will need to create the base page object.</p>
<div class="highlight"><pre><span class="c1"># filename: base_page.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="k">class</span> <span class="nc">BasePage</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="n">driver</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="n">url_path</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">+</span> <span class="n">url_path</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span> <span class="n">locator</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">locator</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">text</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">submit</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">is_displayed?</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>We first <code>require</code> our Selenium library (<code>selenium-webdriver</code>). By placing it in this file, we will no longer need to include it anywhere else in our test suite (assuming all of our tests leverage page objects). And it makes sense to have it live here since this is the only file where we will be referencing Selenium commands directly.</p>

<p>Next we declare our class and name it appropriately with camel-casing (<code>BasePage</code>).</p>

<p>In our <code>initialize</code> method we are accepting a driver object as an argument and setting it as an instance variable to make it available throughout this class. We then add common methods that we will reference in our page objects -- <code>visit</code>, <code>find</code>, <code>type</code>, <code>submit</code>, and <code>is_displayed?</code>.</p>

<p>Now let's update our login page object to leverage this.</p>
<div class="highlight"><pre><span class="c1"># filename: login.rb</span>

<span class="n">require_relative</span> <span class="s1">'base_page'</span>

<span class="k">class</span> <span class="nc">Login</span> <span class="o">&lt;</span> <span class="no">BasePage</span>

  <span class="no">LOGIN_FORM</span>  <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span> <span class="p">}</span>
    <span class="no">USERNAME_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span> <span class="p">}</span>
    <span class="no">PASSWORD_INPUT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span> <span class="p">}</span>
  <span class="no">SUCCESS_MESSAGE</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">css</span><span class="p">:</span> <span class="s1">'.flash.success'</span> <span class="p">}</span>
  <span class="no">FAILURE_MESSAGE</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">css</span><span class="p">:</span> <span class="s1">'.flash.error'</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="k">super</span>
    <span class="n">visit</span> <span class="s1">'/login'</span>
    <span class="n">is_displayed?</span><span class="p">(</span><span class="no">LOGIN_FORM</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">with</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="n">type</span> <span class="n">username</span><span class="p">,</span> <span class="no">USERNAME_INPUT</span>
    <span class="n">type</span> <span class="n">password</span><span class="p">,</span> <span class="no">PASSWORD_INPUT</span>
    <span class="n">submit</span> <span class="no">LOGIN_FORM</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">success_message_present?</span>
    <span class="n">is_displayed?</span> <span class="no">SUCCESS_MESSAGE</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">failure_message_present?</span>
    <span class="n">is_displayed?</span> <span class="no">FAILURE_MESSAGE</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>In order to use the base page object we need to do two things. First we need to include the file, which is handled using the <code>require_relative</code> at the top of the file. And second, we need to connect them using inheritance (which is handled in the class declaration with the <code>&lt;</code> operator). This is effectively saying <code>Login</code> is a child of <code>BasePage</code>. Or, <code>BasePage</code> is the parent of <code>Login</code>. This enables us to freely reference the methods we created in the base page object.</p>

<p>As a result of this refactoring, our <code>initialize</code> method changes a bit. Rather than setting the driver object as an instance variable, we are calling <code>super</code>. This is a built-in keyword in Ruby for class inheritance. It triggers a method of the same name to be run from the parent class. So in this case, <code>initialize</code> from <code>BasePage</code> gets run, which is responsible for handling the driver object retrieval and instance variable creation. And since the <code>BasePage</code> is now the only place where we reference Selenium actions directly, it stands that it should be the only place where we need to reference a <code>@driver</code> object. After that, we load the page and perform an assertion. And since our base URL is being leveraged in the base page object, we don't have to reference it here in our page object.</p>

<p>To finish things off, we replace all of the remaining driver incantations with calls to the methods we created in the base page object. Our tests remain unchanged, but our page objects are more flexible and readable.</p>

<p>Running our tests (<code>rspec login_spec.rb</code> from the command-line) should still yield a passing result.</p>
<h3>Part 2: Add Some Error Handling</h3>

<p>Remember in the previous chapter when we ran into an error with Selenium when we looked for an element that wasn't on the page? Let's address that now.</p>

<p>To recap -- here's the error message we saw:</p>
<div class="highlight"><pre>.F

Failures:

  1<span class="o">)</span> Login failed
     Failure/Error: @login.success_message_present?.should be_false
     Selenium::WebDriver::Error::NoSuchElementError:
       Unable to locate element: <span class="o">{</span><span class="s2">&quot;method&quot;</span>:<span class="s2">&quot;css selector&quot;</span>,<span class="s2">&quot;selector&quot;</span>:<span class="s2">&quot;.flash.success&quot;</span><span class="o">}</span>
     <span class="c"># [remote server] file:///tmp/webdriver-profile20140125-21003-3brprw/extensions/fxdriver@googlecode.com/components/driver_component.js:8860:in `FirefoxDriver.prototype.findElementInternal_'</span>
     <span class="c"># [remote server] file:///tmp/webdriver-profile20140125-21003-3brprw/extensions/fxdriver@googlecode.com/components/driver_component.js:8869:in `FirefoxDriver.prototype.findElement'</span>
     <span class="c"># [remote server] file:///tmp/webdriver-profile20140125-21003-3brprw/extensions/fxdriver@googlecode.com/components/command_processor.js:10831:in `DelayedCommand.prototype.executeInternal_/h'</span>
     <span class="c"># [remote server] file:///tmp/webdriver-profile20140125-21003-3brprw/extensions/fxdriver@googlecode.com/components/command_processor.js:10836:in `DelayedCommand.prototype.executeInternal_'</span>
     <span class="c"># [remote server] file:///tmp/webdriver-profile20140125-21003-3brprw/extensions/fxdriver@googlecode.com/components/command_processor.js:10778:in `DelayedCommand.prototype.execute/&lt;'</span>
     <span class="c"># ./code_examples/07/02/login.rb:21:in `success_message_present?'</span>
     <span class="c"># ./code_examples/07/02/login_spec.rb:23:in `block (2 levels) in &lt;top (required)&gt;'</span>

Finished in 12.08 seconds
<span class="m">2</span> examples, <span class="m">1</span> failure
</pre></div>
<p>The important thing to note is the specific error message Selenium offered up -- the part that comes just before the line that says 'Unable to locate element'. We're interested in <code>Selenium::WebDriver::Error::NoSuchElementError</code>. With it we can make our code return a <code>false</code> boolean instead of failing.</p>

<p>Now that we have it, let's update the <code>is_displayed?</code> method in our base page object to use it.</p>
<div class="highlight"><pre><span class="c1"># filename: base_page.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="k">class</span> <span class="nc">BasePage</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>

<span class="k">def</span> <span class="nf">is_displayed?</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
  <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">NoSuchElementError</span>
    <span class="kp">false</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>In Ruby, we can make our code more resilient by wrapping an action in a <code>begin</code>/<code>rescue</code> block. In this case, we're wrapping our check to see if an element is displayed. If the element is not on the page, Selenium will raise an error. When that happens, our code will now rescue for that specific error condition, and return false instead of failing the test.</p>

<p>Now if we wanted to see if an element was not on the page, we can, without fear of our test blowing up.</p>

<p>Just to verify, let's revisit our failed login test and update it to assert that the success message isn't present.</p>
<div class="highlight"><pre><span class="c1"># filename: login_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'login'</span>

<span class="n">describe</span> <span class="s1">'Login'</span> <span class="k">do</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="n">it</span> <span class="s1">'failed'</span> <span class="k">do</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s1">'asdf'</span><span class="p">,</span> <span class="s1">'asdf'</span><span class="p">)</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">success_message_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_false</span>
    <span class="c1">#@login.failure_message_present?.should be_true</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>Now when we run this (<code>rspec login_spec.rb</code> from the command-line) it will run without error, and pass. Feel free to change the assertion back when you're done.</p>
<h1 id="chapter10"><small>Chapter 10</small><br>Writing Resilient Test Code</h1>

<p>Ideally, you should be able to write your tests once and run them across all supported browsers. While this is a rosy proposition, there is some work to make this a reliable success. And sometimes there may be a hack or two involved. But the lengths you must go really depends on the browsers you care about and the functionality you're dealing with.</p>

<p>By using high quality locators we are already well ahead of the pack, but there are still some persnickety issues to deal with. Most notably -- timing. This is especially true when working with dynamic, JavaScript heavy pages (which is more the rule than the exception in a majority of applications you'll deal with).</p>

<p>But there is a simple approach that makes up the bedrock of reliable and resilient Selenium tests -- and that's how you wait and interact with elements. Gone are the days of waiting for the page to finish loading before proceeding, or hard-coding sleeps, or doing blanket wait times (a.k.a. implicit waits). Nay. Now are the wonder years of waiting for a specific element to appear for a specific amount of time, and taking an action against it.</p>

<p>We accomplish this through the use of <strong>explicit waits</strong>.</p>
<h2>An Example</h2>
<h3>Part 1: Create A New Page Object And Update The Base Page Object</h3>

<p>Let's step through an example that demonstrates this against <a href="http://the-internet.herokuapp.com/dynamic_loading/1">a dynamic page on the-internet</a>. The functionality is pretty simple -- there is a button. When you click it a loading bar appears for 5 seconds, then disappears, and gets replaced with the text 'Hello World!'.</p>

<p>Let's start by looking at the markup on the page.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h3&gt;</span>Dynamically Loaded Page Elements<span class="nt">&lt;/h3&gt;</span>
  <span class="nt">&lt;h4&gt;</span>Example 1: Element on page that is hidden<span class="nt">&lt;/h4&gt;</span>

  <span class="nt">&lt;br&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;start&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button&gt;</span>Start<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;finish&quot;</span> <span class="na">style=</span><span class="s">&quot;display:none&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h4&gt;</span>Hello World!<span class="nt">&lt;/h4&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/div&gt;</span>
</pre></div>
<p>At a glance it's simple enough to tell that there are unique <code>id</code> attributes that we can use to reference the start button and finish text.</p>

<p>Let's add a page object for Dynamic Loading.</p>
<div class="highlight"><pre><span class="c1"># filename: dynamic_loading.rb</span>

<span class="n">require_relative</span> <span class="s1">'base_page'</span>

<span class="k">class</span> <span class="nc">DynamicLoading</span> <span class="o">&lt;</span> <span class="no">BasePage</span>

  <span class="no">START_BUTTON</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">css</span><span class="p">:</span> <span class="s1">'#start button'</span> <span class="p">}</span>
  <span class="no">FINISH_TEXT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'finish'</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="k">super</span>
    <span class="n">visit</span> <span class="s1">'/dynamic_loading/1'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">start</span>
    <span class="n">click</span> <span class="no">START_BUTTON</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">finish_text_present?</span>
    <span class="n">wait_for</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span> <span class="n">is_displayed?</span> <span class="no">FINISH_TEXT</span> <span class="p">}</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>At the top of the file we require our base page object and set up inheritance when declaring our class so we get our common Selenium actions. After that we wire up our locators in constants, add a visit action to our <code>initialize</code> method, and drop in some methods to start the loading process and to see if the finish text is present.</p>

<p>In <code>start</code> and <code>finish_text_present?</code> we are using two methods which have not been added to our base page object. One to click an element, and another to wait for an action to complete. So let's hop into our base page object and add them to the bottom of the class.</p>
<div class="highlight"><pre><span class="c1"># filename: base_page.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="k">class</span> <span class="nc">BasePage</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="k">def</span> <span class="nf">click</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">seconds</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
    <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">timeout</span><span class="p">:</span> <span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p><code>click</code> is simply finding an element on the page and clicking it. <code>wait_for</code> is where we are defining our explicit wait.</p>

<p>With <code>wait_for</code> we are accepting an integer for the number of seconds that we would like to wait. If nothing is provided, 15 seconds will be used. We then use this value to tell the explicit wait mechanism that Selenium offers how long to wait, and what to wait for. By using a <code>yield</code> we are able to easily pass in a code block to run (e.g., a Selenium command surrounded by brackets (<code>{}</code>)).</p>
<h2>More On Explicit Waits</h2>

<p>It's important to set a <em>reasonably sized</em> default timeout for the explicit wait. But you want to be careful not to make it too high. Otherwise you run into a lot of the same timing issues you get from implicit waits. But set it too low and your tests will be brittle, forcing you to run down trivial and transient issues.</p>

<p>In our page object when we're using <code>wait_for(10) { is_displayed? FINISH_TEXT }</code> we are telling Selenium to to see if the finish text is displayed on the page. It will keep trying until it either returns <code>true</code> or reaches ten seconds -- whichever comes first.</p>

<p>If the behavior on the page takes longer than we expect (e.g., due to slow load times, or a feature change), we can simply adjust this one wait time to fix the test -- rather than increase a blanket wait time (which impacts every test). And since it's dynamic, it won't always take the full amount of time to complete.</p>
<h3>Part 2: Write A Test To Use The New Page Object</h3>

<p>Now that we have our page object and requisite base page methods we can wire this up in a new test file.</p>
<div class="highlight"><pre><span class="c1"># filename: dynamic_loading_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'dynamic_loading'</span>

<span class="n">describe</span> <span class="s1">'Dynamic Loading'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
    <span class="vi">@dynamic_loading</span> <span class="o">=</span> <span class="no">DynamicLoading</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'Example 1: Hidden Element'</span> <span class="k">do</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">start</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">finish_text_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>When we run it (<code>rspec dynamic_loading_page.rb</code> from the command-line) it should pass.</p>
<h3>Part 3: Update Page Object And Add A New Test</h3>

<p>Let's step through one more dynamic page example to see if our explicit wait approach holds up.</p>

<p><a href="http://the-internet.herokuapp.com/dynamic_loading/2">This example</a> is laid out similarly to the last one, the main difference is that it will render the final result <strong>after</strong> the progress bar completes. Here's the markup for it.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h3&gt;</span>Dynamically Loaded Page Elements<span class="nt">&lt;/h3&gt;</span>
  <span class="nt">&lt;h4&gt;</span>Example 2: Element rendered after the fact<span class="nt">&lt;/h4&gt;</span>

  <span class="nt">&lt;br&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;start&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button&gt;</span>Start<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
<p>In order to find the selector for the finish text element we need to inspect the page after the loading bar sequence finishes. Here's what it looks like.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;finish&quot;</span> <span class="na">style=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;h4&gt;</span>Hello World!<span class="nt">&lt;/h4&gt;&lt;/div&gt;</span>
</pre></div>
<p>Before we add our test, we need to modify our page object to accommodate visiting the different example URLs.</p>
<div class="highlight"><pre><span class="c1"># filename: dynamic_loading.rb</span>

<span class="n">require_relative</span> <span class="s1">'base_page'</span>

<span class="k">class</span> <span class="nc">DynamicLoading</span> <span class="o">&lt;</span> <span class="no">BasePage</span>

  <span class="no">START_BUTTON</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">css</span><span class="p">:</span> <span class="s1">'#start button'</span> <span class="p">}</span>
  <span class="no">FINISH_TEXT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'finish'</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="n">example_number</span><span class="p">)</span>
    <span class="n">visit</span> <span class="s2">&quot;/dynamic_loading/</span><span class="si">#{</span><span class="n">example_number</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">start</span>
    <span class="n">click</span> <span class="no">START_BUTTON</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">finish_text_present?</span>
    <span class="n">wait_for</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span> <span class="n">is_displayed?</span> <span class="no">FINISH_TEXT</span> <span class="p">}</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>We're able to remove the <code>initialize</code> method entirely since we no longer need the <code>visit</code> action as part of loading the page object. That functionality now lives in the <code>example</code> method. Thanks to inheritance our parent class is still able to do what it needs, even without the use of an <code>initialize</code> in the child class.</p>

<p>Now that we have that sorted, let's add a new test to reference the markup shown above (and update our existing test to use the new <code>.example</code> method).</p>
<div class="highlight"><pre><span class="c1"># filename: dynamic_loading_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'dynamic_loading'</span>

<span class="n">describe</span> <span class="s1">'Dynamic Loading'</span> <span class="k">do</span>

  <span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="n">it</span> <span class="s1">'Example 1: Hidden Element'</span> <span class="k">do</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">example</span> <span class="mi">1</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">start</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">finish_text_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'Example 2: Rendered after the fact'</span> <span class="k">do</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">example</span> <span class="mi">2</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">start</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">finish_text_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>If we run these tests (<code>rspec dynamic_loading_spec.rb</code> from the command-line) then the same approach should work for both cases.</p>
<h2>Browser Timing</h2>

<p>Using explicit waits gets you pretty far. But there are a few things you'll want to think about when it comes to writing your tests to work against various browsers.</p>

<p>It's simple enough to write your tests locally against Firefox and assume you're all set. Once you start to run things against other browsers, you may be in for a rude awakening. The first thing you're likely to run into is the speed of execution. A lot of your tests will start to fail when you point them at either Chrome or Internet Explorer, and likely for different reasons.</p>

<p>In my experience, Chrome execution is very fast, so you will see some odd timeout failures. This is an indicator that you need to add explicit waits to parts of your page objects that don't already have them. And the inverse is true when running things against older version of Internet Explorer (e.g., IE 8). This is an indicator that your explicit wait times are not long enough since the browser is taking longer to respond -- so your tests timeout.</p>

<p>The best approach to solve this is an iterative one. Run your tests and find the failures. Take each failed test, adjust your code as needed, and run it against the browsers you care about. Repeat until you make a pass all the way through each of the failed tests. Then run a batch of all your tests to see where they fall down. Repeat until everything's green.</p>

<p>Once you're on the other side of these issues, the amount of effort you need to put into it should diminish dramatically.</p>
<h2>Closing Thoughts</h2>

<p>By explicitly waiting to complete an action, our tests are in a much more resilient position because Selenium will keep trying for a reasonable amount of time rather than trying just once. And each action can be tuned to meet the needs of each circumstance. Couple that with the dynamic nature of explicit waits, and you have something that will work in a multitude of circumstances -- helping you endure even the toughest of browsers.</p>

<p>This is one of the most important concepts in testing with Selenium. Use explicit waits often.</p>
<h1 id="chapter11"><small>Chapter 11</small><br>Prepping For Use</h1>

<p>Now that we have tests, page objects, and a base page object, let's package things into a more useful structure.</p>
<h2>Folder Organization</h2>

<p>It's about time we create some folders for our specs and page objects. To err on the side of simplicity, let's call the folders 'spec' (for our tests) and 'pages' (for our page objects). We are using 'spec' since it's a default folder that RSpec will use.</p>

<p>Here's everything we should have after creating folders and moving files around:</p>
<div class="highlight"><pre>.
<span class="p">|</span>-- Gemfile
<span class="p">|</span>-- pages
<span class="p">|</span>   <span class="p">|</span>-- base_page.rb
<span class="p">|</span>   <span class="p">|</span>-- dynamic_loading.rb
<span class="p">|</span>   <span class="sb">`</span>-- login.rb
<span class="sb">`</span>-- spec
    <span class="p">|</span>-- dynamic_loading_spec.rb
    <span class="p">|</span>-- login_spec.rb
</pre></div><h2>Updating Require Statements</h2>

<p>As a result of doing this, we will need to update the require statements in our tests.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/login_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'../pages/login'</span>

<span class="n">describe</span> <span class="s1">'Login'</span> <span class="k">do</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: spec/dynamic_loading_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'../pages/dynamic_loading'</span>

<span class="n">describe</span> <span class="s1">'Dynamic Loading'</span> <span class="k">do</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>Note the use of double-dots (<code>..</code>) in the page object require statement. This is how we tell Ruby to traverse up a directory (from our spec directory) before trying to access the page objects folder.</p>
<h2>Base URL</h2>

<p>We'll want to put our base URL someplace central. And we'll want it to be configurable. So let's create a 'config.rb' file in the parent directory and place it there.</p>
<div class="highlight"><pre><span class="c1"># filename: config.rb</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
</pre></div>
<p>By using a conditional when setting the environment variable (<code>||=</code>) we are making it so we can override this value when launching our test suite. It essentially means if the environment variable already exists and contains a value, use it. Otherwise, set it to 'http://the-internet.herokuapp.com'. This will come in handy later, and is something we'll use frequently.</p>

<p>With base URL in a central place, we can now remove it from our tests, but we'll need to remember to require this config file when running our tests. More on that soon.</p>
<h2>Global Setup And Teardown</h2>

<p>Now we're ready to pull the test setup and teardown actions out of our tests and into a central place. In RSpec this is straight-forward through the use of a 'spec_helper' file. This can live alongside the other test files in the <code>spec</code> directory.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/spec_helper.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>We need to include the Selenium library here, and by doing so, can remove it from our base page object. And by having our Selenium setup and teardown here, we can remove it from the <code>before(:each)</code> and <code>after(:each)</code> in our tests -- replacing them with a simple require statement at the top of the file (<code>require_relative 'spec_helper'</code>). We will also be able to remove the <code>after(:each)</code> from our tests, leaving just the <code>before(:each)</code> for use with our page objects.</p>

<p>Here's what our test files should look like when we're done:</p>
<div class="highlight"><pre><span class="c1"># filename: spec/login_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'spec_helper'</span>
<span class="n">require_relative</span> <span class="s1">'../pages/login'</span>

<span class="n">describe</span> <span class="s1">'Login'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@login</span> <span class="o">=</span> <span class="no">Login</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'succeeded'</span> <span class="k">do</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s1">'tomsmith'</span><span class="p">,</span> <span class="s1">'SuperSecretPassword!'</span><span class="p">)</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">success_message_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'failed'</span> <span class="k">do</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s1">'asdf'</span><span class="p">,</span> <span class="s1">'asdf'</span><span class="p">)</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">failure_message_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: spec/dynamic_loading_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'spec_helper'</span>
<span class="n">require_relative</span> <span class="s1">'../pages/dynamic_loading'</span>

<span class="n">describe</span> <span class="s1">'Dynamic Loading'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@dynamic_loading</span> <span class="o">=</span> <span class="no">DynamicLoading</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'Example 1: Hidden Element'</span> <span class="k">do</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">example</span> <span class="mi">1</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">start</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">finish_text_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'Example 2: Rendered after the fact'</span> <span class="k">do</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">example</span> <span class="mi">2</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">start</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">finish_text_present?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><h2>Running Everything</h2>

<p>Now that things are cleaned up, let's run everything. To do that we'll want to make sure to include our new config file. We can do that by specifying it at run time with <code>rspec --require ./config.rb</code>, or, <code>rspec -r ./config.rb</code> (for short).</p>

<p>Note the <code>./</code> before <code>config.rb</code>. This tells RSpec that the config file is in the current directory.</p>

<p>Give it a shot. All of the tests should run and pass.</p>
<h1 id="chapter12"><small>Chapter 12</small><br>Running A Different Browser Locally</h1>

<p>It's straightforward to get your tests running locally against Firefox (that's what we've been doing up until now). But when you want to run them against a different browser like Chrome you quickly run into configuration overhead that can seem overly complex and lacking in good documentation or examples.</p>
<h2>A Brief Primer On Browser Drivers</h2>

<p>With the introduction of WebDriver (circa Selenium 2) a lot of benefits were realized (e.g., more effective and faster browser execution, no more single host origin issues, etc). But with it came some architectural and configuration differences that may not be widely known. Namely -- browser drivers.</p>

<p>WebDriver works with each of the major browsers through a browser driver which is (ideally) maintained by the browser manufacturer. It is an executable file (consider it a thin layer or a shim) that acts as a bridge between Selenium and the browser.</p>

<p>Let's step through an example using <a href="https://code.google.com/p/selenium/wiki/ChromeDriver">ChromeDriver</a>.</p>
<h2>An Example</h2>

<p>Before starting, we'll need to <a href="http://chromedriver.storage.googleapis.com/index.html">grab the latest ChromeDriver binary executable from Google</a> and store the unzipped contents of it in our test code. The simplest thing to do is create a new folder for it (and other things like it).</p>

<p>Let's create a 'vendor' directory and place it there.</p>
<div class="highlight"><pre>.
<span class="p">|</span>-- config.rb
<span class="p">|</span>-- Gemfile
<span class="p">|</span>-- pages
<span class="p">|</span>   <span class="p">|</span>-- base_page.rb
<span class="p">|</span>   <span class="p">|</span>-- dynamic_loading.rb
<span class="p">|</span>   <span class="sb">`</span>-- login.rb
<span class="p">|</span>-- spec
<span class="p">|</span>   <span class="p">|</span>-- dynamic_loading_spec.rb
<span class="p">|</span>   <span class="p">|</span>-- login_spec.rb
<span class="p">|</span>   <span class="sb">`</span>-- spec_helper.rb
<span class="sb">`</span>-- vendor
    <span class="sb">`</span>-- chromedriver
</pre></div>
<p>In order for Selenium to use this binary, we have to make sure it knows where it is. There are two ways to do that. We can add the <code>chromedriver</code> file to the path of our system, or pass in the file's path when launching Selenium. Let's do the latter option.</p>

<p>But before we go too far, we want to make it so our test suite can run either Firefox or Chrome. To do that, we need to add a browser environment variable to our 'config.rb' and some conditional logic to our 'spec_helper' file.</p>
<div class="highlight"><pre><span class="c1"># filename: config.rb</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">||=</span> <span class="s1">'firefox'</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: spec/spec_helper.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">case</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>
    <span class="k">when</span> <span class="s1">'firefox'</span>
      <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
    <span class="k">when</span> <span class="s1">'chrome'</span>
      <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Chrome</span><span class="o">::</span><span class="no">Service</span><span class="o">.</span><span class="n">executable_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="p">,</span> <span class="s1">'vendor/chromedriver'</span><span class="p">)</span>
      <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:chrome</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>In the <code>config.before(:each)</code> block of our 'spec_helper' we're keying off of the browser environment variable we set in 'config.rb'; using a conditional to determine which browser driver to load. For Chrome we are first telling Selenium where the chromedriver binary executable is located on disk, and then instantiating it.</p>

<p>Assuming Chrome is already installed on the system (in a standard location) when we run our tests (specifying Chrome as the browser) -- <code>browser='chrome' rspec -r ./config.rb</code> -- then we should see them execute in Chrome. If that's not the case for you, then check out <a href="https://code.google.com/p/selenium/wiki/ChromeDriver">the ChromeDriver documentation site</a> to see if there are additional requirements for your specific system setup.</p>

<p>It's worth noting that this will only be reasonably performant since it is launching and terminating the chromedriver binary executable before and after every test. There are alternative approaches we can take, but this is good enough to see where our tests fall down in Chrome (and it will not be the primary way we will run our tests a majority of the time).</p>
<h2>Additional Browsers</h2>

<p>A similar approach can be applied to other browser drivers, with the only real limitation being the operating system you're running. But remember -- no two browser drivers are alike, so be sure to check out the documentation for the browser you care about to find out the specific requirements:</p>

<ul>
<li><a href="https://code.google.com/p/selenium/wiki/ChromeDriver">ChromeDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/FirefoxDriver">FirefoxDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/InternetExplorerDriver">InternetExplorer Driver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/OperaDriver">OperaDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/SafariDriver">SafariDriver</a></li>
</ul>
<h1 id="chapter13"><small>Chapter 13</small><br>Running Browsers In The Cloud</h1>

<p>If you've ever needed to test features in an older browser like Internet Explorer 8 then odds are you ran a virtual machine (VM) on your computer with a &quot;legit&quot; version of Windows XP.</p>

<p>Handy, but what happens when you need to check things on multiple versions of IE? Now you're looking at multiple VMs. And what about when you need to scale and cover other browser and Operating System (OS) combinations? Now you're looking at provisioning, running, and maintaining your own farm of machines and standing up something like Selenium Grid to coordinate tests across them.</p>

<p>And all you wanted to do was run your tests on the browsers you cared about...</p>

<p>Rather than take on the overhead of a test infrastructure you can easily outsource things to a third-party cloud provider. There are a handful of players in this space, but there's one that stands out -- Sauce Labs.</p>
<h2>Why Sauce Labs?</h2>

<p>They don't stand out because they enable you to run your tests on pretty much every browser/OS/platform combination. Or because they have great test reporting (like screenshots AND video recordings of your tests). Or for any of the other <a href="https://saucelabs.com/features">killer features they have</a>.</p>

<p>They stand out because they're not just building something to sell. They work hard to help make the Selenium Community (and open source software) better. And it's through their contributions that they are able to discern what to build -- so it's something that is attuned to the needs of the community.</p>
<h2>A Selenium Remote, Selenium Grid, And Sauce Labs Primer</h2>

<p>At the heart of Selenium at scale is the use of Selenium Grid and Selenium Remote. Selenium Grid lets you distribute test execution across several machines and you connect to it with Selenium Remote -- specifying the browser type and version through the use of Selenium Remote's <code>Capabilities</code>.</p>

<p>This is fundamentally how Sauce Labs works. Behind the curtain they are ultimately running Selenium Grid, and they receive and execute your tests through Selenium Remote -- knowing which browser and operating system to use because of the <code>Capabilities</code> it's users specify.</p>

<p>Let's dig in with an example.</p>
<h2>An Example</h2>
<h3>Part 1: Initial Setup</h3>

<p><strong>NOTE: You'll need an account to use Sauce Labs. Their free one offers enough to get you started. And if you're signing up because you want to test an open source project, then be sure to give <a href="https://saucelabs.com/opensauce">their 'Open Sauce' account</a> a look (tl;dr -- it's completely free).</strong></p>

<p>With Sauce Labs we need to provide specifics about what we want in our test environment, our credentials, and configure Selenium a little bit differently than we have been. Let's start by creating a new config file for cloud execution ('config_cloud.rb').</p>
<div class="highlight"><pre><span class="c1"># filename: config_cloud.rb</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span>         <span class="o">||=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span>             <span class="o">=</span> <span class="s1">'saucelabs'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">'Windows XP'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>          <span class="o">||=</span> <span class="s1">'internet_explorer'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span>  <span class="o">||=</span> <span class="s1">'8'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_USERNAME'</span><span class="o">]</span>   <span class="o">=</span> <span class="s1">'your-sauce-username'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_ACCESS_KEY'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'your-sauce-access-key'</span>
</pre></div>
<p>Notice the use of a host environment variable. This is what we'll use in our <code>spec_helper</code> file to determine whether to run things locally or in the cloud. And we'll use the other environment variables to populate the <code>Capabilities</code>.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/spec_helper.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">case</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span>
    <span class="k">when</span> <span class="s1">'saucelabs'</span>
      <span class="n">caps</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Capabilities</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span><span class="p">)</span>
      <span class="n">caps</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span>
      <span class="n">caps</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span>
      <span class="n">caps</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">metadata</span><span class="o">[</span><span class="ss">:full_description</span><span class="o">]</span>

      <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
        <span class="ss">:remote</span><span class="p">,</span>
        <span class="ss">url</span><span class="p">:</span> <span class="s2">&quot;http://</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_USERNAME'</span><span class="o">]</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_ACCESS_KEY'</span><span class="o">]</span><span class="si">}</span><span class="s2">@ondemand.saucelabs.com:80/wd/hub&quot;</span><span class="p">,</span>
        <span class="ss">desired_capabilities</span><span class="p">:</span> <span class="n">caps</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">case</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>
      <span class="k">when</span> <span class="s1">'firefox'</span>
        <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
      <span class="k">when</span> <span class="s1">'chrome'</span>
        <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Chrome</span><span class="o">::</span><span class="no">Service</span><span class="o">.</span><span class="n">executable_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="p">,</span> <span class="s1">'vendor/chromedriver'</span><span class="p">)</span>
        <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:chrome</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>We've taken our original conditional and made it nested underneath a check for the host environment variable. If the host is set to 'saucelabs', then we configure the capabilities for Selenium Remote, passing in the requisite information that we will need for our Sauce Labs session. Otherwise, it will run our tests locally.</p>

<p>The actual username and API key have been omitted from this example. To make this work, simply add yours in to the 'config_cloud.rb' file.</p>

<p>There are a few things in this example that may be worth elaborating on.</p>

<p>First, we are using something called metaprogramming (a.k.a. code that writes code) when we are calling <code>Selenium::WebDriver::Remote::Capabilities</code>. We are using the <code>.send</code> method to pass in the environment variable. The value of which, in this case, is the same name as the method to configure Selenium Remote to use Internet Explorer. So, we are in effect, creating <code>Selenium::WebDriver::Remote::Capabilitites.internet_explorer</code>. And if we were to specify 'chrome' for <code>ENV['browser']</code>, then it would give us <code>Selenium::WebDriver::Remote::Capabilities.chrome</code>.</p>

<p>Second, for <code>caps[:name]</code> we are using a piece of functionality built into RSpec which gives us the name of each test as it is being run. This will make it so each individual job in Sauce Labs will have the name of the test that was run.</p>

<p>Third, for the <code>url:</code> line in our <code>@driver</code> instantiation, we are injecting our environment variable through the use of string interpolation. This is why we are using double-quoted strings. If they were single-quotes then we wouldn't be able to do it.</p>

<p>Now if we run our test suite (<code>rspec -r ./config_cloud.rb</code>) and navigate to <a href="https://saucelabs.com/account">our Sauce Labs Account page</a> then we should see each of the tests running in their own job, with proper names, against Internet Explorer 8.</p>
<h3>Part 2: Test Status</h3>

<p>The only thing missing now is the pass/fail status of the job. In our local terminal window everything should be coming up green. But in the list of our Sauce jobs, the 'Results' panel for everything will just say 'Finished'. This will make our results less useful in the long run, so let's fix it.</p>

<p>Thanks to Sauce Labs' 'sauce_whisk' gem, it's really simple to do.</p>

<p>After we install it we will need to require it somewhere, and our 'config_cloud.rb' file seems like a logical place, since we will only need it when running our tests in Sauce. So let's add it to the top of the file.</p>
<div class="highlight"><pre><span class="c1"># filename: config_cloud.rb</span>

<span class="nb">require</span> <span class="s1">'sauce_whisk'</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>All that's left is to add an action to our <code>after(:each)</code> block in our 'spec_helper' file.</p>

<p>Before we issue <code>@driver.quit</code> we will want to grab the job ID from our <code>@driver</code> object and set the job status based on the test result. Also, we'll want to make sure that it only executes when running tests against Sauce Labs -- so we'll want to wrap it in a conditional check against the host environment variable.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/spec_helper.rb</span>
<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'saucelabs'</span>
      <span class="k">if</span> <span class="n">example</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">nil?</span>
        <span class="no">SauceWhisk</span><span class="o">::</span><span class="no">Jobs</span><span class="o">.</span><span class="n">pass_job</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">session_id</span>
      <span class="k">else</span>
        <span class="no">SauceWhisk</span><span class="o">::</span><span class="no">Jobs</span><span class="o">.</span><span class="n">fail_job</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">session_id</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>Now when we run our tests (<code>rspec -r ./config_cloud.rb</code>) and navigate to <a href="https://saucelabs.com/account">our Sauce Labs Account page</a>, we should see our tests running like before -- but now when they finish there should be a proper test status (e.g., 'Pass' or 'Fail').</p>
<h3>Part 3: Accessing Private Apps</h3>

<p>There are various ways that companies make their pre-production application available for testing. Some use an obscure public URL and protect it with some form of authentication (e.g., Basic Auth, or cert based authentication). Others keep it behind their firewall.</p>

<p>For those that stay behind a firewall, Sauce Labs has got you covered. They have a program called <a href="https://saucelabs.com/docs/connect">Sauce Connect</a> that creates a secure tunnel between your machine and their cloud. With it, you can run tests in Sauce Labs and still have them reach the apps that are only available on your network.</p>

<p>In Ruby there are two ways to leverage Sauce Connect; a separate download, or through another one of Sauce's Ruby libraries -- 'sauce-connect'.</p>

<p>Let's step through an example using the 'sauce-connect' gem and running a copy of 'the-internet' locally.</p>
<h2>An Example</h2>

<p>First we'll need to install the 'sauce-connect' library. Once we have it, we'll add it to our 'config_cloud.rb' file. To require it we need to refer to it as <code>sauce</code>. Since we only need to load this library when connecting to the tunnel, let's wrap it in a conditional.</p>
<div class="highlight"><pre><span class="c1"># filename: config_cloud.rb</span>

<span class="nb">require</span> <span class="s1">'sauce_whisk'</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span>         <span class="o">||=</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span>             <span class="o">=</span> <span class="s1">'saucelabs'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">'Windows XP'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>          <span class="o">||=</span> <span class="s1">'internet_explorer'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span>  <span class="o">||=</span> <span class="s1">'8'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_USERNAME'</span><span class="o">]</span>   <span class="o">=</span> <span class="s1">'your-sauce-username'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_ACCESS_KEY'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'your-sauce-access-key'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'tunnel'</span><span class="o">]</span>           <span class="o">||=</span> <span class="s1">''</span>

<span class="k">unless</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'tunnel'</span><span class="o">].</span><span class="n">empty?</span>
  <span class="nb">require</span> <span class="s1">'sauce'</span>
  <span class="no">Sauce</span><span class="o">::</span><span class="no">Utilities</span><span class="o">::</span><span class="no">Connect</span><span class="o">.</span><span class="n">start</span>
  <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span>       <span class="o">=</span> <span class="s1">'http://the-internet-local:4567'</span>
<span class="k">end</span>
</pre></div>
<p>At the bottom of the file we've added a new environment variable (<code>ENV['tunnel']</code>), set it to an empty string, and made it so we can override it at runtime.</p>

<p>We then check to see if it's empty. If it is empty, then we do nothing. If it isn't empty, then we load the sauce-connect library (<code>require 'sauce'</code>), start the Sauce Connect tunnel, and change the base URL to run our tests against a different end-point (<code>'http://the-internet-local:4567'</code>).</p>

<p>This new URL is how we will interact with our local copy of 'the-internet'. To use it, we'll first need to download and unzip a copy of it from <a href="https://github.com/tourdedave/the-internet">it's GitHub repo</a> and place it in 'vendor/the-internet'.</p>

<p>When we're done, our directory tree should look like this:</p>
<div class="highlight"><pre>.
<span class="p">|</span>-- config_cloud.rb
<span class="p">|</span>-- config.rb
<span class="p">|</span>-- pages
<span class="p">|</span>   <span class="p">|</span>-- base_page.rb
<span class="p">|</span>   <span class="p">|</span>-- dynamic_loading.rb
<span class="p">|</span>   <span class="sb">`</span>-- login.rb
<span class="p">|</span>-- sauce_connect.log
<span class="p">|</span>-- spec
<span class="p">|</span>   <span class="p">|</span>-- dynamic_loading_spec.rb
<span class="p">|</span>   <span class="p">|</span>-- login_spec.rb
<span class="p">|</span>   <span class="sb">`</span>-- spec_helper.rb
<span class="sb">`</span>-- vendor
    <span class="p">|</span>-- chromedriver
    <span class="sb">`</span>-- the-internet
</pre></div>
<p>Next we need to update our local hosts file to map our local IP address (127.0.0.1) to a DNS helper name (e.g., 'the-internet-local'). This is so our tests running on Sauce Labs will be able to find our local server.</p>

<p>If we just provide 'localhost' or 127.0.0.1, it won't work (as noted in <a href="http://support.saucelabs.com/entries/20912606-Localhost-ports-for-Sauce-Connect">this Sauce Support post</a>. Updating the hosts file varies depending on your operating system. So if you're not sure how to do it, or what that means, then give <a href="http://www.howtogeek.com/howto/27350/">this How-To Geek article</a> a read.</p>

<p>Now we can open a new terminal window, change into the 'vendor/the-internet' directory, and start the app (with <code>ruby server.rb</code>) -- which will make it available on port 4567. If you receive an error, be sure to install the necessary gems (e.g., try running <code>bundle install</code> before trying the server again).</p>

<p>Now that our server is running locally, let's switch back over to our original terminal window and run our tests. In order to trigger our tunnel, we will need to override our tunnel environment variable. So let's run the following: <code>tunnel='on' rspec -r ./config_cloud.rb</code>.</p>

<p>We should then see the following appear in our terminal.</p>
<div class="highlight"><pre><span class="o">[</span>Connecting to Sauce Labs...<span class="o">]</span>
</pre></div>
<p>If we navigate to <a href="https://saucelabs.com/tunnels">our Sauce Labs Tunnel Status page</a> then we should see a tunnel listed as active. And if we navigate to <a href="https://saucelabs.com/account">our Sauce Labs Account page</a> then we should see each of the tests running in their own job -- each executing against our local server.</p>

<p>Once the tests finish, the tunnel should close. We can quickly confirm this by revisiting <a href="https://saucelabs.com/tunnels">the Sauce Labs Tunnel Status page</a>.</p>
<h3>Part 4: A Small Bit Of Clean-up</h3>

<p>One by-product of this setup is that a 'sauce_connect.log' file will get outputted into our root directory. We won't really end up using it, nor is it easily configurable to suppress or move it to a different location. Therefore we can choose to ignore it by adding it to a version control system ignore file (which is '.gitignore' in my case) so that it doesn't get pushed up into the test repository.</p>
<div class="highlight"><pre><span class="c1"># filename: .gitignore</span>

<span class="o">*.</span><span class="n">log</span>
</pre></div>
<p>Now that we have two config files, let's move them into their own directory and pare down the names for simplicity. Let's create a <code>config</code> directory and rename the files to <code>local.rb</code> and <code>cloud.rb</code>.</p>

<p>This leaves our directory tree structure looking like this:</p>
<div class="highlight"><pre>.
<span class="p">|</span>-- config
<span class="p">|</span>   <span class="p">|</span>-- cloud.rb
<span class="p">|</span>   <span class="sb">`</span>-- local.rb
<span class="p">|</span>-- pages
<span class="p">|</span>   <span class="p">|</span>-- base_page.rb
<span class="p">|</span>   <span class="p">|</span>-- dynamic_loading.rb
<span class="p">|</span>   <span class="sb">`</span>-- login.rb
<span class="p">|</span>-- spec
<span class="p">|</span>   <span class="p">|</span>-- dynamic_loading_spec.rb
<span class="p">|</span>   <span class="p">|</span>-- login_spec.rb
<span class="p">|</span>   <span class="sb">`</span>-- spec_helper.rb
<span class="sb">`</span>-- vendor
    <span class="p">|</span>-- chromedriver
    <span class="sb">`</span>-- the-internet
</pre></div><h1 id="chapter14"><small>Chapter 14</small><br>Speeding Up Your Test Runs</h1>

<p>It's great that we can easily run our tests in Sauce Labs. But it's a real bummer that all of our tests are executing in series. As our suite grows, things will quickly start to add up and really hamper our ability to get feedback quickly.</p>

<p>With parallelization we can quickly remedy this -- and in Ruby there is a library that makes this simple to accomplish.</p>

<p>Enter <a href="https://github.com/grosser/parallel_tests">parallel_tests</a>.</p>
<h2>Setup</h2>

<p>After installing the library we just have to change out the command we use to execute our test runs. Instead of <code>rspec</code> we will use one that parallel_tests provides -- <code>parallel_rspec</code>.</p>

<p><code>parallel_rspec</code> is effectively a wrapper around RSpec. It's responsible for breaking our spec files into groups and launching each of them in separate system processes along with any arguments we pass in to configure RSpec. So we can still provide our <code>--r</code>, we just have to specify <code>--test-options</code> before-hand.</p>

<p>To run our tests in parallel with Sauce Labs (without the secure tunnel), then we would use <code>parallel_rspec --test-options '-r ./config/cloud.rb' spec</code>. Note the additional <code>spec</code> at the end of the command. This tells <code>parallel_rspec</code> where the test files live (which is in the 'spec' directory).</p>

<p>These extra arguments can seem a little verbose, but it's a necessary evil with this library -- and it's a small price to pay to get parallelization.</p>
<h2>Number Of Processes</h2>

<p>By default <code>parallel_rspec</code> will use two processes. We can increase this number by passing an additional argument of <code>-n</code> and the number of processes that we want -- e.g., <code>parallel_rspec -n 5</code>. But keep in mind that the actual number of parallel processes that get spawned depends on <strong>how many spec files there are (since this library works at the file level)</strong>. So for now, two processes is all we'll get (since we only have two test files). But as our suite grows, increasing the number of processes will yield a huge performance improvement.</p>

<p>It's also worth noting that Sauce Labs is built to handle test execution in parallel. You just need to be cognizant of how many parallel sessions your account is set up to handle (e.g., three for Sauce Open accounts).</p>
<h2>Randomizing</h2>

<p>A great way to make sure your tests don't have any cross-dependencies (and to ferret out possible anomalies in your application under test) is to run your tests in a random order. Within RSpec this is an easy thing to accomplish. It's just another command-line argument to pass in on test execution <code>--order random</code>.</p>
<div class="highlight"><pre><span class="n">parralel_rspec</span> <span class="o">--</span><span class="nb">test</span><span class="o">-</span><span class="n">options</span> <span class="s1">'-r ./config_cloud.rb --order random'</span>
</pre></div>
<p>This coupled with parallelization will help make your tests really sing.</p>
<h1 id="chapter15"><small>Chapter 15</small><br>Organizing Your Test Runs</h1>

<blockquote>
<p>&quot;Am I the only Ruby dev who writes rake tasks for everything? Don't want to worry about the syntax of 50 different cmds or which dir I'm in.&quot; <a href="https://twitter.com/russolsen/status/428227153377779713">[source]</a>  </p>

<p>-- <a href="http://russolsen.com/">Russ Olsen</a> (author of &quot;Eloquent Ruby&quot; and &quot;Design Patterns in Ruby&quot;)</p>
</blockquote>

<p>There's a lot to remember every time we want to run our tests now. So let's clean things up with some Rake tasks.</p>

<p>Rake is a library in Ruby that enables us to easily capture and run repetitive tasks. To set it up, we just need to install the 'rake' gem, add a 'Rakefile' in our root directory, and add our tasks to the 'Rakefile'. Then all we have to do is run our tasks using <code>rake</code> from the command-line.</p>

<p>Let's step through an example.</p>
<h2>An Example</h2>
<h3>Part 1: Create A Rakefile And Add Initial Tasks</h3>

<p>First we'll want to create a 'Rakefile' with some initial tasks.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>

<span class="k">def</span> <span class="nf">launch_in_parallel</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;parallel_rspec </span><span class="si">#{</span><span class="s1">'-n '</span> <span class="o">+</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'processes'</span><span class="o">]</span> <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'processes'</span><span class="o">]</span><span class="si">}</span><span class="s2"> --test-options '-r ./</span><span class="si">#{</span><span class="n">config_file</span><span class="si">}</span><span class="s2"> --order random' spec&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">desc</span> <span class="s1">'Run tests locally, by browser'</span>
<span class="n">task</span> <span class="ss">:local</span><span class="p">,</span> <span class="ss">:browser</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
  <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:browser</span><span class="o">]</span>
  <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/local.rb'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">desc</span> <span class="s2">&quot;Run tests in Sauce&quot;</span>
<span class="n">task</span> <span class="ss">:cloud</span> <span class="k">do</span>
  <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/cloud.rb'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">desc</span> <span class="s2">&quot;Run tests in Sauce Connect&quot;</span>
<span class="n">task</span> <span class="ss">:cloud_tunnel</span> <span class="k">do</span>
  <span class="no">ENV</span><span class="o">[</span><span class="s1">'tunnel'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'on'</span>
  <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/cloud.rb'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
<p>Note that this looks similar to a standard Ruby file. We declare a method, reference that method, do some string interpolation, and set some environment variable values. It's the task declaration that's a little bit different (and specific to Rake).</p>

<p>To declare a task, we first want to give it a description. Descriptions are useful since they show up in our task list (next to the command to launch the task). If one is not set, then the task will not appear in the task list. To set one, we use the keyword <code>desc</code> and provide a string value (e.g., <code>'Run tests locally, by browser'</code>).</p>

<p>Once we have that, we can create the task itself. This is done with the keyword <code>task</code> followed by the name of the task (written as a symbol -- <code>:cloud</code>). The first line of a task ends with the word <code>do</code> -- this opens up the code block and terminates with the word <code>end</code>. Between <code>do</code> and <code>end</code> is where we place the code for our task.</p>

<p>Our <code>:local</code> task is a bit different than the others since we are taking an argument. To accomplish this we specify an additional parameter on the <code>task</code> line (e.g., <code>task :local, :browser</code>) and some variables in pipes after <code>do</code> (e.g., <code>do |t, args|</code>). With the <code>args</code> variable we are able to receive an argument at run time and pass it into the browser environment variable (e.g., <code>ENV['browser'] = args[:browser]</code>).</p>

<p><strong>NOTE: For more information on Rake, check out <a href="http://jasonseifer.com/2010/04/06/rake-tutorial">this tutorial</a>.</strong></p>

<p>In our <code>launch_in_parallel</code> method we pull out the lengthy command used to run our tests and wrap it in a <code>system</code> command to launch it. We also make this method accept an argument for the config file and inject it into the execution string through interpolation. This enables us to use it for each of our rake tasks. It also keeps our tasks clean -- removing redundancy -- and enables us to easily change our execution string (if we need to add additional arguments).</p>

<p>If we save this file, close it, and run <code>rake -T</code> from the command-line, we should see a list of our available Rake actions.</p>
<div class="highlight"><pre>rake cloud           <span class="c"># Run tests in Sauce</span>
rake cloud_tunnel    <span class="c"># Run tests in Sauce Connect</span>
rake <span class="nb">local</span><span class="o">[</span>browser<span class="o">]</span>  <span class="c"># Run tests locally, by browser</span>
</pre></div>
<p>To run a task, just type <code>rake</code> followed by the task name. For tasks that take an argument, wrap the argument in single-quotes (e.g., <code>rake local['firefox']</code>). And to specify the number of parallel processes in our test runs, we do that with an environment variable before our <code>rake</code> command (e.g., <code>processes='5' rake cloud</code>).</p>

<p>If we run either the <code>cloud</code> or <code>local</code> tasks, they run our tests in parallel with 2 processes, in a random order, and should pass. But the <code>cloud_tunnel</code> task will result in failing tests since our local copy of 'the-internet' is probably not running. Let's remedy that by updating the <code>cloud_tunnel</code> task to start and stop it.</p>
<h3>Part 2: Automate Starting And Stopping Our Local Application</h3>

<p>In our <code>:cloud_tunnel</code> task, we want to wrap our environment variable setting and test execution command with the necessary starting and stopping actions for our server. We already know how to start the server (<code>ruby server.rb</code> from within the 'vendor/the-internet' directory). But since there's no clean way to stop the server, we need to muck about with the process ID and send a kill command to it.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>

<span class="n">desc</span> <span class="s2">&quot;Run tests in Sauce Connect&quot;</span>
<span class="n">task</span> <span class="ss">:cloud_tunnel</span> <span class="k">do</span>
  <span class="no">Dir</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">'vendor/the-internet'</span><span class="p">)</span>
  <span class="n">process_id</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">'ruby server.rb'</span><span class="p">)</span>
  <span class="no">Dir</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">'../..'</span><span class="p">)</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'tunnel'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'on'</span>
    <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/cloud.rb'</span><span class="p">)</span>
  <span class="no">Process</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="s2">&quot;KILL&quot;</span><span class="p">,</span> <span class="n">process_id</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
<p>First, we change directories into <code>'vendor/the-internet'</code> to get access to the application and its dependent libraries. We then launch the server by spawning it in its own process (so it runs in the background); storing the return result (which is the process ID of the server, and a Fixnum value) in a variable.</p>

<p>We then traverse back up to the root directory, run our tests, and then stop the server when they're done -- issuing a kill command with the process ID that we stored.</p>

<p>Now if we run this task (<code>rake cloud_tunnel</code>) then our tests should run in Sauce Labs, through the secure tunnel, and exercise our locally served app.</p>
<h3>Part 3: Add Tasks For The Browsers We Care About</h3>

<p>Now that we have Rake tasks we are in a better position to run tests quickly. But in order to make this approach worthwhile, we want to add more tasks to support different browser combinations. And while we're at it, we might as well make our local browser options explicit (rather than just argument based).</p>

<p>Let's start with the local tasks, and then add the cloud ones.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>

<span class="k">def</span> <span class="nf">launch_in_parallel</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;parallel_rspec </span><span class="si">#{</span><span class="s1">'-n '</span> <span class="o">+</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'processes'</span><span class="o">]</span> <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'processes'</span><span class="o">]</span><span class="si">}</span><span class="s2"> --test-options '-r ./</span><span class="si">#{</span><span class="n">config_file</span><span class="si">}</span><span class="s2"> --order random' spec&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">namespace</span> <span class="ss">:local</span> <span class="k">do</span>
  <span class="n">desc</span> <span class="s1">'Run tests in Firefox'</span>
  <span class="n">task</span> <span class="ss">:firefox</span> <span class="k">do</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'firefox'</span>
    <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/local.rb'</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">desc</span> <span class="s1">'Run tests in Chrome'</span>
  <span class="n">task</span> <span class="ss">:chrome</span> <span class="k">do</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'chrome'</span>
    <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/local.rb'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>Our <code>launch_in_parallel</code> method remains unchanged. We instead focus on reworking our local task -- turning it into two simple tasks which live underneath a namespace.</p>

<p>In Rake we can group common tasks together with a <code>namespace</code>, which follows the same naming conventions as a task. This helps organize our task list, making things more intuitive to run. You'll see what I mean soon.</p>

<p>Now let's add in our cloud tasks.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>

<span class="n">namespace</span> <span class="ss">:cloud</span> <span class="k">do</span>
  <span class="n">desc</span> <span class="s2">&quot;Run tests in IE, by version&quot;</span>
  <span class="n">task</span> <span class="ss">:ie</span><span class="p">,</span> <span class="ss">:version</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'internet_explorer'</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span>
    <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/cloud.rb'</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">desc</span> <span class="s2">&quot;Run tests in Firefox, by version&quot;</span>
  <span class="n">task</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:version</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'firefox'</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span>
    <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/cloud.rb'</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">desc</span> <span class="s2">&quot;Run tests in Chrome, by version&quot;</span>
  <span class="n">task</span> <span class="ss">:chrome</span><span class="p">,</span> <span class="ss">:version</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'chrome'</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span>
    <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/cloud.rb'</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">desc</span> <span class="s2">&quot;Run tests against local app in Sauce Connect&quot;</span>
  <span class="n">task</span> <span class="ss">:tunnel</span> <span class="k">do</span>
    <span class="no">Dir</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">'vendor/the-internet'</span><span class="p">)</span>
    <span class="n">process_id</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">'ruby server.rb'</span><span class="p">)</span>
    <span class="no">Dir</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">'../..'</span><span class="p">)</span>
      <span class="no">ENV</span><span class="o">[</span><span class="s1">'tunnel'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'on'</span>
      <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/cloud.rb'</span><span class="p">)</span>
    <span class="no">Process</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="s2">&quot;KILL&quot;</span><span class="p">,</span> <span class="n">process_id</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
<p>By using a <code>:cloud</code> namespace we are able to group our cloud tasks together.</p>

<p>We've renamed our <code>:cloud_tunnel</code> task to <code>:tunnel</code> and removed our <code>:cloud</code> task -- replacing it with tasks for various browsers which take an argument for the browser version.</p>

<p>If we run <code>rake -T</code> we should see the following.</p>
<div class="highlight"><pre>rake cloud:chrome<span class="o">[</span>version<span class="o">]</span>   <span class="c"># Run tests in Chrome, by version</span>
rake cloud:firefox<span class="o">[</span>version<span class="o">]</span>  <span class="c"># Run tests in Firefox, by version</span>
rake cloud:ie<span class="o">[</span>version<span class="o">]</span>       <span class="c"># Run tests in IE, by version</span>
rake cloud:tunnel            <span class="c"># Run tests against local app in Sauce Connect</span>
rake <span class="nb">local</span>:chrome            <span class="c"># Run tests in Chrome</span>
rake <span class="nb">local</span>:firefox           <span class="c"># Run tests in Firefox</span>
</pre></div>
<p>If we want to run our tests against Internet Explorer 8, all we have to do now is run <code>rake cloud:ie['8']</code>.</p>

<p>Keep in mind that our default operating system environment variable is set to 'Windows XP'. So if we try for a browser version that's too high (e.g., <code>rake cloud:ie['11']</code>), then we will receive an error message from Sauce Labs stating 'Unsupported OS/browser/version combo'.</p>

<p>To handle this, we need to alter the operating system environment variable (<code>ENV['operating_system']</code>) in our Rake tasks.</p>
<h3>Part 4: Update Tasks to Make The Operating System Configurable</h3>

<p>We can pretty easily remedy this by adding an additional argument to our Rake tasks. Let's see what it would look like in our <code>:ie</code> task.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>

<span class="n">namespace</span> <span class="ss">:cloud</span> <span class="k">do</span>

  <span class="n">desc</span> <span class="s2">&quot;Run tests in IE, by OS and version&quot;</span>
  <span class="n">task</span> <span class="ss">:ie</span><span class="p">,</span> <span class="ss">:version</span><span class="p">,</span> <span class="ss">:os</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'internet_explorer'</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:os</span><span class="o">]</span>
    <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/cloud.rb'</span><span class="p">)</span>
  <span class="k">end</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>When we run <code>rake -T</code> we'll see our updated task list:</p>
<div class="highlight"><pre>rake cloud:chrome<span class="o">[</span>version<span class="o">]</span>      <span class="c"># Run tests in Chrome, by version</span>
rake cloud:firefox<span class="o">[</span>version<span class="o">]</span>     <span class="c"># Run tests in Firefox, by version</span>
rake cloud:ie<span class="o">[</span>version,os<span class="o">]</span>       <span class="c"># Run tests in IE, by OS and version</span>
rake cloud:tunnel               <span class="c"># Run tests against local app in Sauce Connect</span>
rake <span class="nb">local</span>:chrome               <span class="c"># Run tests in Chrome</span>
rake <span class="nb">local</span>:firefox              <span class="c"># Run tests in Firefox</span>
</pre></div>
<p>Now if we wanted to run our tests against different versions of Internet Explorer, we can freely do it by specifying both the operating system and the version of IE. For example:</p>
<div class="highlight"><pre><span class="c"># note that there are no spaces around the comma (,)</span>
rake cloud:ie<span class="o">[</span><span class="s1">'6'</span>,<span class="s1">'Windows XP'</span><span class="o">]</span>
rake cloud:ie<span class="o">[</span><span class="s1">'7'</span>,<span class="s1">'Windows XP'</span><span class="o">]</span>
rake cloud:ie<span class="o">[</span><span class="s1">'8'</span>,<span class="s1">'Windows XP'</span><span class="o">]</span>
rake cloud:ie<span class="o">[</span><span class="s1">'8'</span>,<span class="s1">'Windows 7'</span><span class="o">]</span>
rake cloud:ie<span class="o">[</span><span class="s1">'9'</span>,<span class="s1">'Windows 7'</span><span class="o">]</span>
rake cloud:ie<span class="o">[</span><span class="s1">'10'</span>,<span class="s1">'Windows 7'</span><span class="o">]</span>
rake cloud:ie<span class="o">[</span><span class="s1">'10'</span>,<span class="s1">'Windows 8'</span><span class="o">]</span>
</pre></div>
<p>Let's apply the same configuration to the Firefox and Chrome cloud tasks. And while we're at it, let's add the same (plus a browser argument) for the tunnel task.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>

<span class="n">namespace</span> <span class="ss">:cloud</span> <span class="k">do</span>

  <span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="n">desc</span> <span class="s2">&quot;Run tests in Firefox&quot;</span>
  <span class="n">task</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:version</span><span class="p">,</span> <span class="ss">:os</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'firefox'</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:os</span><span class="o">]</span>
    <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/cloud.rb'</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">desc</span> <span class="s2">&quot;Run tests in Chrome&quot;</span>
  <span class="n">task</span> <span class="ss">:chrome</span><span class="p">,</span> <span class="ss">:version</span><span class="p">,</span> <span class="ss">:os</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'chrome'</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:os</span><span class="o">]</span>
    <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/cloud.rb'</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">desc</span> <span class="s2">&quot;Run tests against local app in Sauce Connect&quot;</span>
  <span class="n">task</span> <span class="ss">:tunnel</span><span class="p">,</span> <span class="ss">:browser</span><span class="p">,</span> <span class="ss">:version</span><span class="p">,</span> <span class="ss">:os</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser'</span><span class="o">]</span>  <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:browser</span><span class="o">]</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'browser_version'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">'operating_system'</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:os</span><span class="o">]</span>
    <span class="no">Dir</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">'vendor/the-internet'</span><span class="p">)</span>
    <span class="n">process_id</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">'ruby server.rb'</span><span class="p">)</span>
    <span class="no">Dir</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">'../..'</span><span class="p">)</span>
      <span class="no">ENV</span><span class="o">[</span><span class="s1">'tunnel'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'on'</span>
      <span class="n">launch_in_parallel</span><span class="p">(</span><span class="s1">'config/cloud.rb'</span><span class="p">)</span>
    <span class="no">Process</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="s2">&quot;KILL&quot;</span><span class="p">,</span> <span class="n">process_id</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
<p>Now our task list should look like this.</p>
<div class="highlight"><pre>rake cloud:chrome<span class="o">[</span>version,os<span class="o">]</span>          <span class="c"># Run tests in Chrome</span>
rake cloud:firefox<span class="o">[</span>version,os<span class="o">]</span>         <span class="c"># Run tests in Firefox</span>
rake cloud:ie<span class="o">[</span>version,os<span class="o">]</span>              <span class="c"># Run tests in IE</span>
rake cloud:tunnel<span class="o">[</span>browser,version,os<span class="o">]</span>  <span class="c"># Run tests against local app in Sauce Connect</span>
rake <span class="nb">local</span>:chrome                      <span class="c"># Run tests in Chrome</span>
rake <span class="nb">local</span>:firefox                     <span class="c"># Run tests in Firefox</span>
</pre></div>
<p>There are over 250 browser/OS combinations to choose from in Sauce Labs (you can see a full list <a href="https://saucelabs.com/platforms">here</a>), and there are numerous ways to organize your Rake tasks. So if you aren't looking forward to the prospect of remembering and typing out the operating system, browser, or browser version for your test runs, simply create tasks for each of the browser/OS combinations you care about.</p>

<p>That's one of the biggest advantages to having a Rakefile -- you can be as explicit as you want, have a central list to see what is available, and can easily run each item on that list.</p>
<h1 id="chapter16"><small>Chapter 16</small><br>Automating Your Test Runs</h1>

<p>You'll probably get a lot of mileage out of your test suite in its current form if you just run things from your computer, look at the results, and inform people when there are issues. But that only helps you solve part of the problem.</p>

<p>The real goal in all of this is to find issues reliably, quickly, and continuously. We've built things to be reliable and quick. Now we need to make them run continuously -- and ideally in sync with the development workflow you are a part of. In order to do that, we want to use a Continuous Integration (CI) server.</p>
<h2>A Continuous Integration Primer</h2>

<p>Continous Integration (a.k.a. CI) is the practice of merging code that is actively being worked on into a shared mainline (e.g., trunk or master) as often as possible (e.g., several times a day). This is with the hopes of finding issues early and avoiding merging and integration issues that are not only considered a special kind of hell, but can dramatically slow the time it takes to release software.</p>

<p>The use of a CI server (a.k.a. build server) enables this practice to be automated, and to have tests run as part of the work flow. The lion's share of tests that are typically run on a CI Server are unit (and potentially integration) tests. But we can very easily add in our automated acceptance tests.</p>

<p>There are numerous CI Servers available for use today, most notably:</p>

<ul>
<li><a href="https://www.atlassian.com/software/bamboo">Bamboo</a></li>
<li><a href="http://jenkins-ci.org/">Jenkins</a></li>
<li><a href="https://www.tddium.com/">Tddium</a></li>
<li><a href="https://travis-ci.org/">TravisCI</a></li>
</ul>
<h2>Part 1: Tagging &amp; Workflow</h2>

<p>In order to get the most out of our test runs in a CI environment, we want to break up our test suite into small, relevant chunks and have separate jobs for each. This helps keep test runs fast (so people on your team will care about them) and informative. <a href="http://gojko.net/2011/05/16/setting-up-a-build-pipeline-in-a-legacy-environment/">Gojko Adzic refers to these as 'Test Packs'</a>.</p>

<p>The workflow is pretty straightforward. The CI Server pulls in the latest code, merges it, and runs unit tests. We then have the CI Server kick off a new job to deploy to a test server and run a subset of our acceptance tests -- our critical ones (e.g., smoke or sanity tests). Assuming those pass, we can have another job run the remaining tests after that -- our longer running tests. <a href="https://github.com/adamgoucher/rspec-selenium-pageobjects#tags">Adam Goucher refers to this strategy as a 'shallow' and 'deep' tagging model</a>.</p>

<p>To demonstrate this, let's tag our tests and update our rake tasks to use them.</p>
<h3>An Example</h3>

<p>RSpec comes built in with tagging support. It's a simple matter of adding a key/value pair to denote what you want. You can place it on individual tests, or a group of tests -- using as many tags as you want (separating them with commas).</p>

<p>Let's add some to our specs -- following Adam Goucher's shallow and deep approach.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/dynamic_loading_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'spec_helper'</span>
<span class="n">require_relative</span> <span class="s1">'../pages/dynamic_loading'</span>

<span class="n">describe</span> <span class="s1">'Dynamic Loading'</span><span class="p">,</span> <span class="ss">depth</span><span class="p">:</span> <span class="s1">'deep'</span> <span class="k">do</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: spec/login_spec.rb</span>

<span class="n">require_relative</span> <span class="s1">'spec_helper'</span>
<span class="n">require_relative</span> <span class="s1">'../pages/login'</span>

<span class="n">describe</span> <span class="s1">'Login'</span><span class="p">,</span> <span class="ss">depth</span><span class="p">:</span> <span class="s1">'shallow'</span> <span class="k">do</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>If we wanted to apply this tag directly to a test, then it would look like this:</p>
<div class="highlight"><pre><span class="n">it</span> <span class="s1">'succeeded'</span><span class="p">,</span> <span class="ss">depth</span><span class="p">:</span> <span class="s1">'shallow'</span> <span class="k">do</span>
</pre></div>
<p>To run tests based on a specific tag, we will need to pass in an additional argument to RSpec. It starts with <code>--tag</code> and accepts a tag's key/value pair (e.g., <code>--tag depth:shallow</code> or <code>--tag depth:deep</code>).</p>

<p>Let's update our 'Rakefile' tasks to handle this.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>

<span class="k">def</span> <span class="nf">launch_in_parallel</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;parallel_rspec </span><span class="si">#{</span><span class="s1">'-n '</span> <span class="o">+</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'processes'</span><span class="o">]</span> <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'processes'</span><span class="o">]</span><span class="si">}</span><span class="s2"> --test-options '-r ./</span><span class="si">#{</span><span class="n">config_file</span><span class="si">}</span><span class="s2"> --order random </span><span class="si">#{</span><span class="s1">'--tag '</span> <span class="o">+</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'tag'</span><span class="o">]</span> <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'tag'</span><span class="o">]</span><span class="si">}</span><span class="s2">' spec&quot;</span><span class="p">)</span>
<span class="k">end</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>By updating our <code>launch_in_parallel</code> method to use a conditional based on the existence of the tag environment variable (<code>ENV['tag']</code>), we are able to dynamically alter our execution string at run time without having to change any of our tasks.</p>

<p>We just have to specify the tags at run time before our rake task.</p>
<div class="highlight"><pre><span class="nv">tag</span><span class="o">=</span><span class="s1">'depth:shallow'</span> rake <span class="nb">local</span>:firefox
</pre></div><h2>Part 2: Reporting</h2>

<p>In order to make our test output useful for a CI Server we need to generate it in a standard way. One format that works across most CI Servers is JUnit XML.</p>
<h3>An Example</h3>

<p>This functionality doesn't come built into RSpec, but it's simple enough to add through the use of a third-party library. There are plenty to choose from, but we'll go with <a href="https://github.com/sj26/rspec_junit_formatter">'rspec_junit_formatter'</a>.</p>

<p>After we install it we need to specify the formatter type and an output file for RSpec to consume. This is done through the use of two new arguments; <code>--format RspecJunitFormatter</code> and <code>--out results.xml</code>. But in order to use them we need to create a uniquely named XML output file for each test process. To accomplish that with <code>parallel_tests</code> we will need to take advantage of another feature in RSpec -- the <code>.rspec</code> file.</p>

<p>RSpec comes with the ability to place command arguments in a <code>.rspec</code> file within the root directory of our project, which will automatically be consumed at runtime. So we'll place our new arguments there, and use a kind of interpolation to inject an environment variable from <code>parallel_tests</code> which will be unique for each test process.</p>

<p>We're doing this instead of adding it to the <code>launch_in_parallel</code> method in our 'Rakefile' because of how parallel_tests handles execution. In order to get dynamically named XML output, we have to use the <code>.rspec</code> file. And we don't want our XML output to happen all the time. So let's make it conditional based on a new environment variable.</p>
<div class="highlight"><pre><span class="x"># filename: .rspec</span>

<span class="cp">&lt;%</span> <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'ci'</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'on'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">--format RspecJunitFormatter</span>
<span class="x">--out tmp/result</span><span class="cp">&lt;%=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'TEST_ENV_NUMBER'</span><span class="o">]</span> <span class="cp">%&gt;</span><span class="x">.xml</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div>
<p>Now when we run our tests with the new environment variable set to 'on' (e.g., <code>ci='on' rake local:firefox</code>), each test process creates it's own result.xml by number (e.g., result.xml, result2.xml, etc.), and ends up in a <code>tmp</code> directory (<code>tmp</code> being short for temporary).</p>

<p>After a test run our directory structure should look like this:</p>
<div class="highlight"><pre>.
<span class="p">|</span>-- config
<span class="p">|</span>   <span class="p">|</span>-- cloud.rb
<span class="p">|</span>   <span class="sb">`</span>-- local.rb
<span class="p">|</span>-- .gitignore
<span class="p">|</span>-- pages
<span class="p">|</span>   <span class="p">|</span>-- base_page.rb
<span class="p">|</span>   <span class="p">|</span>-- dynamic_loading.rb
<span class="p">|</span>   <span class="sb">`</span>-- login.rb
<span class="p">|</span>-- Rakefile
<span class="p">|</span>-- .rspec
<span class="p">|</span>-- spec
<span class="p">|</span>   <span class="p">|</span>-- dynamic_loading_spec.rb
<span class="p">|</span>   <span class="p">|</span>-- login_spec.rb
<span class="p">|</span>   <span class="sb">`</span>-- spec_helper.rb
<span class="p">|</span>-- tmp
<span class="p">|</span>   <span class="p">|</span>-- result2.xml
<span class="p">|</span>   <span class="sb">`</span>-- result.xml
<span class="sb">`</span>-- vendor
    <span class="p">|</span>-- chromedriver
    <span class="sb">`</span>-- the-internet
</pre></div>
<p>If we open one of the XML files from the <code>tmp</code> directory, it will contain a bunch of info from the test run. This is what our CI server will use to track test results (e.g., passes, failures, time to complete, etc.) and trend them over time.</p>

<p>Here's what one from a passing run looks like:</p>
<div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;testsuite</span> <span class="na">tests=</span><span class="s">&quot;2&quot;</span> <span class="na">failures=</span><span class="s">&quot;0&quot;</span> <span class="na">errors=</span><span class="s">&quot;0&quot;</span> <span class="na">time=</span><span class="s">&quot;20.104438&quot;</span> <span class="na">timestamp=</span><span class="s">&quot;2014-02-01T19:22:05+00:00&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;properties/&gt;</span>
  <span class="nt">&lt;testcase</span> <span class="na">classname=</span><span class="s">&quot;spec.dynamic_loading_spec&quot;</span> <span class="na">name=</span><span class="s">&quot;Dynamic Loading Example 1: Hidden Element&quot;</span> <span class="na">time=</span><span class="s">&quot;10.926016&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;testcase</span> <span class="na">classname=</span><span class="s">&quot;spec.dynamic_loading_spec&quot;</span> <span class="na">name=</span><span class="s">&quot;Dynamic Loading Example 2: Rendered after the fact&quot;</span> <span class="na">time=</span><span class="s">&quot;9.177722&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/testsuite&gt;</span>
</pre></div>
<p>We don't want to commit the <code>tmp</code> directory or the XML files our repository, so let's make sure to add them to our ignore file.</p>
<div class="highlight"><pre><span class="err">#</span><span class="w"> </span><span class="nl">filename:</span><span class="w"> </span><span class="o">.</span><span class="vg">gitignore</span>

<span class="o">*.</span><span class="vg">log</span>
<span class="vg">tmp</span><span class="o">/</span>
</pre></div>
<p>We're almost ready to wire things up to our CI Server, but before we do, we want to customize the failure messages in our tests.</p>
<h2>Part 3: Custom Failure Messaging</h2>

<p>If we leave things as they are, we will receive messages that say 'expected true but got false' with no easy way to correlate the CI failure to the Sauce Labs job that it ran in -- which makes it hard to discern if the test failure was legitimate and painful to run down the real issue. Let's remedy that now.</p>
<h3>An Example</h3>
<div class="highlight"><pre><span class="c1"># filename: spec/spec_helper.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="n">require_relative</span> <span class="s1">'support/matchers'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="o">.</span><span class="n">.</span><span class="o">.</span>

    <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'host'</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'saucelabs'</span>
      <span class="vg">$job_message</span> <span class="o">=</span> <span class="s2">&quot;Watch a video of the test at https://saucelabs.com/tests/</span><span class="si">#{</span><span class="vi">@driver</span><span class="o">.</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span>
      <span class="vg">$job_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>
<p>First, we require a new file (which we need to create). It will contain our custom failure message (a.k.a. a custom matcher).</p>

<p>Next, in the <code>config.before(:each)</code> section of our <code>spec_helper</code>, just after the <code>@driver</code> has been instantiated, we add a conditional to set a global variable based on where the tests are being run. If Sauce Labs, then we create a message that includes the URL for the job being run. Otherwise, we set the message to be blank. Having the logic here means we only have to define it once, and can keep it out of our custom matchers.</p>

<p>In RSpec, we can create our own matchers (just like <code>be_true</code>). In them, we can specify custom failure messages. This is where we will take advantage of the <code>$job_message</code> variable.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/support/matchers.rb</span>

<span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span><span class="o">.</span><span class="n">define</span> <span class="ss">:be_displayed</span> <span class="k">do</span> <span class="o">|</span><span class="n">expected</span><span class="o">|</span>

  <span class="n">match</span> <span class="k">do</span> <span class="o">|</span><span class="n">actual</span><span class="o">|</span>
    <span class="n">actual</span> <span class="o">==</span> <span class="kp">true</span>
  <span class="k">end</span>

  <span class="n">failure_message_for_should</span> <span class="k">do</span> <span class="o">|</span><span class="n">actual</span><span class="o">|</span>
    <span class="s2">&quot;Expected element to display, but it didn't. </span><span class="si">#{</span><span class="vg">$job_message</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>

  <span class="n">failure_message_for_should_not</span> <span class="k">do</span> <span class="o">|</span><span class="n">actual</span><span class="o">|</span>
    <span class="s2">&quot;Expected element to NOT display, but it did. </span><span class="si">#{</span><span class="vg">$job_message</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>We create a new <code>support</code> directory within our <code>spec</code> directory and add a <code>matchers.rb</code> file to hold our new <code>be_displayed</code> matcher. In our custom matcher we are doing 3 things:</p>

<ol>
<li>Performing a comparison against the value being provided by our tests</li>
<li>Setting the custom failure message for the <code>.should</code> case</li>
<li>Setting the custom failure message for the <code>.should_not</code> case</li>
</ol>

<p>In the custom failure messages, we are consuming the global variable that we created in our <code>spec_helper</code> file. For more info on custom matchers, check out <a href="https://github.com/dchelimsky/rspec/wiki/Custom-Matchers">the write-up for them on the RSpec wiki</a>.</p>

<p>Now we need to update our tests to use these matchers (replacing <code>be_true</code> with <code>be_displayed</code>).</p>
<div class="highlight"><pre><span class="c1"># filename: spec/dynamic_loading_spec.rb</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="n">it</span> <span class="s1">'Example 1: Hidden Element'</span> <span class="k">do</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">example</span> <span class="mi">1</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">start</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">finish_text?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_displayed</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'Example 2: Rendered after the fact'</span> <span class="k">do</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">example</span> <span class="mi">2</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">start</span>
    <span class="vi">@dynamic_loading</span><span class="o">.</span><span class="n">finish_text?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_displayed</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: spec/login_spec.rb</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="n">it</span> <span class="s1">'succeeded'</span> <span class="k">do</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s1">'tomsmith'</span><span class="p">,</span> <span class="s1">'SuperSecretPassword!'</span><span class="p">)</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">success_message?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_displayed</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'failed'</span> <span class="k">do</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s1">'asdf'</span><span class="p">,</span> <span class="s1">'asdf'</span><span class="p">)</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">failure_message?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_displayed</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'forced failure'</span> <span class="k">do</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s1">'asdf'</span><span class="p">,</span> <span class="s1">'asdf'</span><span class="p">)</span>
    <span class="vi">@login</span><span class="o">.</span><span class="n">failure_message?</span><span class="o">.</span><span class="n">should_not</span> <span class="n">be_displayed</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>Notice that the assertion helper methods used in our assertions have been shortened. This was done so that the tests read more intelligibly. We still want to keep the question mark though since it signifies that a boolean result is being returned.</p>

<p>Also, we added a new test in <code>login_spec.rb</code> titled <code>'forced failured'</code>. This helps us see what the failure output will look like.</p>

<p>All that's left to do now is update the page objects so our methods match our tests.</p>
<div class="highlight"><pre><span class="c1"># filename: pages/dynamic_loading.rb</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>

  <span class="k">def</span> <span class="nf">finish_text?</span>
    <span class="n">wait_for</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span> <span class="n">is_displayed?</span> <span class="no">FINISH_TEXT</span> <span class="p">}</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><div class="highlight"><pre><span class="c1"># filename: pages/login.rb</span>

  <span class="k">def</span> <span class="nf">success_message?</span>
    <span class="n">is_displayed?</span> <span class="no">SUCCESS_MESSAGE</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">failure_message?</span>
    <span class="n">is_displayed?</span> <span class="no">FAILURE_MESSAGE</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>Now when we run our test suite and a test fails, it will read with a helpful failure message, and a link to the Sauce Labs job.</p>

<blockquote>
<p>Expected element to NOT display, but it did. Watch a video of the test at https://saucelabs.com/tests/8b075a49cb20477f9aa820de4d196ac5</p>
</blockquote>

<p>If we want to add another matcher, it's simple enough to do. You can see a more comprehensive set of matchers that use this approach <a href="https://gist.github.com/tourdedave/cd4ef3c53be4715e57b9">here</a>.</p>

<p>Now we're ready to wire things up to our CI server.</p>
<h2>Part 4: CI Server Job Configuration</h2>

<p>The first thing we need to do (assuming you already have a CI Server setup) is create a job, name it appropriately (e.g., 'Shallow Tests IE8'), and configure it to meet the needs of you and your team.</p>

<p>If your team already uses CI and has a job that runs unit or integration tests, you can configure your job to key off of that one (e.g., if the unit tests pass, then run your shallow tests). This is ideal since their job is part of their workflow (e.g., it triggers every time code is pushed to the mainline), or there is some kind of time delayed polling (e.g., see if new code was pushed every 5 minutes). This means code is compiled and tests are run often.</p>

<p>Depending on the application you're testing, there may need to be an intermediate action that involves deploying code to a test environment which has test data. But by keying your job off of theirs, you are plugging your test suite directly into the development workflow. This is why running shallow tests to start is important -- we want only fast and critical tests to run to make sure they are providing valuable results.</p>

<p>If this is not how things are set up, then look to set up a job that polls the development codebase so that your tests can be triggered when there are code changes pushed by developers (e.g., with <a href="http://git-scm.com/book/ch7-3.html#Server-Side-Hooks">post-receive hooks</a> or <a href="http://brknthmb.com/post/75173073594/jenkins-using-the-github-pull-request-builder-plugin">on every pull request</a>).</p>

<p>Alternatively, you can set up scheduled runs for different times of the day or week. They're less ideal, and better suited for long running jobs during off-hours.</p>

<p>Let's step through an example showing you how to set up a job with <a href="http://jenkins-ci.org">Jenkins</a>.</p>
<h2>An Example</h2>

<p>Jenkins can be set up on your own server or through a hosted offering like <a href="http://www.cloudbees.com/jenkins">CloudBees</a>. Once you have it set up with Ruby on the system (which is the default with CloudBees), you just need to install some plugins and set up a job.</p>

<p>In your job you can configure where to pull your tests from and when to run them.</p>

<p>Let's set up a job for our tests (pulling them in from a GitHub repository) and make them run after another job (e.g., a development build) completes successfully.</p>
<h3>Installing Plugins</h3>

<ol>
<li>From the Dashboard, click on <code>Manage Jenkins</code></li>
<li>Then click on <code>Manage Plugins</code></li>
<li>Once the Manage Plugins menu loads, click on the <code>Available</code> tab</li>
<li>In the top-right is a search field (labeled <code>filter</code>) -- input the name of what you want to install</li>
<li>In the list of plugins, find the one you want, and check the box to the left of its name</li>
<li>Click <code>Install without restart</code> at the bottom of the screen</li>
<li>On the next screen, check the box that says <code>Restart Jenkins when installation is complete and no jobs are running</code></li>
</ol>

<p>You should see a series of screens saying <code>Please wait while Jenkins is restarting</code> and <code>Please wait while Jenkins is getting ready to work</code>. When it's done, you'll be dropped back to the dashboard.</p>
<h3>Setting Up Your Test Job</h3>
<h4>Step 1: Create A Job</h4>

<ol>
<li>Click <code>New Job</code> from the top-left of the Dashboard</li>
<li>Give it a name (e.g., 'Shallow Tests IE8')</li>
<li>Select the <code>Build a free-style software project</code> option</li>
<li>Click <code>OK</code></li>
</ol>

<p><img src="http://davehaeffner.com/selenium-guidebook/book-images/jenkins/1-job-setup/1-new-project.png" alt="jenkins new job"></p>

<p>This will take you to the configuration menu for the job you just created.</p>
<h4>Step 2: Pull In Your Test Code</h4>

<ol>
<li>Scroll down to the <code>Source Code Management</code> section</li>
<li>Select the 'Git' option</li>
<li>Input the Repository URL (e.g., <code>git@github.com:tourdedave/selenium-guidebook-example.git</code>)</li>
<li>Specify the branch (e.g, <code>origin/master</code>)</li>
</ol>

<p><img src="http://davehaeffner.com/selenium-guidebook/book-images/jenkins/1-job-setup/2-git.png" alt="jenkins job config for git"></p>

<p>In order to use a private repository (like the example above) you need to set up deploy keys in GitHub. You can read more about that <a href="https://help.github.com/articles/generating-ssh-keys">here</a>.</p>
<h4>Step 3: Set up Build Triggers</h4>

<ol>
<li>Scroll down to the <code>Build Triggers</code> section</li>
<li>Check <code>Build after other projects are built</code></li>
<li>Input the name of the development project you want to key off of (e.g. 'the-internet develop')</li>
</ol>

<p><img src="http://davehaeffner.com/selenium-guidebook/book-images/jenkins/1-job-setup/3-build-triggers.png" alt="jenkins job config for build triggers"></p>
<h4>Step 4: Build</h4>

<ol>
<li>Scroll down to the <code>Build</code> section</li>
<li>Click on <code>Add Build Step</code> and select <code>Execute Shell</code></li>
<li>In the <code>Command</code> input box, add the following commands:</li>
</ol>
<div class="highlight"><pre>gem install bundler
bundle install
<span class="nv">ci</span><span class="o">=</span><span class="s1">'on'</span> rake cloud:ie<span class="o">[</span><span class="s1">'Windows XP'</span>,<span class="s1">'8'</span><span class="o">]</span>
</pre></div>
<p><img src="http://davehaeffner.com/selenium-guidebook/book-images/jenkins/1-job-setup/5-execute-shell.png" alt="jenkins job config for running the build"></p>

<p>Since our tests have never run on this server, it's best to include the installation of the bundler gem (<code>gem install bundler</code>), running bundler to pull in our test suite's gems (<code>bundle install</code>), and then launching the test suite.</p>
<h4>Step 5: Configure Test Reports</h4>

<ol>
<li>Scroll down to the <code>Post-build Actions</code> section</li>
<li>Click on <code>Add post-build action</code></li>
<li>Select <code>Publish JUnit test result report</code></li>
<li>In the <code>Test report XMLs</code> input box, type <code>tmp/result*.xml</code></li>
<li>Click <code>Save</code></li>
</ol>

<p><img src="http://davehaeffner.com/selenium-guidebook/book-images/jenkins/1-job-setup/7-test-results-config.png" alt="jenkins job config for consuming the xml test results"></p>

<p>After you click <code>Save</code> you will be taken to the job dashboard.</p>
<h4>Step 6: Run Tests &amp; View The Results</h4>

<ol>
<li>Click <code>Build Now</code> from the menu on the left</li>
<li>Once the build completes, click on <code>Latest Test Result</code> (or, click on the build from <code>Build History</code> and then click <code>Test Result</code>)</li>
<li>Click on the failed test listed under <code>All Failed Tests</code></li>
</ol>

<p>You should see an error message that states why the test failed along with a link to the job in Sauce Labs. Click the link if you want to watch a video of the failed test.</p>

<p><img src="http://davehaeffner.com/selenium-guidebook/book-images/jenkins/2-job-report/3-test-result.png" alt="jenkins job results"></p>
<h3>Notifications</h3>

<p>In order to make this job fully useful, we want to add notification to it. There are numerous ways to go about notifying team-members of failed builds (e.g., e-mail, chat, text, co-located visual cues, etc). Let's step through setting up a simple chat notification with HipChat.</p>
<h4>Step 1: System Setup</h4>

<ol>
<li>Install the HipChat Jenkins Plugin</li>
<li>Click on <code>Manage Jenkins</code> from the main dashboard</li>
<li>Click on <code>Configure System</code></li>
<li>Scroll down to <code>Global HipChat Notifier Settings</code></li>
<li>Input your HipChat API Token into the <code>API Token</code> input field (which you can get from your Admin API Tokens page)</li>
<li>Input the chat room you would like to send the notifications to in the <code>Room</code> input field (this can be the name of the room (case-sensitive) or the ID of the room)</li>
<li>Input the URL of your Jenkins server into the <code>Jenkins URL</code> input field (this will be used in the notifications)</li>
<li>Click <code>Save</code></li>
</ol>

<p>This will take you back to the main dashboard page.</p>
<h4>Step 2: Configure Job Notifications</h4>

<ol>
<li>Click on the job you want to add chat notifications to (e.g., <code>Shallow Tests IE8</code>)</li>
<li>Click <code>Configure</code> (along the left side menu)</li>
<li>Scroll down to <code>Post-build Actions</code></li>
<li>Click <code>Add post-build action</code></li>
<li>Select <code>HipChat Notifications</code></li>
<li>Click <code>Save</code></li>
</ol>

<p>Now when your tests run (either by manually triggering them, or from being triggered by another job) you will receive the end-result in the chat room you specified.</p>

<p><img src="http://davehaeffner.com/selenium-guidebook/book-images/jenkins/3-notifications/hipchat-notification-received.png" alt="hipchat notification received"></p>

<p>The only unfortunate thing about this configuration is that it will send notifications for both test passes and test failures regardless of the job's stability. So it may be a bit too noisy for your colleagues. If that's the case, then consider looking into e-mail notifications (which are also available in the <code>Post-build Actions</code> section).</p>
<h2>Closing Thoughts</h2>

<p>By using a CI Server you're able to put your tests to work by using computers for what they're good at -- freeing you up to focus on more important things. Keep in mind that there are numerous ways to configure your CI server. Be sure to find what works best for you and your team by testing and learning from a couple of different configurations. It's well worth the effort.</p>
<h1 id="chapter17"><small>Chapter 17</small><br>Things You will See And How To Work With Them</h1>

<p>The examples in this section aim to give you a glimpse at things you will see in the wild, and a reference for to deal with them.</p>

<p>They will not build upon previous examples like the earlier parts of this book. But instead, serve as standalone works that can be consumed individually -- and alphabetically.</p>

<p>Enjoy!</p>
<h1 id="chapter17_1"><small>Chapter 17.1</small><br>A/B Testing</h1>

<p>Sometimes when running tests you may hit unexpected behavior due to <a href="http://en.wikipedia.org/wiki/A/B_testing">A/B testing</a> being done in the application you're working with.</p>

<p>In order to keep your tests running without issue we need a clean way to opt-out of these tests.</p>

<p>The standard opt-out behavior we have seen with A/B testing platforms (both commercial and custom) tends to be either an appended URL that you can pass in when navigating to a page (e.g., '?optimizely<em>opt</em>out=true') or forging a cookie (or some combination of the two).</p>
<h2>An Example</h2>

<p>For this example we are going to demonstrate how to opt-out of a page that is controlled by Optimizely (a popular A/B Testing platform) by forging a cookie.</p>

<p>On our example page, the heading text will change based on which test group we are place in.</p>

<p>You can see the example application we are testing <a href="http://the-internet.herokuapp.com/abtest">here</a>.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>We start off the example by loading our libraries and preparing our setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/abtest'</span>
  <span class="n">heading_text</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">heading_text</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'A/B Test Control'</span><span class="p">)</span> <span class="o">||</span>
    <span class="n">heading_text</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'A/B Test Variation 1'</span><span class="p">)</span>
  <span class="n">result</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">add_cookie</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">'optimizelyOptOut'</span><span class="p">,</span> <span class="ss">value</span><span class="p">:</span> <span class="s1">'true'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">navigate</span><span class="o">.</span><span class="n">refresh</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'No A/B Test'</span>
<span class="k">end</span>
</pre></div>
<p>In our run action we navigate to the page we want to test. We confirm that we are in one of the A/B test cells by grabbing the heading text and seeing if it includes the proper content.</p>

<p>After that we add the opt-out cookie, refresh the page, and then confirm that we are no longer in the A/B test cells (again, by confirming that the heading text has changed).</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">add_cookie</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">'optimizelyOptOut'</span><span class="p">,</span> <span class="ss">value</span><span class="p">:</span> <span class="s1">'true'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/abtest'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'No A/B Test'</span>
<span class="k">end</span>
</pre></div>
<p>Alternatively we can go to the main page of the site first, add the opt-out cookie, and then navigate to the page of interest &amp; perform our checks.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load a page on the site</li>
<li>Add the opt-out cookie</li>
<li>Access the page of interest</li>
<li>Assert that the header text is correct</li>
</ul>
<h1 id="chapter17_2"><small>Chapter 17.2</small><br>Basic Auth</h1>

<p>On some occasions you may work with apps that are secured with <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">Basic HTTP Authentication</a>. And in order to access them you will need to pass credentials to the server when requesting a page.</p>

<p>Before Selenium 2 we were able to accomplish this by injecting credentials into a custom header, but now the cool kid way is to use something like <a href="http://bmp.lightbody.net/">BrowserMob Proxy</a>. And some people are solving this with browser specific configurations.</p>

<p>But all of this feels heavy. Instead, let's look at a simple approach that is browser agnostic.</p>
<h2>An Example</h2>

<p>We can simply pass in the username and password in the URL that we are requesting (for both HTTP or HTTPS). Let's take a look at an example.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>We start off by requiring our libraries and implementing setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://admin:admin@the-internet.herokuapp.com/basic_auth'</span>
  <span class="n">page_message</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'p'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">page_message</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/Congratulations!/</span>
<span class="k">end</span>
</pre></div>
<p>In the run action we are getting the page by passing in the username and password in the URL. Once it loads we grab text from the page, and make an assertion against it.</p>

<p>Alternatively, we could have accessed the page with credentials as part of the setup action and then accessed the page again (or any other HTTP page behind basic auth) <strong>without</strong> credentials.</p>

<p>Here's what that would look like.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://admin:admin@the-internet.herokuapp.com/basic_auth'</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/basic_auth'</span>
  <span class="n">page_message</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'p'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">page_message</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/Congratulations!/</span>
<span class="k">end</span>
</pre></div>
<p>NOTE: If your application serves both HTTP and HTTPS pages from behind basic auth then you will need to load one of each type before executing your test steps. Otherwise you will get authorization errors when switching between HTTP and HTTPS. This happens because the browser can't use basic auth credentials interchangeably (e.g., HTTP for HTTPS and vice versa).</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the HTTP and/or HTTPS page caching basic auth credentials</li>
<li>Load the page</li>
<li>Get the page text</li>
<li>Assert that it contains what it should</li>
</ul>
<h1 id="chapter17_3"><small>Chapter 17.3</small><br>Checkboxes</h1>

<p>Checkboxes, an often used element in web applications. But how do you work with them in your Selenium tests? Intuitively you may reach for a method that has the word 'checked' in it -- like <code>.checked?</code> or <code>.isChecked</code>. But this doesn't exist in Selenium. So how do you do it?</p>

<p>There are two ways to approach this -- through an element's 'checked' attribute (a.k.a. an attribute lookup), or by asking the element if it is selected.</p>

<p>Let's dig in with some examples.</p>
<h2>An Example</h2>

<p>Below is the markup from the page we will testing against. It is taken from <a href="http://the-internet.herokuapp.com/checkboxes">a checkboxes example</a> from <a href="https://github.com/tourdedave/the-internet">the-internet</a>.</p>
<div class="highlight"><pre><span class="nt">&lt;form&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span><span class="nt">&gt;</span> unchecked<span class="nt">&lt;br&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">checked=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span> checked
<span class="nt">&lt;/form&gt;</span>
</pre></div>
<p>We start our test off by pulling in the libraries we want to use (<code>selenium-webdriver</code> to drive the browser, and <code>rspec-expectations</code> &amp; <code>RSpec::Matchers</code> to perform our assertions). After that, we wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: checkboxes.rb</span>
<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>Before we write any assertions, let's walk through both checkbox approaches to see what they give us.</p>

<p>To do that we'll want to grab all of the checkboxes on the page, and iterate through them twice. Once using an attribute lookup, and another asking if the element is selected. Each time outputting the return value we get from Selenium.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/checkboxes'</span>
  <span class="n">checkboxes</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'input[type=&quot;checkbox&quot;]'</span><span class="p">)</span>

  <span class="nb">puts</span> <span class="s2">&quot;With .attribute('checked')&quot;</span>
  <span class="n">checkboxes</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">checkbox</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">checkbox</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'checked'</span><span class="p">)</span><span class="o">.</span><span class="n">inspect</span> <span class="p">}</span>

  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">With .selected?&quot;</span>
  <span class="n">checkboxes</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">checkbox</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">checkbox</span><span class="o">.</span><span class="n">selected?</span><span class="o">.</span><span class="n">inspect</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
<p>When we run it (e.g., <code>ruby checkboxes.rb</code>) , here's the output.</p>
<div class="highlight"><pre>With .attribute<span class="o">(</span><span class="s1">'checked'</span><span class="o">)</span>
nil
<span class="s2">&quot;true&quot;</span>

With .selected?
<span class="nb">false</span>
<span class="nb">true</span>
</pre></div>
<p>With the attribute lookup, we receive either a <code>nil</code> or a string with the value <code>&quot;true&quot;</code> depending on the state of the checkbox. Whereas with <code>.selected?</code> we get a boolean response.</p>

<p>NOTE: Alternatively, you could have looked at the documentation for <a href="http://selenium.googlecode.com/git/docs/api/rb/Selenium/WebDriver/Element.html#attribute-instance_method"><code>.attribute</code></a> and <a href="http://selenium.googlecode.com/git/docs/api/rb/Selenium/WebDriver/Element.html#selected%3F-instance_method"><code>.selected?</code></a> to learn about this behavior. But it's nice to see it in action.</p>

<p>Let's see what these approaches look like when used to confirm that a checked checkbox is indeed checked.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/checkboxes'</span>
  <span class="n">checkboxes</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'input[type=&quot;checkbox&quot;]'</span><span class="p">)</span>
  <span class="n">checkboxes</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'checked'</span><span class="p">)</span><span class="o">.</span><span class="n">should_not</span> <span class="n">be_nil</span>
<span class="k">end</span>
</pre></div>
<p>With an attribute lookup, the simplest thing to do is to assert that the return value is not nil. While it works, it feels a bit off. Let's see what the other approach looks like.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/checkboxes'</span>
  <span class="n">checkboxes</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'input[type=&quot;checkbox&quot;]'</span><span class="p">)</span>
  <span class="n">checkboxes</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">selected?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
<span class="k">end</span>
</pre></div>
<p>This approach is much more understandable, and feels a bit more organic -- simply checking to see if the element has been selected.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Find all of the checkboxes</li>
<li>Assert that the last checkbox (the one that is supposed to be checked) is checked</li>
</ul>
<h2>Outro</h2>

<p>Attribute lookups are built for pulling information out of the page for review. While they work in this circumstance, you're probably better off reaching for <code>.selected?</code>.</p>
<h1 id="chapter17_4"><small>Chapter 17.4</small><br>Drag And Drop</h1>

<p>Exercising a page's dragging and dropping functionality used to be simple with <a href="http://selenium.googlecode.com/svn/trunk/docs/api/rb/Selenium/WebDriver/ActionBuilder.html">Selenium's Action Builder</a>, but sadly, <a href="https://code.google.com/p/selenium/issues/detail?id=6315">it won't work with HTML5 drag and drop</a>.</p>

<p>As a workaround we can simulate dragging and dropping by executing JavaScript with Selenium. Let's dig in with an example.</p>
<h2>An Example</h2>

<p>You can see a simple HTML5 drag and drop example <a href="http://the-internet.herokuapp.com/drag_and_drop">here on the-internet</a>.</p>

<p>First, let's borrow <a href="https://gist.github.com/rcorreia/2362544">the JavaScript made available by rcorreia on GitHub</a> for this workaround and store it in a local file (e.g., <code>dnd.js</code>).</p>

<p>Now we can create a Selenium script to consume the JavaScript file, visit the page, execute the JavaScript, and perform an assertion.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>After including our dependent libraries, we wire up our <code>setup</code>, <code>teardown</code>, and <code>run</code> actions. Now we're ready to write our test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s2">&quot;http://the-internet.herokuapp.com/drag_and_drop&quot;</span>

  <span class="n">dnd_javascript</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span> <span class="o">+</span> <span class="s1">'/dnd.js'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">dnd_javascript</span><span class="o">+</span><span class="s2">&quot;$('#column-a').simulateDragDrop({ dropTarget: '#column-b'});&quot;</span><span class="p">)</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'column-a'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'B'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'column-b'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'A'</span>
<span class="k">end</span>
</pre></div>
<p>After loading the page we read in the <code>dnd.js</code> file and store it in a local variable. We then use Selenium to execute <code>dnd_javascript</code> along with the function calls and elements we want to work with. After that, it's just a simple matter of grabbing text from the page and making an assertion against it.</p>

<p>Since there are only two elements to drag and drop on the page, they should have switched places. So, <code>column-a</code> should now contain the text 'B', and <code>column-b</code> should contain the text 'A'.</p>
<h1 id="chapter17_5"><small>Chapter 17.5</small><br>Dropdown Lists</h1>

<p>Selecting from a dropdown list <em>seems</em> like one of those simple things. Just grab the list by its element and select one of its items based on the text you want.</p>

<p>While it sounds pretty straightforward, there is a bit more finessing to it than you may realize.</p>

<p>Let's take a look at a couple of different approaches.</p>
<h2>An Example</h2>

<p>NOTE: You can see the example app we are using to test <a href="http://the-internet.herokuapp.com/dropdown">here</a></p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>First we load our libraries and wire up our setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dropdown'</span>
  <span class="n">drop_down_list</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'dropdown'</span><span class="p">)</span>

  <span class="n">options</span> <span class="o">=</span> <span class="n">drop_down_list</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">tag_name</span><span class="p">:</span> <span class="s1">'option'</span><span class="p">)</span>
  <span class="n">options</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">option</span><span class="o">|</span> <span class="n">option</span><span class="o">.</span><span class="n">click</span> <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">'Option 1'</span> <span class="p">}</span>

  <span class="n">selected_option</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">option</span><span class="o">|</span> <span class="n">option</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">selected?</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span>
  <span class="n">selected_option</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'Option 1'</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
<span class="p">}</span>
</pre></div>
<p>Next we go to our example application, find the dropdown list by its ID, and store it in a variable. From this variable we are able to tease out all of its available options to click on -- storing them in a variable as well.</p>

<p>Grabbing the list's options returns a collection that we then iterate over. When the text matches what we want, we click on it.</p>

<p>And to polish things off, we check to see if our selection was made correctly by reiterating over the dropdown options collection, getting the text of the one that was selected, returning its text, storing it in a variable, and making an assertion against it.</p>

<p>While this works, there is a simpler, built-in way to do this within Selenium. Let's give that a go.</p>
<h2>A Far Better Example</h2>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dropdown'</span>

  <span class="n">dropdown</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'dropdown'</span><span class="p">)</span>
  <span class="n">select_list</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Support</span><span class="o">::</span><span class="no">Select</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">dropdown</span><span class="p">)</span>
  <span class="n">select_list</span><span class="o">.</span><span class="n">select_by</span><span class="p">(</span><span class="ss">:text</span><span class="p">,</span> <span class="s2">&quot;Option 1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>Similar to the first example, we are finding the dropdown list by ID. But instead of iterating over it and clicking based on a conditional, we are leveraging a built-in helper function of Selenium, <a href="http://selenium.googlecode.com/svn-history/r15117/trunk/docs/api/rb/Selenium/WebDriver/Support/Select.html">Select</a>, and its <a href="http://selenium.googlecode.com/svn-history/r15117/trunk/docs/api/rb/Selenium/WebDriver/Support/Select.html#select_by-instance_method">select_by</a> action.</p>

<p>In addition to selecting by text, we can also select by value. Like so...</p>
<div class="highlight"><pre>  <span class="n">select_list</span><span class="o">.</span><span class="n">select_by</span><span class="p">(</span><span class="ss">:value</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
</pre></div><h2>Expected Behavior</h2>

<p>Under the hood both of these approaches follow the same basic behavior:</p>

<ul>
<li>Load the page</li>
<li>Find the dropdown list</li>
<li>Grab all elements in the list</li>
<li>Iterate through them</li>
<li>Click on the one that matches what we want</li>
</ul>
<h1 id="chapter17_6"><small>Chapter 17.6</small><br>File Download (Browser Agnostic)</h1>

<p>While downloading files with a custom browser configuration works it is not portable from browser to browser.</p>

<p>And ultimately we shouldn't care if the browser can download something or not. Instead we should care that the file was downloaded and that it is of the correct type and size -- a subtle but important distinction.</p>

<p>Alongside our Selenium actions we can leverage an HTTP library to initiate a download and inspect the response header to confirm it is what we expect. And all this without actually downloading the file to disk. Such an approach enables us to keep with Selenium, but decouples us from a browser specific configuration.</p>

<p>Let's dig with an example.</p>
<h2>An Example</h2>

<p>In the first part of this example we take care of including our third-party libraries and setting up some helper methods (e.g., setup, teardown, and run).</p>

<p>The only thing that is different from most of our previous examples is that we have included the <code>rest-client</code> gem to handle the mechanics of our HTTP interactions for downloading files and viewing their response headers.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="nb">require</span> <span class="s1">'rest-client'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>In our run acton we use Selenium to load the page that has our download links and grab the URL for the first one listed.</p>

<p>We then use the <code>rest-client</code> gem to initiate the download and store its response into a variable called <code>response</code>.</p>

<p>From this object we are able to access the headers and perform checks against it. Primarily focusing on the <code>content_type</code> and <code>content_length</code> portions. For this example we are confirming that the file to be downloaded is an <code>image/jpeg</code> and that its contents are not empty.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/download'</span>
  <span class="n">link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="no">RestClient</span><span class="o">.</span><span class="n">get</span> <span class="n">link</span>
  <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_type</span><span class="o">].</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'image/jpeg'</span>
  <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_length</span><span class="o">].</span><span class="n">to_i</span><span class="o">.</span><span class="n">should</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div><h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Get the URL of the first download link</li>
<li>Perform a GET action against the URL with an HTTP library</li>
<li>Store the response</li>
<li>Assert that the file type is correct</li>
<li>Assert that the file is not empty</li>
</ul>
<h1 id="chapter17_7"><small>Chapter 17.7</small><br>File Download (Browser Specific)</h1>

<p>Just like with file uploads, we hit the same issue with downloading them -- a dialog box just out of Selenium's reach.</p>

<p>Conventional wisdom posits that automating file downloads may be a foolish endeavor since in addition to the dialog box problem it is a deep rabbit hole to fall down. But here is a reasonable approach that will get you there without too much fuss.</p>
<h2>A Solution</h2>

<p>We are going to side-step the dialog box by telling our browser to ignore it and specify a location where to automatically download files to. Depending on the file's type, we will need to provide some additional configuration -- overriding some sensible defaults.</p>

<p>Once the file is downloaded we will make a quick and dirty assertion on it to see that it exists and is not empty.</p>

<p>Let's dig in with an example in Ruby using Selenium WebDriver against <a href="http://the-internet.herokuapp.com/download">our test app</a>.</p>
<h2>An Example</h2>

<p>First we will include the requisite libraries and wire-up our setup, teardown, and run actions in helper methods.</p>

<p>We are using the selenium-webdriver gem so we can demonstrate the browser profile configuration inline. And rspec-expectations is for our assertion action.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@download_dir</span> <span class="o">=</span> <span class="s2">&quot;/Users/more/Desktop/tmp/</span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m%d%y_%H%M%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.download.folderList'</span><span class="o">]</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.download.dir'</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@download_dir</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.helperApps.neverAsk.saveToDisk'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'image/jpeg, application/pdf'</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'pdfjs.disabled'</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>

  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:profile</span> <span class="o">=&gt;</span> <span class="n">profile</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;rm -rf </span><span class="si">#{</span><span class="vi">@download_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>The setup method is where the magic is happening. In it we are creating an instance variable and setting it to an absolute path for the directory we would like to use (e.g., a uniquely named temp folder that exists on my Desktop). This will come in handy later when we need to access the downloaded file and make an assertion against it.</p>

<p>Next we create a Firefox profile object and ply it with some configuration parameters:</p>

<ul>
<li><strong>browser.download.folderList</strong> tells Firefox where to place its downloads. A 2 tells it to use a custom download path whereas a 1 is the browser's default path and a 0 is the Desktop.</li>
<li><strong>browser.download.dir</strong> is where we set the custom download path.</li>
<li><strong>browser.helperApps.neverAsk.saveToDisk</strong> tells Firefox when NOT to prompt us for a file download. It requires us to pass in a comma-separated string of MIME types that we care about. You can find a full list of MIME types <a href="http://www.webmaster-toolkit.com/mime-types.shtml">here</a>. For this example we have a PDF and JPG files to play with.</li>
<li><strong>pdfjs.disabled</strong> is for when downloading PDFs. This overrides the sensible default set in Firefox that previews them in the browser.</li>
</ul>

<p>After setting these bits we create an instance of Selenium WebDriver and pass in the now configured profile object.</p>

<p>Our teardown and run methods are pretty straightforward. Teardown quits the Selenium object when done and cleans up the temp directory with a system call. And we wrap everything up neatly into a single run method that we can pass a block of commands to.</p>

<p>Now that we have setup Firefox appropriately we move on to our Selenium and assertion actions.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/download'</span>
  <span class="n">download_link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span>
  <span class="n">download_link</span><span class="o">.</span><span class="n">click</span>

  <span class="n">downloaded_files</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@download_dir</span><span class="si">}</span><span class="s2">/**/*&quot;</span><span class="p">)</span>
  <span class="n">sorted_downloads</span> <span class="o">=</span> <span class="n">downloaded_files</span><span class="o">.</span><span class="n">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span> <span class="no">File</span><span class="o">.</span><span class="n">mtime</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="p">}</span>
  <span class="no">File</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sorted_downloads</span><span class="o">.</span><span class="n">last</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
<p>After loading the page we find the first link available and click it. Alternatively, we could have clicked the second link</p>
<div class="highlight"><pre>  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">click</span>
</pre></div>
<p>...or we could have clicked all of the links.</p>
<div class="highlight"><pre>  <span class="n">download_links</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span>
  <span class="n">download_links</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">download_link</span><span class="o">|</span>
    <span class="n">download_link</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="k">end</span>
</pre></div>
<p>All of these actions trigger an automatic download to the folder specified in setup. So we then check to see that a file is there and not empty.</p>

<p>This is done by getting a list of the files stored in the directory and sorting it from oldest to newest based on its modified date timestamp. This ensures that the last item in the list is the newest one.</p>

<p>Once we have it, we check its file size to make sure that it is greater than 0.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Find the first download link</li>
<li>Click it</li>
<li>Download the file to a specified location on disk without prompting</li>
<li>Check that the downloaded file is there and not empty</li>
</ul>
<h2>Outro</h2>

<p>It's worth noting that the same approach can be applied to some browsers (e.g., Chrome) with a slightly different setup configuration, but not others (e.g., Internet Explorer). This is why I prefer to leverage a browser agnostic approach.</p>
<h1 id="chapter17_8"><small>Chapter 17.8</small><br>File Upload</h1>

<p>Normally when interacting with forms to upload a file you're prompted with a dialog box that is just out of reach for Selenium.</p>

<p>In these cases, people tend to turn to a tool to drive the GUI, such as Auto-IT. While this helps solve short-term pain, it sets you up for long term hurt later by chaining you to a specific platform -- limiting your ability to effectively test different browser/OS combinations.</p>

<p>A work-around for this problem is to side-step the dialog box experience entirely, and rather, inject the path of the file you want to upload into the form element, and then submit the form.</p>

<p>Let's break down this approach with some example Ruby code using Selenium WebDriver Remote and an example file upload form.</p>
<h2>An Example</h2>

<p>You can see the application we are running against <a href="http://the-internet.herokuapp.com/upload">here</a>.</p>

<p>For our test script, first we'll include the requisite libraries and wire-up our setup and teardown actions in helper methods.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>
</pre></div>
<p>We are using the selenium-webdriver gem to drive the browser, and rspec-expectations for our assertion action (which is a subset of the RSpec library).</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/upload'</span>
  <span class="n">uploader</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'file-upload'</span><span class="p">)</span>
  <span class="n">uploader</span><span class="o">.</span><span class="n">send_keys</span> <span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span> <span class="o">+</span> <span class="s1">'/DaveHaeffner.jpg'</span>
  <span class="n">uploader</span><span class="o">.</span><span class="n">submit</span>

  <span class="n">uploaded_image</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'.example img'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'src'</span><span class="p">)</span>
  <span class="n">uploaded_image</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/DaveHaeffner.jpg/</span>
<span class="k">end</span>
</pre></div>
<p>We created a helper method called 'run' to easily call our setup and teardown actions without being overly verbose.</p>

<p>In our run block we are driving the test script using standard Selenium commands and ending things off with an RSpec assertion.</p>
<h2>Expected Behavior</h2>

<p>So the intended behavior is:</p>

<ul>
<li>Load the page</li>
<li>Grab the form element we want to work with</li>
<li>Inject the path to the file we want to upload</li>
<li>Submit the form</li>
<li>Grab the source path for the image once it renders in the browser</li>
<li>Check to see that the image path contains the proper filename</li>
</ul>
<h1 id="chapter17_9"><small>Chapter 17.9</small><br>Forgot Password</h1>

<p>Testing e-mail can be a tricky process. Especially when dealing with things like forgotten passwords. A lot of times, this functionality ends up being something that gets checked manually, or worse, overlooked until it ends up broken in production.</p>

<p>By leveraging a third-party library (like <a href="https://github.com/dcparker/ruby-gmail">gmail-ruby</a>) we can access a test e-mail account (e.g., Gmail) outside of the browser to get the info we need and then put it to use with Selenium.</p>

<p>Let's dig in with an example that uses <a href="http://the-internet.herokuapp.com/forgot_password">the forgot password example</a> on <a href="https://github.com/tourdedave/the-internet">the-internet</a>.</p>
<h2>An Example</h2>

<p>First up we include our dependent libraries and create some setup, teardown, and run methods.</p>
<div class="highlight"><pre><span class="c1"># filename: forgot_password_gmail.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>
<span class="nb">require</span> <span class="s1">'gmail'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>The forgot password e-mail should be received pretty quickly, but since we're dealing with a third-party, we'll want to build in some resiliency. To do that, let's create a simple mechanism to retry a specified number of times -- sleeping some seconds in between each attempt.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">try</span><span class="p">(</span><span class="n">number_of_times</span><span class="p">)</span>
  <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">item_of_interest</span> <span class="o">=</span> <span class="kp">false</span>
  <span class="k">until</span> <span class="n">item_of_interest</span> <span class="o">==</span> <span class="kp">true</span> <span class="o">||</span> <span class="n">count</span> <span class="o">==</span> <span class="n">number_of_times</span>
    <span class="n">item_of_interest</span> <span class="o">=</span> <span class="k">yield</span>
    <span class="nb">sleep</span> <span class="mi">10</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
<p>Now that we have that, we can wire up our test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="c1"># Part 1: Initiate the forgot password email process</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/forgot_password'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'email'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'EMAIL_USERNAME'</span><span class="o">]</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'form_submit'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="c1"># Part 2: Find the forgot password email from Gmail</span>
  <span class="n">gmail</span> <span class="o">=</span> <span class="no">Gmail</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'EMAIL_USERNAME'</span><span class="o">]</span><span class="p">,</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'EMAIL_PASSWORD'</span><span class="o">]</span><span class="p">)</span>
  <span class="n">try</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@email</span> <span class="o">=</span> <span class="n">gmail</span><span class="o">.</span><span class="n">inbox</span><span class="o">.</span><span class="n">emails</span><span class="p">(</span><span class="ss">:unread</span><span class="p">,</span> <span class="ss">from</span><span class="p">:</span> <span class="s1">'no-reply@the-internet.herokuapp.com'</span><span class="p">)</span><span class="o">.</span><span class="n">last</span> <span class="p">}</span>
  <span class="n">message_body</span> <span class="o">=</span> <span class="vi">@email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">raw_source</span>

  <span class="c1"># Part 3: Parse the message body for the URL, username, and password</span>
  <span class="n">url</span> <span class="o">=</span>  <span class="n">message_body</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/https?:\/\/[\S]+/</span><span class="p">)</span><span class="o">.</span><span class="n">last</span>
  <span class="n">username</span> <span class="o">=</span> <span class="n">message_body</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/username: (.*)$/</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">0</span><span class="o">].</span><span class="n">strip</span>
  <span class="n">password</span> <span class="o">=</span> <span class="n">message_body</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/password: (.*)$/</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">0</span><span class="o">].</span><span class="n">strip</span>

  <span class="c1"># Part 4: Visit the login page, log in with the retrieved credentials, and assert that it worked</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="n">url</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">username</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">password</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">current_url</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'/secure'</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
<span class="k">end</span>
</pre></div>
<p>When running this script you can pass in the Gmail account username and password at runtime (e.g., <code>EMAIL_USERNAME=youremail@gmail.com, EMAIL_PASSWORD=yourpassword ruby forgot_password_gmail.rb</code>)</p>

<p>If you have other things in an e-mail message you need to parse for and aren't sure of the regular expressions you need -- give <a href="http://rubular.com/">Rubular</a> a try.</p>
<h1 id="chapter17_10"><small>Chapter 17.10</small><br>Frames</h1>

<p>More often than not you'll run into a throwback relic of the front-end world -- in this case, frames. Rather than curse and spit when it comes to writing automated tests against them, there is a simple approach we can use to tap dance through them.</p>

<p>In order to access the elements within a frame we need to tell Selenium to switch to it.</p>

<p>Let's demonstrate this with a couple of test scripts.</p>
<h2>An Example</h2>

<p>Our general script setup is pretty straightforward. Nothing special -- just the standard setup, teardown, and run methods.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>Our first example demonstrates how to deal with nested frames. You can see the page we are testing against <a href="http://the-internet.herokuapp.com/frames">here</a>. But here is a simple representation of it:</p>
<div class="highlight"><pre><span class="p">|</span> - frameset
    <span class="p">|</span> - top frame
        <span class="p">|</span> - frameset
            <span class="p">|</span> - left
            <span class="p">|</span> - middle
            <span class="p">|</span> - right
    <span class="p">|</span> - bottom frame
</pre></div><div class="highlight"><pre><span class="c1"># Nested Frames</span>
<span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/frames'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="s1">'frame-top'</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="s1">'frame-middle'</span><span class="p">)</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'content'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/MIDDLE/</span>
<span class="p">}</span>
</pre></div>
<p>In order to get the text of the middle frame, we need to switch to it. But in order for Selenium to see it, we need to switch to the parent frame first, then the child frame.</p>

<p>Once we've done that, we are able to freely find the element we want and assert that the relevant text appears.</p>

<p>While this example helps illustrate the point of frame switching, it is not very practical. So here is a more likely use case you'll run into -- working with the TinyMCE Editor.</p>
<h2>Another Example</h2>

<p>You can find the page we are testing against <a href="http://the-internet.herokuapp.com/tinymce">here</a>.</p>
<div class="highlight"><pre><span class="c1"># Iframes</span>
<span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tinymce'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="s1">'mce_0_ifr'</span><span class="p">)</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'tinymce'</span><span class="p">)</span>
    <span class="n">before_text</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">text</span>
    <span class="n">editor</span><span class="o">.</span><span class="n">clear</span>
    <span class="n">editor</span><span class="o">.</span><span class="n">send_keys</span> <span class="s1">'Hello World!'</span>
    <span class="n">after_text</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">text</span>

  <span class="n">after_text</span><span class="o">.</span><span class="n">should_not</span> <span class="o">==</span> <span class="n">before_text</span>
<span class="p">}</span>
</pre></div>
<p>Once the page renders we switch into the TinyMCE frame. While the frame element does not have a <code>name</code> attribute it does have an <code>id</code>. This works just the same in the <code>switch_to.frame</code> call, so we use it.</p>

<p>Now that Selenium is properly scoped we are able to use the top-level id of the TinyMCE widget to:</p>

<ul>
<li>grab its text</li>
<li>clear its text</li>
<li>input new text</li>
<li>grab the altered text</li>
<li>assert that the before and after texts are not the same</li>
</ul>

<p>Keep in mind that if we need to access a part of the page outside of the frame we are currently in, then we will need to switch to it. For instance...</p>
<div class="highlight"><pre><span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">default_content</span>
<span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should_not</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</pre></div>
<p>This switches us back to the main page and enables us to assert that the heading on the page is there.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Switch to the frame you want</li>
<li>Find and take an action against an element</li>
<li>Switch to another frame or the main document if need-be</li>
<li>Assert that the desired outcome has occurred</li>
</ul>
<h1 id="chapter17_11"><small>Chapter 17.11</small><br>HTTP Status Codes</h1>

<p>There are times when you are testing a page (or numerous pages) and you want to verify that it responded correctly. A great way to handle this is by checking the HTTP Status Code that the browser received. But this functionality is not available in Selenium WebDriver.</p>

<p>But fear not because there is more than one way to fall down this deep rabbit hole.</p>

<p>The tried and true approach that Selenium Committers and Practitioners recommend is to use a proxy server. With it, we will be able to watch and manipulate network traffic between our tests and the application under test -- giving us access to a whole host of functionality that we wouldn't have otherwise had.</p>

<p>Let's step through an example using <a href="http://bmp.lightbody.net/">BrowserMob Proxy</a>.</p>
<h2>An Example</h2>

<p>First we have to download BrowserMob Proxy to our working directory (available on <a href="http://bmp.lightbody.net/">their website</a>). With that in hand, we are ready to wire up our script.  </p>

<p>At the top of the file we include the libraries we need -- <code>selenium-webdriver</code> to drive the browser, <code>rspec-expectations</code> for our assertions, and <code>browsermob/proxy</code> to use the proxy server. You can find more info on the <code>browsermob-proxy</code> gem we are using <a href="https://rubygems.org/gems/browsermob-proxy">here</a>.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="nb">require</span> <span class="s1">'browsermob/proxy'</span>
</pre></div>
<p>Next we create a <code>configure_proxy</code> method to prepare the proxy for use with Selenium. In it we start the proxy server and create a configurable instance of it. We then create a browser profile (Firefox in this case) and set it to use the proxy server.  </p>

<p>Once that's done, we wire up the <code>configure_proxy</code> method into the setup action, and pass in the profile object to our Selenium instance.  </p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">configure_proxy</span>
  <span class="n">server</span> <span class="o">=</span> <span class="no">BrowserMob</span><span class="o">::</span><span class="no">Proxy</span><span class="o">::</span><span class="no">Server</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'./browsermob-proxy/bin/browsermob-proxy'</span><span class="p">)</span>
  <span class="n">server</span><span class="o">.</span><span class="n">start</span>
  <span class="vi">@proxy</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">create_proxy</span>
  <span class="vi">@profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="vi">@profile</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="vi">@proxy</span><span class="o">.</span><span class="n">selenium_proxy</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="n">configure_proxy</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:profile</span> <span class="o">=&gt;</span> <span class="vi">@profile</span>
<span class="k">end</span>
</pre></div>
<p>After that, we wire up our teardown and run actions.  </p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">close</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>And to make things clean we wrap up our proxy calls to get the status code from the <a href="http://www.softwareishard.com/blog/har-12-spec/">HTTP Archive</a> (a.k.a. HAR) in a <code>visit</code> action that returns it after it visits the page.  </p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">new_har</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="n">url</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">har</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status</span>
<span class="k">end</span>
</pre></div>
<p>All that's left is our run action, which is simple and to the point.  </p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="n">status_code</span> <span class="o">=</span> <span class="n">visit</span> <span class="s1">'http://the-internet.herokuapp.com/status_codes/404'</span>
  <span class="n">status_code</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">404</span>
<span class="k">end</span>
</pre></div><h2>Expected Behavior</h2>

<ul>
<li>Visit the URL</li>
<li>Retrieve the HTTP Status Code</li>
<li>Assert that it is the correct status code</li>
</ul>
<h2>Outro</h2>

<p>This was inspired by <a href="https://twitter.com/jimevansmusic">Jim Evans</a>' multi-part blog post series on doing the same thing in C# with Fiddler (<a href="http://jimevansmusic.blogspot.com/2013/08/implementing-webdriver-http-status.html">1</a>, <a href="http://jimevansmusic.blogspot.com/2013/08/implementing-http-status-codes-in.html">2</a>, <a href="http://jimevansmusic.blogspot.com/2013/08/implementing-http-status-codes-in_17.html">3</a>) which was in response to <a href="https://code.google.com/p/selenium/issues/detail?id=141">Selenium Issue 141</a>. Thanks Jim!</p>
<h1 id="chapter17_12"><small>Chapter 17.12</small><br>Multiple Windows</h1>

<p>Occasionally you will run into a link or action on a site that opens a new window. In order to work within this new window, or the originating one, you will need to switch between them.</p>

<p>On the face of it, this is a pretty straightforward thing. But lurking within it is a small gotcha to watch out for.</p>

<p>Let's step through it.</p>
<h2>An Example</h2>

<p>NOTE: You can find a link to our example application <a href="http://the-internet.herokuapp.com/windows">here</a>.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>Nothing fancy here. Just loading the libraries necessary to run Selenium Webdriver and perform our assertions. That and wiring up some simple setup, teardown, and run actions to keep things clean.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/windows'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'.example a'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">window_handles</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should_not</span> <span class="o">=~</span> <span class="sr">/New Window/</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">window_handles</span><span class="o">.</span><span class="n">last</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/New Window/</span>
<span class="p">}</span>
</pre></div>
<p>After loading the page and clicking the link (which spawns a new window) we grab the window handles (a.k.a. non-sensical identifier strings which represent each open browser window) and traverse between them based on the order of the list -- making assertions based on each page's title.</p>

<p><strong>While this may feel intuitively correct, this approach is going to bite you later.</strong></p>

<p>The order of the window handles is not consistent across all browsers. Some return in the order opened, others alphabetically.</p>

<p>Here's a more effective approach.</p>
<h2>A Better Example</h2>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/windows'</span>
  <span class="n">main_window</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">window_handle</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'.example a'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="n">windows</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">window_handles</span>
  <span class="n">windows</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">window</span><span class="o">|</span>
    <span class="k">if</span> <span class="n">main_window</span> <span class="o">!=</span> <span class="n">window</span>
      <span class="vi">@new_window</span> <span class="o">=</span> <span class="n">window</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">main_window</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should_not</span> <span class="o">=~</span> <span class="sr">/New Window/</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="vi">@new_window</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/New Window/</span>
<span class="p">}</span>
</pre></div>
<p>After we load the page, but before we click the new window link, we get the window handle for the main window. Then we click the link and get the window handles for both open windows.</p>

<p>Since this returns an array we iterate through it and find the window handle that is different -- a.k.a. the new window -- and store its value.</p>

<p>Once we have that it's all down hill from there. We're able to switch between the main window and the new window and assert that the page title contains the correct text.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Get the window handle for the current window</li>
<li>Take an action that opens a new window</li>
<li>Get the window handle for the new window</li>
<li>Switch between the windows as needed</li>
</ul>
<h1 id="chapter17_13"><small>Chapter 17.13</small><br>Secure File Downloads</h1>

<p>In a previous chapter we covered how to write tests to download files in a browser agnostic way by leveraging Selenium Webdriver and an HTTP library in tandem. This approach is great, but there are often times where the file you want to download is behind authentication, presenting a hurdle to overcome.</p>

<p>In order to access secure files with an HTTP library, we want to pull the authenticated session information out of Selenium's cookie store and pass it into the HTTP library when we perform the download action.</p>

<p>Let's dig in with an example.</p>
<h2>An Example</h2>

<p>We start by requiring our libraries (Selenium to drive the browser, RSpec for our assertions, and RestClient for our download action) and wire up our setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="nb">require</span> <span class="s1">'rest-client'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>Next we access a page of download links that is behind Basic HTTP Authentication, grab the first download link, and pull the authentication session cookie from the cookie store. Once we have that we fire up RestClient and perform a HEAD request against the download link with the cookie information and then check the headers to make sure it has the correct type and is not empty.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://admin:admin@the-internet.herokuapp.com/download_secure'</span>
  <span class="n">link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
  <span class="n">cookie</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">cookie_named</span> <span class="s1">'rack.session'</span>
  <span class="n">response</span> <span class="o">=</span> <span class="no">RestClient</span><span class="o">.</span><span class="n">head</span> <span class="n">link</span><span class="p">,</span> <span class="ss">cookie</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">cookie</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2">=</span><span class="si">#{</span><span class="n">cookie</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span><span class="si">}</span><span class="s2">;&quot;</span>
  <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_type</span><span class="o">].</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'application/pdf'</span>
  <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_length</span><span class="o">].</span><span class="n">to_i</span><span class="o">.</span><span class="n">should</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="k">end</span>
</pre></div>
<p>In order for things to work correctly with RestClient we have to stringify the cookie values (due to <a href="https://github.com/rest-client/rest-client/issues/89#issuecomment-17923328">an open issue</a> in the library). But your cookie configuration will likely vary depending on your HTTP library of choice.</p>

<p>And note that we are using a HEAD request instead of a GET request. Since we only care about the header information this will perform a partial fetch of data, avoiding a full download of the file.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Get the first download link</li>
<li>Pull the authenticated cookie information</li>
<li>Use it to perform a HEAD request against the download link</li>
<li>Check the headers to make sure the file is the correct type and not empty</li>
</ul>
<h2>Outro</h2>

<p>While this example demonstrates accessing files behind Basic HTTP Authentication it should also work with form-based authentication.</p>
<h1 id="chapter17_14"><small>Chapter 17.14</small><br>Selenium Grid</h1>

<p>If you're looking to run your tests on different browser and operating system combinations but you're unable to justify using a third-party like <a href="https://saucelabs.com/">Sauce Labs</a> or <a href="http://www.browserstack.com/">Browser Stack</a> then what do you do?</p>

<p>With <a href="https://code.google.com/p/selenium/wiki/Grid2">Selenium Grid</a> you can stand up a simple infrastructure of various browsers on different operating systems to not only distribute test load, but also give you a diversity of browsers to work with.</p>
<h2>A brief Selenium Grid primer</h2>

<p>Selenium Grid lets you distribute test execution across several machines, and you connect to it using Selenium Remote -- specifying the browser type, version, platform, etc. through the use of Selenium Remote and it's <code>Capabilities</code>.</p>

<p>There are two main elements to Selenium Grid -- a hub, and nodes. You first need to stand up a hub. You can then register nodes to it.</p>

<p>Nodes are where your tests will run, and the hub is responsible for making sure your tests end up on the right one.</p>
<h2>An Example</h2>
<h3>Part 1: Grid Setup</h3>

<p>Selenium Grid comes baked into the Selenium Standalone Server. So to get started we'll need to grab the latest version from <a href="http://selenium-release.storage.googleapis.com/index.html">here</a>.</p>

<p>Once we have it we can start the hub.</p>
<div class="highlight"><pre>java -jar selenium-server-standalone-2.42.0.jar -role hub
</pre></div>
<p>After that we can register nodes to it.</p>
<div class="highlight"><pre>java -jar selenium-server-standalone-2.42.0.jar -role node -hub http://localhost:4444/grid/register
</pre></div>
<p><strong>NOTE: This example only demonstrates a single node on the same machine as the hub. To span nodes across multiple machines you will need to place the standalone server on each machine and launch it with the same registration command (replacing <code>http://localhost</code> with the location of your hub, and specifying additional parameters as needed).</strong></p>

<p>Now that the grid is running we can view the available browsers by visiting our Grid's console at <code>http://localhost:4444/grid/console</code>.</p>

<p>To refine the list of available browsers, we can specify an additional <code>-browser</code> parameter when registering the node. For instance, if we wanted to just offer safari on a node, we could specify it with <code>-browser browserName=safari</code>, which would look like this:</p>
<div class="highlight"><pre>java -jar selenium-server-standalone-2.42.0.jar -role node -browser <span class="nv">browserName</span><span class="o">=</span>safari -hub http://localhost:4444/grid/register
</pre></div>
<p>We could also repeat this parameter again if we wanted to explicitly specify more than one browser.</p>
<div class="highlight"><pre>java -jar selenium-server-standalone-2.42.0.jar -role node -browser <span class="nv">browserName</span><span class="o">=</span>safari -browser <span class="nv">browserName</span><span class="o">=</span>chrome -browser <span class="nv">browserName</span><span class="o">=</span>firefox -hub http://localhost:4444/grid/register
</pre></div>
<p>There are numerous parameters that we can use at run time. You can see a full list <a href="https://code.google.com/p/selenium/wiki/Grid2#Optional_parameters">here</a>.</p>
<h3>Part 2: Test Setup</h3>

<p>Let's wire up a simple test script to use our new Grid.</p>

<p>First, we'll need to require our necessary libraries and wire up <code>setup</code>, <code>teardown</code>, and <code>run</code> methods. After that it's just a simple matter of adding in some Selenium commands and an assertion to make sure the browser is doing what we expect.</p>
<div class="highlight"><pre><span class="c1"># filename: grid.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
    <span class="ss">:remote</span><span class="p">,</span>
    <span class="ss">url</span><span class="p">:</span> <span class="s1">'http://localhost:4444/wd/hub'</span><span class="p">,</span>
    <span class="ss">desired_capabilities</span><span class="p">:</span> <span class="ss">:firefox</span><span class="p">)</span> <span class="c1"># you can also use :chrome, :safari, etc.</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'The Internet'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
<p>The thing to note in this configuration is that we're using Selenium Remote (e.g., <code>Selenium::WebDriver.for(:remote,</code>) to run against the grid. And we are telling the grid which browser we want through the <code>desired_capabilities</code> (e.g., <code>:firefox</code>).</p>

<p>An alternative way to configure this would be to create a Selenium Remote Capabilities object for the browser we want, modify it as needed, and pass that it to <code>desired_capabilities</code>.</p>
<div class="highlight"><pre><span class="n">caps</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Capabilities</span><span class="o">.</span><span class="n">firefox</span>
<span class="n">caps</span><span class="o">[</span><span class="ss">:platform</span><span class="o">]</span> <span class="o">=</span> <span class="ss">:mac</span> <span class="c1"># you can also use :any, :win, or :x</span>

<span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
  <span class="ss">:remote</span><span class="p">,</span>
  <span class="ss">url</span><span class="p">:</span> <span class="s1">'http://localhost:4444/wd/hub'</span><span class="p">,</span>
  <span class="ss">desired_capabilities</span><span class="p">:</span> <span class="n">caps</span><span class="p">)</span>
</pre></div>
<p>You can see a full list of the available Selenium Remote Capabilities <a href="https://selenium.googlecode.com/git/docs/api/rb/Selenium/WebDriver/Remote/Capabilities.html">here</a>.</p>

<p>When we run this script (<code>ruby grid.rb</code>) then the test should run using Chrome through the grid.</p>
<h2>Expected Behavior</h2>

<ul>
<li>The hub will determine which node has the necessary browser/platform combination</li>
<li>A browser will open on that node</li>
<li>The test will run using browser and close when finished</li>
</ul>
<h2>Outro</h2>

<p>If you're looking to set up Selenium Grid to work with Internet Explorer or Chrome, be sure to read up on how to set them up since there is some additional configuration required for each. And if you run into issues with other browsers, be sure to check out their driver documentation as well:</p>

<ul>
<li><a href="https://code.google.com/p/selenium/wiki/ChromeDriver">ChromeDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/FirefoxDriver">FirefoxDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/InternetExplorerDriver">InternetExplorerDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/OperaDriver">OperaDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/SafariDriver">SafariDriver</a></li>
</ul>

<p>Lastly, it's worth noting that while Selenium Grid is a great option for scaling your test infrastructure, it by itself will not give you parallelization. That is to say, it can handle however many connections you throw at it, but you will still need to execute your tests in parallel.</p>
<h1 id="chapter17_15"><small>Chapter 17.15</small><br>Tables</h1>

<p>Odds are at some point you've come across the use of tables in a web application to display data or information to a user, enabling them to sort and manipulate it. Depending on your application it can be quite common and something you will want to write automation for.</p>

<p>But when that table has no helpful markup (e.g., <code>id</code> or <code>class</code> attributes) it quickly becomes more difficult to work with and write tests against. And if you're able to pull something together, it will likely not work against older browsers.</p>

<p>All hope is not lost because you can traverse the table through the use of CSS Pseudo-classes.</p>

<p>But keep in mind that if you care about older browsers, then this approach won't work on them. In those cases it's better to get something working in the short term and file a fix with your front-end developer(s) to update the table with helpful attributes.</p>
<h2>A Tables &amp; CSS Pseudo-classes Primer</h2>

<p>Understanding the broad strokes of an HTML table's structure goes a long way in writing effective automation against it. So here's a quick primer.</p>

<p>A table has...</p>

<ul>
<li>a header (e.g., <code>&lt;thead&gt;</code>)</li>
<li>a body (e.g., <code>&lt;tbody&gt;</code>).</li>
<li>rows (e.g., <code>&lt;tr&gt;</code>) -- horizontal slats of data</li>
<li>columns -- vertical slats of data</li>
</ul>

<p>Columns are made up of cells which are represented as...</p>

<ul>
<li><code>&lt;th&gt;</code> in a header</li>
<li><code>&lt;td&gt;</code> in a body (also known as <strong>table data</strong>)</li>
</ul>

<p>CSS Pseudo-classes work by walking through the structure of an object and targeting a specific part of it based on a relative number (e.g., the <strong>third</strong> <code>&lt;td&gt;</code> cell from a row in the table body). This works well with tables since we can couple it with Selenium to grab all instances of a target (e.g., the third <code>&lt;td&gt;</code> cell from <strong>all rows</strong> in the table body) -- which gives us all of the data for a specific column.</p>

<p>Let's dig in with an example for a common set of table functionality -- sorting columns in ascending and descending order.</p>
<h2>An Example</h2>

<p><strong>NOTE: You can see the application under test <a href="http://the-internet.herokuapp.com/tables">here</a>. There are 2 tables. We will start with Example 1 and then work with Example 2</strong></p>

<p>We kick things off by requiring our dependent libraries (<code>selenium-webriver</code> to drive the browser and <code>rspec-expectations</code> to handle our assertions) and wiring up our <code>setup</code>, <code>teardown</code>, and <code>run</code> actions.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>
<p>Here is a snippet from the first table we are working with. Note that it does not have any <code>id</code> or <code>class</code> attributes.</p>
<div class="highlight"><pre><span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">&quot;table1&quot;</span> <span class="na">class=</span><span class="s">&quot;tablesorter&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Last Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>First Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Email<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Due<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Web Site<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Action<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td&gt;</span>Smith<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>John<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>jsmith@gmail.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>$50.00<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>http://www.jsmith.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#edit'</span><span class="nt">&gt;</span>edit<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#delete'</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
</pre></div>
<p>There are 6 columns (<code>Last Name</code>, <code>First Name</code>, <code>Email</code>, <code>Due</code>, <code>Web Site</code>, and <code>Action</code>). Each one is sortable. The first click should sort them in ascending order, the second click in descending order.</p>

<p>And there is a small sampling of data in the table to work with (4 rows worth), so we should be able to sort and confirm that it actually worked. So let's do that -- starting with the <code>Due</code> column.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(4)'</span><span class="p">)</span>
  <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>

  <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
</pre></div>
<p>After navigating to the page we find and click the column heading that we want with a CSS Pseudo-class (e.g., <code>#table1 thead tr th:nth-of-type(4)</code>) which is effectively saying 'give me the 4th <code>th</code> element in the table heading' which is the placement of <code>Due</code>.</p>

<p>We then use another pseudo-class to find all of the <code>td</code> elements found within each row of the table body that are <code>Due</code>s -- which is effectively the 4th column.</p>

<p>Once we have them we create an array and iterate over the collection of <code>td</code> elements we found, stripping off the dollar sign, converting them into a decimal number, and shoveling them into the array. With this array of numbers we can then compare it against a sorted version of itself to make sure that they match. If they do then the table data on the page was sorted in ascending order.</p>

<p>If we click the <code>Due</code> heading again it should sort in descending order. The code for that is identical except for the assertion which is checking the same thing but seeing if it's false.</p>
<div class="highlight"><pre>  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(4)'</span><span class="p">)</span>
  <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span> <span class="p">}</span>

  <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">false</span>
</pre></div>
<p>We can then expand our sort check to a different column and see that it gets sorted correctly. So let's focus on the <code>Email</code> column.</p>
<div class="highlight"><pre>  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(3)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">emails</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(3)'</span><span class="p">)</span>
  <span class="n">email_values</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">emails</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">email</span><span class="o">|</span> <span class="n">email_values</span> <span class="o">&lt;&lt;</span> <span class="n">email</span><span class="o">.</span><span class="n">text</span> <span class="p">}</span>

  <span class="p">(</span><span class="n">email_values</span> <span class="o">==</span> <span class="n">email_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
<p>The mechanism for this is the same except that we are not manipulating the text before checking it. We are just doing a straight comparision. This is because Ruby will sort a collection of numbers that are represented as strings in descending order. Whereas all other comparisons will sort in ascending order.</p>
<h2>But What About Older Browsers?</h2>

<p>So, now we have a working example that will load the page and check sorting three different ways. Great! But as soon as we run this againt an older browser (like Internet Explorer 8) it will throw an exception stating <code>Unable to find element</code>. This is because older browsers don't support CSS Pseudo-classes.</p>

<p>You've already come a long way, so it's best to get value out of what you've just written. You can run these tests on current browsers, file a fix with your front-end developers to improve the table design with some <code>class</code> attributes, and then update these tests once they've made the necessary changes.</p>

<p>Here is a snippet of what our original table would look like with helpful attributes added in.</p>
<div class="highlight"><pre><span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">&quot;table2&quot;</span> <span class="na">class=</span><span class="s">&quot;tablesorter&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'last-name'</span><span class="nt">&gt;</span>Last Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'first-name'</span><span class="nt">&gt;</span>First Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'email'</span><span class="nt">&gt;</span>Email<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'dues'</span><span class="nt">&gt;</span>Due<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'web-site'</span><span class="nt">&gt;</span>Web Site<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'action'</span><span class="nt">&gt;</span>Action<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'last-name'</span><span class="nt">&gt;</span>Smith<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'first-name'</span><span class="nt">&gt;</span>John<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'email'</span><span class="nt">&gt;</span>jsmith@gmail.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'dues'</span><span class="nt">&gt;</span>$50.00<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'web-site'</span><span class="nt">&gt;</span>http://www.jsmith.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'action'</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#edit'</span><span class="nt">&gt;</span>edit<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#delete'</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
</pre></div>
<p>With that, the selectors for our sorting tests become a lot simpler and more expressive. Here's an example of the <code>Due</code> ascending test being written against it.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table2 thead .dues'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">css</span><span class="p">:</span> <span class="s1">'#table2 tbody .dues'</span><span class="p">)</span>
  <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>
  <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
<p>Not only will these selectors work in both current and older browsers, but they are more resilient to changes in the table column order since they're not hard-coded values any more.</p>
<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Click the column heading</li>
<li>Grab the values for that column</li>
<li>Assert that they are sorted in the correct order (ascending or descending)</li>
</ul>
<h2>Outro</h2>

<p>CSS Pseudo-classes are a great resource and unlock a lot of potential for your tests -- enabling a bit of CSS gymnastics (assuming you've come up with an automation strategy that rules out older browsers).</p>

<p>For more info on CSS Pseudo-classes you should check out <a href="http://sauceio.com/index.php/2010/01/selenium-totw-css-selectors-in-selenium-demystified/">a nice write-up by Sauce Labs</a>. And maybe <a href="http://www.w3.org/TR/css3-selectors/#structural-pseudos">the W3C spec</a>, but that may be a bit more of a rabbit hole than you may want to fall down.</p>

<p>And for a more in-depth walk-through on HTML Table design you can check out <a href="http://blog.teamtreehouse.com/how-to-code-sortable-tabular-data-with-jquery">Treehouse's write-up</a>.</p>
<h1 id="chapter17_16"><small>Chapter 17.16</small><br>Upgrading From Selenium RC</h1>

<p>As the Selenium project continues to evolve, Selenium RC is moving closer to end-of-life. This is especially true with the upcoming release of Selenium 3 where minimal support will be offered for RC (details of which you can learn more about from <a href="http://seleniumhq.wordpress.com/2013/10/09/selenium-hangout-2-recap/">a recent Selenium Hangout</a>).</p>

<p>But how do you approach an upgrade like this? Especially if you have an enormous amount of tests that you rely on?</p>
<h2>A Solution</h2>

<p>Take Jason Leyba's advice. He works at Google and oversaw their transition from Selenium RC to WebDriver. And he posits that it can be done by following 4 simple steps:  </p>

<ol>
<li>Clean up your tests<br></li>
<li>Swap in WebDriver-backed Selenium<br></li>
<li>Use WebDriver for all new features<br></li>
<li>Replace RC usage as tests break<br></li>
</ol>

<p>To give you some context, Google's Selenium tests spawn something on the order of <em>3 million unique browser sessions per day</em>. And they were able to make this transition happen with minimal disruption to this. If they were able to make this happen at such a scale, then hopefully this serves as inspiration for you to do the same at your organization.</p>

<p><strong>NOTE: Jason discussed this in detail in his keynote at Selenium Conf 2013. His talking points and code examples are recapped below. You can view his full talk <a href="http://www.youtube.com/watch?v=cSLmfegT36A">here</a>.</strong></p>
<h2>4 Simple Steps</h2>
<h3>1. Clean Up Your Tests</h3>

<blockquote>
<p>&quot;Turns out that tests that are easy to maintain are tests that are easy to migrate.&quot; -- Jason Leyba</p>
</blockquote>

<p>The best thing you can do to keep your tests clean is to practice good abstractions. In the simplest form this means not referencing Selenium commands directly in your tests -- pulling these out into something like page objects instead.</p>
<h3>2. Swap In WebDriver-backed Selenium</h3>

<p>With WebDriver-backed Selenium you get two driver instances to use in your tests -- one for Selenium RC and another for WebDriver. This enables you to keep your Selenium RC tests running while simultaneously building out WebDriver functionality as you transition things over.</p>

<p>You can see an example of what this looks like <a href="https://code.google.com/p/selenium/wiki/RubyBindings#-backed_Selenium">here</a>.</p>
<h3>3. &amp; 4. Improve Things Incrementally</h3>

<p>For every new feature you write tests for, use WebDriver. And as your Selenium RC tests break go back and replace the broken bits with WebDriver.</p>

<p>Chip away at this over time and before you know it you'll be upgraded!</p>
<h2>Common Pitfalls</h2>

<p>There are a handfull of pitfalls to be cognizant of when stepping through this upgrade.</p>
<h3>Alert Handling</h3>

<p>WebDriver handles JavaScript alerts in a fundamentally different and incompatible way between Selenium RC and WebDriver that won't jibe in WebDriver-backed Selenium.</p>

<p>The best way to address this is to port your alert handling from Selenium RC to WebDriver -- which is pretty straightforward and should be easy to accomplish assuming you have things abstracted (re: Step #1 above).</p>

<p>Here is an example of the difference:</p>
<div class="highlight"><pre><span class="c1">// Selenium RC</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">chooseCancelOnNextConfirmation</span><span class="o">();</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">click</span><span class="o">(</span><span class="s">&quot;id=foo&quot;</span><span class="o">);</span>

<span class="c1">// WebDriver</span>
<span class="n">webdriver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">By</span><span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">)).</span><span class="na">click</span><span class="o">();</span>
<span class="n">webdriver</span><span class="o">.</span><span class="na">switchTo</span><span class="o">().</span><span class="na">alert</span><span class="o">().</span><span class="na">dismiss</span><span class="o">();</span>
</pre></div><h3>Waiting For The Page To Load</h3>

<p>There's no need to explicitly wait for the page to load anymore since WebDriver is implicitly doing this. Save your tests some time and remove it. It's also not a bad idea to explicitly wait for the element you want to interact with.</p>

<p>Here's an example:</p>
<div class="highlight"><pre><span class="c1">// Selenium RC</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">);</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">waitForPageToLoad</span><span class="o">();</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">typeKeys</span><span class="o">(</span><span class="s">&quot;name=q&quot;</span><span class="o">,</span> <span class="s">&quot;bears&quot;</span><span class="o">);</span>

<span class="c1">// WebDriver</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">);</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">typeKeys</span><span class="o">(</span><span class="s">&quot;name=q&quot;</span><span class="o">,</span> <span class="s">&quot;bears&quot;</span><span class="o">);</span>
</pre></div><h3>Getting Text From The Page</h3>

<p>It's an expensive operation (and overkill) to get ALL of the text from the page to make a verification. And it takes longer to execute this in WebDriver.</p>

<p>A better approach is to find the element that has the text you want and check its text instead. Alternatively, if you want to search the entire page, it's better to get the page's source and parse that.</p>
<div class="highlight"><pre><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">selenium</span><span class="o">.</span><span class="na">getBodyText</span><span class="o">();</span>
<span class="n">assertTrue</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">));</span>

<span class="n">WebElement</span> <span class="n">body</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span>
     <span class="n">By</span><span class="o">.</span><span class="na">tagName</span><span class="o">(</span><span class="s">&quot;body&quot;</span><span class="o">));</span>
<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="na">getText</span><span class="o">();</span>
<span class="n">assertTrue</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">));</span>
</pre></div><h3>Be Careful With JavaScript</h3>

<p>WebDriver-backed Selenium is not built for performance, it's meant to be a transitional tool. So things will run slower in it. The worst offender being issuing JavaScript commands directly to the Selenium Core API. So do your best to avoid things like this.</p>
<div class="highlight"><pre><span class="n">selenium</span><span class="o">.</span><span class="na">getEval</span><span class="o">(</span>
     <span class="s">&quot;selenium.isElementPresent('id=foo') &amp;&amp; &quot;</span> <span class="o">+</span>
     <span class="s">&quot;selenium.isVisible('id=foo')&quot;</span><span class="o">);</span>
</pre></div><h3>Inertia</h3>

<p>It's worth noting that the hardest part of Google's transition wasn't technical -- it was inertia. Teams were really slow to adopt WebDriver -- even when the tools were readily available, well documented, and easy to use. Jason and his team were able to perservere and succeed through various means (e.g carrot, stick, elbow grease, etc.), but this really slowed their progress.</p>

<p>If you find yourself in a similar situation, it's worth giving <a href="http://www.youtube.com/watch?v=cSLmfegT36A">Jason's talk</a> a watch for inspiration.</p>
<h1 id="chapter18"><small>Chapter 18</small><br>Finding Information On Your Own</h1>

<p>There is information all around us when it comes to Selenium. But it can be challenging to sift through, or know where to look.</p>

<p>Here is a list breaking down a majority of the Selenium resources available, and what they're useful for.</p>
<h2>Documentation &amp; Tips</h2>

<ul>
<li><a href="http://docs.seleniumhq.org/">Selenium HQ</a></li>
</ul>

<p>This is the official Selenium project documentation site. It's a bit dated, but there is loads of helpful information here. You just have to get the hang of how to navigate the site to find what you need.</p>

<ul>
<li><a href="https://code.google.com/p/selenium/w/list">The Selenium Wiki</a></li>
</ul>

<p>This is where all the good stuff is -- mainly, documentation about the various language bindings and browser drivers. If you're not already familiar with it, take a look.</p>

<ul>
<li><a href="http://elementalselenium.com/tips">Elemental Selenium Archives</a></li>
</ul>

<p>Every tip I've written is freely available on the tips archive page. There are over 35 different Selenium problems and solutions covered.</p>
<h2>Blogs</h2>

<ul>
<li><a href="http://seleniumhq.wordpress.com/">The official Selenium blog</a></li>
</ul>

<p>This is where news of the Selenium project gets announced, and there's also the occasional round-up of what's going on in the tech space (as it relates to testing). Definitely worth a look.</p>

<ul>
<li><a href="http://it-kosmopolit.de/Selenium/blog/selenium-blogs/selenium_blogs.php">A list of &quot;all&quot; Selenium WebDriver blogs</a></li>
</ul>

<p>At some point, someone rounded up a large list of blogs from Selenium practitioners and committers. It's a pretty good list.</p>
<h2>Other Books</h2>

<ul>
<li><a href="http://www.amazon.com/Selenium-Testing-Tools-Beginners-Guide/dp/1849518300">Selenium 2 Testing Tools</a></li>
</ul>

<p>This book is by <a href="https://twitter.com/AutomatedTester">David Burns</a> and it is a tremendous and thorough resource. It outlines how to use Selenium, top-to-bottom. It's definitely worth having on your shelf.</p>

<ul>
<li><a href="http://www.amazon.com/Selenium-Testing-Cookbook-Gundecha-Unmesh/dp/1849515743/ref=pd_bxgy_b_img_z">Selenium Testing Tools Cookbook</a></li>
</ul>

<p>This is another good book outlining loads of great ways to leverage Selenium. While I haven't had a chance to finish reading it, it's clear that Gundecha has a very pragmatic approach that will yield great results.</p>
<h2>Meetups</h2>

<ul>
<li><a href="http://seleniumhq.wordpress.com/2013/08/09/the-worlds-best-selenium-meetup/">The Selenium Hangout</a></li>
</ul>

<p>This is an entirely online meetup that is run by me and <a href="https://twitter.com/AutomatedTester">David Burns</a> where we talk about the latest in the Selenium community (e.g., the upcoming conference, the status of Selenium 3, etc.) and answer questions from the community. Videos are recorded and made available (along with notes) on <a href="http://seleniumhq.wordpress.com/">the official Selenium blog</a>.</p>

<ul>
<li><a href="http://selenium.meetup.com/">All Selenium Meetups listed on Meetup.com</a></li>
</ul>

<p>A listing of all in-person Selenium Meetups are available on Meetup.com. If you're near a major city, odds are there's one waiting for you.</p>

<ul>
<li><a href="http://sauceio.com/index.php/2011/10/so-you-want-to-start-a-selenium-meetup-group-now-what/">How to start your own Selenium Meetup</a></li>
</ul>

<p>If there's not a Selenium Meetup near you, start one! Sauce Labs has a great write up on how to do it.</p>
<h2>Conferences</h2>

<ul>
<li><a href="http://www.seleniumconf.org/">Selenium Conf</a></li>
</ul>

<p>This is a tremendous annual conference where practitioners and committers gather and share knowledge. All of the talks are top notch, as is the hallway track. I highly recommend it.</p>

<ul>
<li><a href="http://seleniumcamp.com/">Selenium Camp</a></li>
</ul>

<p>This is an annual Selenium conference in Europe. I haven't been yet, but it sounds like a good event.</p>

<ul>
<li><a href="http://watirmelon.com/2013/12/11/software-testing-conferences-2014/">List of other testing conferences</a></li>
</ul>

<p><a href="https://twitter.com/alisterscott">Alister Scott</a> has a good write-up of the testing conferences coming up this year.</p>
<h2>Videos</h2>

<ul>
<li><a href="http://www.youtube.com/user/seleniumconf/videos">Selenium Conference Talks</a></li>
</ul>

<p>All of the talks from The Selenium Conference are recorded and made freely available online. This is a tremendous resource.</p>

<ul>
<li><a href="http://www.youtube.com/results?search_query=selenium%20meetup&amp;sm=3">Selenium Meetup Talks</a></li>
</ul>

<p>Some of the Selenium Meetups make it a point to record their talks and publish them afterwards. Here are some of them. They are a great way to see what other people are doing and pick up some new tips.</p>

<ul>
<li><a href="http://www.youtube.com/playlist?list=PLjmE7QwH0u6dXyfzlZ10f2Yz6d3mE9QEi">Selenium Hangout</a></li>
</ul>

<p>All of the Selenium Hangout Meetups are recorded and made available. A lot of great stuff is discussed in them.</p>
<h2>Mailing Lists</h2>

<ul>
<li><a href="https://groups.google.com/forum/?fromgroups#!forum/selenium-users">Selenium Users Google Group</a></li>
<li><a href="http://www.linkedin.com/groups/Selenium-Test-Automation-User-Group-961927">Selenium LinkedIn Users Group</a></li>
</ul>

<p>The signal to noise ratio in these groups can be challenging at times. But you can occasionally find some answers to your questions.</p>

<ul>
<li><a href="http://tech.groups.yahoo.com/group/agile-testing/">Agile Testing Yahoo Group</a></li>
</ul>

<p>This list is less about Selenium and more about &quot;testing&quot; (in the <a href="http://www.satisfice.com/blog/archives/856">checking versus testing</a> sense). It's a great place to ask for sage advice, and to hang out and listen. You will learn some valuable insights here.</p>
<h2>Forums</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/tagged/selenium">Stack Overflow</a></li>
<li><a href="http://www.quora.com/Selenium-testing-framework">Quora</a></li>
</ul>

<p>These are the usual forums where you can go looking for answers to questions you're facing (in addition to the mailing lists above).</p>
<h2>Issues</h2>

<ul>
<li><a href="https://code.google.com/p/selenium/issues/list">Selenium Issue Tracker</a></li>
</ul>

<p>If you're running into a specific and repeatable issue that just doesn't make sense, you may have found a bug in Selenium. You'll want to check the Selenium Issue Tracker to see if it has already been reported. If not, then create a new issue. But be sure to read <a href="http://jimevansmusic.blogspot.com/2012/12/not-providing-html-page-is-bogus.html">this post</a> before you do (so you can be sure that you have provided enough information).</p>
<h2>Chatting With the Selenium Community on IRC</h2>

<p>The Selenium IRC Chat Channel is arguably the best way to connect with the Selenium community and get questions answered. This is where committers and practitioners hang out day-in and day-out. Let's step through what it is and how to access it.</p>
<h3>Brief Intro To IRC</h3>

<p>IRC (short for Internet Relay Chat) is a protocol that freely enables live chatting (both in groups and person to person) and file sharing. It's been around for a while (circa 1988) and is the preferred mode of communication among certain tech circles.</p>

<p>Within the realm of IRC there are numerous servers you can connect to. Each one containing people and bots logged in and joined to one or more chat rooms talking, sharing files, etc.</p>

<p>One of the beautiful things about IRC is that there is no sign-up required to join the party. You just need to download a client that handles the IRC protocol (there's at least one available for every platform), point it at a server, and pick a unique nickname for yourself on that server.</p>

<p>Once you're on you can join a chat room and start jib-jabbing.</p>
<h3>How To Get Connected</h3>
<h4>Step 1: Get An IRC Chat Client</h4>

<p>First thing's first, get a chat client that supports IRC.</p>

<p>You may already have one and not even know. For example, <a href="https://adium.im/">Adium</a> (for OSX) supports a staggering number of chat protocols. If you already have it (or something like it) then use that to connect. If you don't, then you'll need to grab one (or one that is built specifically for IRC).</p>

<p>Here are some worthwhile IRC chat clients (broken out by platform -- and are free unless otherwise noted).</p>

<p><strong>OSX</strong></p>

<ul>
<li><a href="http://limechat.net/mac/">LimeChat</a></li>
<li><a href="http://www.codeux.com/textual/">Textual</a> ($4.99 to buy)</li>
</ul>

<p><strong>Windows</strong></p>

<ul>
<li><a href="http://www.mirc.com/?/">mIRC</a> (free for 30 days, $20 for a single-user license)</li>
</ul>

<p><strong>Linux</strong></p>

<ul>
<li><a href="http://www.irssi.org/">Irssi</a></li>
</ul>

<p><strong>Web-only</strong></p>

<ul>
<li><a href="http://webchat.freenode.net/">Webchat</a></li>
<li><a href="https://www.irccloud.com/">IRCCloud</a> (free with paid tier as well, Android and iOS apps available as well)</li>
</ul>
<h4>Step 2: Connect To The Proper Server</h4>

<p>The Selenium chat channel lives on the Freenode server. To connect to it directly you would use <code>irc.freenode.net</code>.</p>

<p>Before connecting you should be able to set a nickname and perhaps even specify which channel you would like to connect to after connecting (e.g., <code>#selenium</code>). If you don't see these bits, don't sweat it. Connect and proceed to the next step.</p>

<p>Note: If you're using Webchat, it will automatically connect you to Freenode.</p>
<h4>Step 3: Join The Chat Channel</h4>

<p>In IRC parlance channels are prepended with a <code>#</code> and are lower-case. So the Selenium channel is <code>#selenium</code>.</p>

<p>If you were able to configure your chat client to join the channel for you, then proceed to the next step. Otherwise, you'll need to issue a command in the status window. There are a series of commands you can issue in IRC. They are all prepended with a <code>/</code>. To join a chat channel type <code>/join #selenium</code> and press <code>Enter</code>.</p>

<p>This should open a new window in the app and in it should be the Selenium chat channel. Woohoo!</p>
<h4>Step 4: Talk And Hangout</h4>

<p>Feel free to say hello and introduce yourself. But more importantly, ask your question. And if it looks like no one is chatting, ask it anyway. Someone will see it and eventually respond. They always do.</p>

<p>In order to get your answer, you'll probably want to hang around for a bit. But the benefit of being a fly on the wall is that you quickly gain insight into other problems people face, possible solutions, and the current status of the Selenium project and its various pieces.</p>
<h1 id="chapter19"><small>Chapter 19</small><br>Now You Are Ready</h1>

<p>The journey for doing Selenium successfully can be long and arduous. But by adhering to the principals in this book, you will avoid a majority of the pitfalls around you. You're also in a better position now -- armed with all of the information necessary to continue your Selenium journey.</p>

<p>You are ready. Keep going, and best of luck!</p>

<p>And if you have any questions, feedback, or want help -- get in touch!</p>

<ul>
<li>E-mail: <a href="mailto:dhaeffner@gmail.com">dhaeffner@gmail.com</a><br></li>
<li>Twitter: <a href="http://twitter.com/tourdedave">@TourDeDave</a><br></li>
<li>Office hours: <a href="http://sohelpful.me/tourdedave">SoHelpful.me/TourDeDave</a><br></li>
</ul>

<p>My office hours are free (read: completely free -- no strings attached). You can grab a 30-minute time slot to hop on a Skype or Google Hangout call with me to talk about testing. And if we're both at a conference or meetup, feel free to stop me and say hello!</p>

  </body>
</html>
