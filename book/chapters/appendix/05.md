# File Download (browser agnostic)

While downloading files with a custom browser configuration works it is not portable from browser to browser.

And ultimately we shouldn't care if the browser can download something or not. Instead we should care that the file was downloaded and that it is of the correct type and size -- a subtle but important distinction.

Alongside our Selenium actions we can leverage an HTTP library to initiate a download and inspect the response header to confirm it is what we expect. And all this without actually downloading the file to disk. Such an approach enables us to keep with Selenium, but decouples us from a browser specific configuration.

Let's dig with an example.

## An Example

In the first part of this example we take care of including our third-party libraries and setting up some helper methods (e.g., setup, teardown, and run).

The only thing that is different from most of our previous examples is that we have included the `rest-client` gem to handle the mechanics of our HTTP interactions for downloading files and viewing their response headers.

```ruby
require 'selenium-webdriver'
require 'rspec-expectations'
require 'rest-client'

def setup
  @driver = Selenium::WebDriver.for :firefox
end

def teardown
  @driver.quit
end

def run
  setup
  yield
  teardown
end
```

In our run acton we use Selenium to load the page that has our download links and grab the URL for the first one listed.

We then use the `rest-client` gem to initiate the download and store its response into a variable called `response`.

From this object we are able to access the headers and perform checks against it. Primarily focusing on the `content_type` and `content_length` portions. For this example we are confirming that the file to be downloaded is an `image/jpeg` and that its contents are not empty.

```ruby
run {
  @driver.get 'http://the-internet.herokuapp.com/download'
  link = @driver.find_element(css: 'a').attribute('href')
  response = RestClient.get link
  response.headers[:content_type].should == 'image/jpeg'
  response.headers[:content_length].to_i.should > 0
}
```

## Expected Behavior

+ Load the page
+ Get the URL of the first download link
+ Perform a GET action against the URL with an HTTP library
+ Store the response
+ Assert that the file type is correct
+ Assert that the file is not empty
