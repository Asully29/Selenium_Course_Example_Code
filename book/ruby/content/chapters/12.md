# Running A Different Browser Locally

It's fairly straightforward to get your tests running locally against a single browser (that's what we've been doing up until now). But when you want to run them against additional browsers like Chrome, Safari, and Internet Explorer you quickly run into configuration overhead that can seem cumbersome and lacking in good documentation.

## A Brief Primer On Browser Drivers

With the introduction of WebDriver (circa Selenium 2) a lot of benefits were realized (e.g., more effective and faster browser execution, no more single host origin issues, etc). But with it came some architectural and configuration differences that may not be widely known. Namely -- browser drivers.

WebDriver works with each of the major browsers through a browser driver which is (ideally but not always) maintained by the browser manufacturer. It is an executable file (consider it a thin layer or a shim) that acts as a bridge between Selenium and the browser.

Let's step through an example using [ChromeDriver](https://sites.google.com/a/chromium.org/chromedriver/).

## An Example

Before starting we'll need to [grab the latest ChromeDriver binary executable from Google](http://chromedriver.storage.googleapis.com/index.html) and store the unzipped contents of it in our existing `vendor` directory.

```text
├── Gemfile
├── pages
│   ├── base_page.rb
│   ├── dynamic_loading.rb
│   └── login.rb
├── spec
│   ├── config.rb
│   ├── dynamic_loading_spec.rb
│   ├── login_spec.rb
│   └── spec_helper.rb
└── vendor
    ├── chromedriver
    └── geckodriver
```

Just like with Firefox, in order for Selenium to use this binary, we have to make sure it knows where it is. There are two ways to do that. We can add the `chromedriver` file to our system path, or pass in the path to the file when launching Selenium. Let's do the latter.

__NOTE: There is a different chromedriver binary for each major operating system. If you're using Windows, be sure to use the one that ends in .exe and specify chromedriver.exe in your configuration. This example was built to run on OSX (which does not have a specified file extension for chromedriver).__

Before we go too far, we want to make it so our test suite can run either Firefox or Chrome. To do that, we'll add a browser variable to our 'config.rb' and some conditional logic to `spec_helper.rb`.

```ruby
# filename: spec/config.rb
module Config
  def config
    {
      base_url:     ENV['BASE_URL']     || 'http://the-internet.herokuapp.com',
      browser_name: ENV['BROWSER_NAME'] || 'firefox'
    }
  end
end
```

```ruby
# filename: spec/spec_helper.rb
require 'selenium-webdriver'
require_relative 'config'

RSpec.configure do |c|
  include Config

  c.before do |example|
    case config[:browser_name]
    when 'firefox'
      driver_path = File.join(Dir.pwd, 'vendor', 'geckodriver')
      if File.file? driver_path
        service = Selenium::WebDriver::Service.firefox(path: driver_path)
      end
    when 'chrome'
      driver_path = File.join(Dir.pwd, 'vendor', 'chromedriver')
      if File.file? driver_path
        service = Selenium::WebDriver::Service.chrome(path: driver_path)
      end
    end
    if service
      @driver = Selenium::WebDriver.for config[:browser_name].to_sym, service: service
    else
      @driver = Selenium::WebDriver.for config[:browser_name].to_sym
    end
  end

  config.after do |example|
    @driver.quit
  end

end
```

In `config.before(:each)` we're doing a conditional check against the browser environment variable we set in `config.rb` to determine which browser driver to load. For Chrome we are first telling Selenium where the ChromeDriver binary executable is located on disk, and then loading an instance of Selenium for Chrome.

Now we can specify Chrome when launching our tests (e.g., `BROWSER=chrome rspec`) or Firefox (e.g., `BROWSER=firefox rspec`).

## Additional Browsers

A similar approach can be applied to other browser drivers, with the only real limitation being the operating system you're running. But remember -- __no two browser drivers are alike__. Be sure to check out the documentation for the browser you care about to find out the specific requirements:

+ [ChromeDriver](https://sites.google.com/a/chromium.org/chromedriver/)
+ [EdgeDriver](https://docs.microsoft.com/en-us/microsoft-edge/webdriver)
+ [geckodriver (Firefox)](https://github.com/mozilla/geckodriver)
+ [InternetExplorerDriver](https://github.com/SeleniumHQ/selenium/wiki/InternetExplorerDriver)
+ [SafariDriver](https://developer.apple.com/documentation/webkit/testing_with_webdriver_in_safari)


