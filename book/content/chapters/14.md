# Speeding Up Your Test Runs

It's great that we can easily run our tests in Sauce Labs. But it's a real bummer that all of our tests are executing in series. As our suite grows, things will quickly start to add up and really hamper our ability to get feedback quickly.

With parallelization we can quickly remedy this -- and in Ruby there is a library that makes this simple to accomplish.

Enter [parallel_tests](https://github.com/grosser/parallel_tests).

## Setup

After installing the library we just have to change out the command we use to execute our test runs. Instead of `rspec` we will use one that parallel_tests provides -- `parallel_rspec`.

`parallel_rspec` is effectively a wrapper around RSpec. It's responsible for breaking our spec files into groups and launching each of them in separate system processes along with any arguments we pass in to configure RSpec. So we can still provide our `--r`, we just have to specify `--test-options` before-hand.

To run our tests in parallel with Sauce Labs (without the secure tunnel), then we would use `parallel_rspec --test-options '-r ./config/cloud.rb' spec`. Note the additional `spec` at the end of the command. This tells `parallel_rspec` where the test files live (which is in the 'spec' directory).

These extra arguments can seem a little verbose, but it's a necessary evil with this library -- and it's a small price to pay to get parallelization.

## Number Of Processes

By default `parallel_rspec` will use two processes. We can increase this number by passing an additional argument of `-n` and the number of processes that we want -- e.g., `parallel_rspec -n 5`. But keep in mind that the actual number of parallel processes that get spawned depends on __how many spec files there are (since this library works at the file level)__. So for now, two processes is all we'll get (since we only have two test files). But as our suite grows, increasing the number of processes will yield a huge performance improvement.

It's also worth noting that Sauce Labs is built to handle test execution in parallel. You just need to be cognizant of how many parallel sessions your account is set up to handle (e.g., three for Sauce Open accounts).

## Randomizing

A great way to make sure your tests don't have any cross-dependencies (and to ferret out possible anomalies in your application under test) is to run your tests in a random order. Within RSpec this is an easy thing to accomplish. It's just another command-line argument to pass in on test execution `--order random`.

```ruby
parralel_rspec --test-options '-r ./config_cloud.rb --order random'
```

This coupled with parallelization will help make your tests really sing.
