# Multiple Windows

Occasionally you will run into a link or action on a site that opens a new window. In order to work within this new window, or the originating one, you will need to switch between them.

On the face of it, this is a pretty straightforward thing. But lurking within it is a small gotcha to watch out for.

Let's step through it.

## An Example

NOTE: You can find a link to our example application [here](http://the-internet.herokuapp.com/windows).

```ruby
require 'selenium-webdriver'
require 'rspec-expectations'

def setup
  @driver = Selenium::WebDriver.for :firefox
end

def teardown
  @driver.quit
end

def run
  setup
  yield
  teardown
end
```

Nothing fancy here. Just loading the libraries necessary to run Selenium Webdriver and perform our assertions. That and wiring up some simple setup, teardown, and run actions to keep things clean.


```ruby
run do
  @driver.get 'http://the-internet.herokuapp.com/windows'
  @driver.find_element(css: '.example a').click
  @driver.switch_to.window(@driver.window_handles.first)
  @driver.title.should_not =~ /New Window/
  @driver.switch_to.window(@driver.window_handles.last)
  @driver.title.should =~ /New Window/
end
```

After loading the page and clicking the link (which spawns a new window) we grab the window handles (a.k.a. non-sensical identifier strings which represent each open browser window) and traverse between them based on the order of the list -- making assertions based on each page's title.

__While this may feel intuitively correct, this approach is going to bite you later.__

The order of the window handles is not consistent across all browsers. Some return in the order opened, others alphabetically.

Here's a more effective approach.


## A Better Example

```ruby
run do
  @driver.get 'http://the-internet.herokuapp.com/windows'
  main_window = @driver.window_handle
  @driver.find_element(css: '.example a').click
  windows = @driver.window_handles
  windows.each do |window|
    if main_window != window
      @new_window = window
    end
  end
  @driver.switch_to.window(main_window)
  @driver.title.should_not =~ /New Window/
  @driver.switch_to.window(@new_window)
  @driver.title.should =~ /New Window/
end
```

After we load the page, but before we click the new window link, we get the window handle for the main window. Then we click the link and get the window handles for both open windows.

Since this returns an array we iterate through it and find the window handle that is different -- a.k.a. the new window -- and store its value.

Once we have that it's all down hill from there. We're able to switch between the main window and the new window and assert that the page title contains the correct text.


## Expected Behavior

+ Load the page
+ Get the window handle for the current window
+ Take an action that opens a new window
+ Get the window handle for the new window
+ Switch between the windows as needed
