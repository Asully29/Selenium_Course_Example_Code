# Prepping For Use

Now that we have tests, page objects, and a base page object, let's package things into a more useful structure.

## Folder Organization

It's about time we create some folders for our specs and page objects. To err on the side of simplicity, let's call the folders 'spec' (for our tests) and 'pages' (for our page objects). We are using 'spec' since it's a default folder that RSpec will use.

Here's everything we should have after creating folders and moving files around:

```sh
.
|-- Gemfile
|-- pages
|   |-- base_page.rb
|   |-- dynamic_loading.rb
|   `-- login.rb
`-- spec
    |-- dynamic_loading_spec.rb
    |-- login_spec.rb
```

## Updating Require Statements

As a result of doing this, we will need to update the require statements in our tests.

```ruby
# filename: spec/login_spec.rb

require_relative '../pages/login'

describe 'Login' do
...
```

```ruby
# filename: spec/dynamic_loading_spec.rb

require_relative '../pages/dynamic_loading'

describe 'Dynamic Loading' do
...
```

Note the use of double-dots (`..`) in the page object require statement. This is how we tell Ruby to traverse up a directory (from our spec directory) before trying to access the page objects folder.

## Base URL

We'll want to put our base URL someplace central. And we'll want it to be configurable. So let's create a 'config.rb' file in the parent directory and place it there.

```ruby
# filename: config.rb

ENV['base_url'] ||= 'http://the-internet.herokuapp.com'
```

By using a conditional when setting the environment variable (`||=`) we are making it so we can override this value when launching our test suite. It essentially means if the environment variable already exists and contains a value, use it. Otherwise, set it to 'http://the-internet.herokuapp.com'. This will come in handy later, and is something we'll use frequently.

With base URL in a central place, we can now remove it from our tests.

We'll need to remember to require this config file when running our tests. More on that soon.

## Global Setup And Teardown

Now we're ready to pull the test setup and teardown actions out of our tests and into a central place. In RSpec this is straight-forward through the use of a 'spec_helper' file. This can live alongside the other test files in the `spec` directory.

```ruby
# filename: spec/spec_helper.rb

require 'selenium-webdriver'

RSpec.configure do |config|

  config.before(:each) do
    @driver = Selenium::WebDriver.for :firefox
  end

  config.after(:each) do
    @driver.quit
  end

end
```

We need to include the Selenium library here, and by doing so, can remove it from our base page object. And by having our Selenium setup and teardown here, we can remove it from the `before(:each)` and `after(:each)` in our tests -- replacing them with a simple require statement at the top of the file (`require_relative 'spec_helper'`). We will also be able to remove the `after(:each)` from our tests, leaving just the `before(:each)` for use with our page objects.

Here's what our test files should look like when we're done:

```ruby
# filename: spec/login_spec.rb

require_relative 'spec_helper'
require_relative '../pages/login'

describe 'Login' do

  before(:each) do
    @login = Login.new(@driver)
  end

  it 'succeeded' do
    @login.with('tomsmith', 'SuperSecretPassword!')
    @login.success_message_present?.should be_true
  end

  it 'failed' do
    @login.with('asdf', 'asdf')
    @login.failure_message_present?.should be_true
  end

end
```

```ruby
# filename: spec/dynamic_loading_spec.rb

require_relative 'spec_helper'
require_relative '../pages/dynamic_loading'

describe 'Dynamic Loading' do

  before(:each) do
    @dynamic_loading = DynamicLoading.new(@driver)
  end

  it 'Example 1: Hidden Element' do
    @dynamic_loading.example 1
    @dynamic_loading.start
    @dynamic_loading.finish_text_present?.should be_true
  end

  it 'Example 2: Rendered after the fact' do
    @dynamic_loading.example 2
    @dynamic_loading.start
    @dynamic_loading.finish_text_present?.should be_true
  end

end
```

## Running Everything

Now that things are cleaned up, let's run everything. To do that we'll want to make sure to include our new config file. We can do that by specifying it at run time with `rspec --require ./config.rb`, or, `rspec -r ./config.rb` (for short).

Note the `./` before `config.rb`. This tells RSpec that the config file is in the current directory.

Give it a shot. All of the tests should run and pass.
